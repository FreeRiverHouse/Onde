var X=Object.defineProperty;var V=Object.getOwnPropertyDescriptor;var z=Object.getOwnPropertyNames;var Q=Object.prototype.hasOwnProperty;var Y=(s,i)=>()=>(s&&(i=s(s=0)),i);var B=(s,i,I,g)=>{if(i&&typeof i=="object"||typeof i=="function")for(let l of z(i))!Q.call(s,l)&&l!==I&&X(s,l,{get:()=>i[l],enumerable:!(g=V(i,l))||g.enumerable});return s},q=(s,i,I)=>(B(s,i,"default"),I&&B(I,i,"default"));var Z=s=>B(X({},"__esModule",{value:!0}),s);var F={};import*as ht from"async_hooks";var W=Y(()=>{q(F,ht)});import{__getNamedExports as ee}from"../../../../../../__next-on-pages-dist__/webpack/562f1929e61c51936b027740cd20d5f9.js";import{__getNamedExports as te}from"../../../../../../__next-on-pages-dist__/webpack/d6830180ae0f03b84fd7a5e7248c5aa2.js";import{__getNamedExports as ne}from"../../../../../../__next-on-pages-dist__/webpack/d2550da8fc2781985fea0b1c0d3097c7.js";import{__getNamedExports as _e}from"../../../../../../__next-on-pages-dist__/webpack/030bd997c35875172fa1ffa5b8a901e4.js";import{__getNamedExports as re}from"../../../../../../__next-on-pages-dist__/manifest/537259e2ed205f5a7994cb4f05664668.js";var d=globalThis.__nextOnPagesRoutesIsolation.getProxyFor("/api/pr/posts/[id]/feedback"),G=ee(d,d,d),ae=G.__chunk_5822,ce=G.__chunk_7185,A=te(d,d,d),oe=A.__chunk_6195,se=A.__chunk_2067,ue=A.__chunk_5558,ie=A.__chunk_5303,pe=A.__chunk_5228,he=A.__chunk_1959,m=ne(d,d,d),de=m.__chunk_1730,ke=m.__chunk_3818,fe=m.__chunk_7037,ge=m.__chunk_1863,le=m.__chunk_932,xe=m.__chunk_581,be=m.__chunk_2561,me=m.__chunk_2988,Ee=m.__chunk_2039,ye=m.__chunk_5028,ve=m.__chunk_9548,Ne=m.__chunk_6914,we=m.__chunk_7960,Re=m.__chunk_5996,Oe=m.__chunk_4337,a=_e(d,d,d),Se=a.__chunk_5405,Pe=a.__chunk_7322,je=a.__chunk_5276,Te=a.__chunk_5577,$e=a.__chunk_3039,Ae=a.__chunk_9573,Ie=a.__chunk_7701,Ce=a.__chunk_662,Fe=a.__chunk_4101,Me=a.__chunk_6776,Ue=a.__chunk_8042,De=a.__chunk_3665,Le=a.__chunk_7444,Ke=a.__chunk_4591,Be=a.__chunk_6991,qe=a.__chunk_8816,He=a.__chunk_6631,Xe=a.__chunk_4828,We=a.__chunk_828,Ge=a.__chunk_5927,Je=a.__chunk_6202,Ve=a.__chunk_6947,ze=a.__chunk_4363,Qe=a.__chunk_8264,Ye=a.__chunk_1583,Ze=a.__chunk_9985,et=a.__chunk_4155,tt=a.__chunk_7908,nt=a.__chunk_8949,_t=a.__chunk_796,rt=a.__chunk_1651,at=a.__chunk_5105,ct=a.__chunk_9642,ot=a.__chunk_8819,st=a.__chunk_676,J=re(d,d,d),ut=J.__NEXT_FONT_MANIFEST,it=J.__REACT_LOADABLE_MANIFEST,xt=((s,i,I)=>(i._ENTRIES={},s.__BUILD_MANIFEST={polyfillFiles:["static/chunks/polyfills-42372ed130431b0a.js"],devFiles:[],ampDevFiles:[],lowPriorityFiles:[],rootMainFiles:["static/chunks/webpack-a3c37fcbf859f6f9.js","static/chunks/fd9d1056-dcba7f094ce3d609.js","static/chunks/30-b50f13889648ea77.js","static/chunks/main-app-17503da640fcbefb.js"],pages:{"/_app":["static/chunks/webpack-a3c37fcbf859f6f9.js","static/chunks/framework-3664cab31236a9fa.js","static/chunks/main-dc5c0cdb2c2c0bdb.js","static/chunks/pages/_app-72b849fbd24ac258.js"],"/_error":["static/chunks/webpack-a3c37fcbf859f6f9.js","static/chunks/framework-3664cab31236a9fa.js","static/chunks/main-dc5c0cdb2c2c0bdb.js","static/chunks/pages/_error-7ba65e1336b92748.js"]},ampFirstPages:[]},s.__BUILD_MANIFEST.lowPriorityFiles=["/static/FQBh2Ar4Fsg4ZG1NC9Wb7/_buildManifest.js",,"/static/FQBh2Ar4Fsg4ZG1NC9Wb7/_ssgManifest.js"],s.__REACT_LOADABLE_MANIFEST=it,s.__NEXT_FONT_MANIFEST=ut,s.__INTERCEPTION_ROUTE_REWRITE_MANIFEST="[]",(()=>{"use strict";var g={},l={};function r(t){var o=l[t];if(o!==void 0)return o.exports;var u=l[t]={exports:{}},x=!0;try{g[t](u,u.exports,r),x=!1}finally{x&&delete l[t]}return u.exports}r.m=g,r.amdO={},(()=>{var t=[];r.O=(o,u,x,b)=>{if(u){b=b||0;for(var p=t.length;p>0&&t[p-1][2]>b;p--)t[p]=t[p-1];t[p]=[u,x,b];return}for(var k=1/0,p=0;p<t.length;p++){for(var[u,x,b]=t[p],y=!0,E=0;E<u.length;E++)k>=b&&Object.keys(r.O).every(C=>r.O[C](u[E]))?u.splice(E--,1):(y=!1,b<k&&(k=b));if(y){t.splice(p--,1);var N=x();N!==void 0&&(o=N)}}return o}})(),r.n=t=>{var o=t&&t.__esModule?()=>t.default:()=>t;return r.d(o,{a:o}),o},r.d=(t,o)=>{for(var u in o)r.o(o,u)&&!r.o(t,u)&&Object.defineProperty(t,u,{enumerable:!0,get:o[u]})},r.e=()=>Promise.resolve(),r.g=function(){if(typeof i=="object")return i;try{return this||Function("return this")()}catch{if(typeof window=="object")return window}}(),r.o=(t,o)=>Object.prototype.hasOwnProperty.call(t,o),r.r=t=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{var t={993:0};r.O.j=x=>t[x]===0;var o=(x,b)=>{var p,k,[y,E,N]=b,w=0;if(y.some(j=>t[j]!==0)){for(p in E)r.o(E,p)&&(r.m[p]=E[p]);if(N)var P=N(r)}for(x&&x(b);w<y.length;w++)k=y[w],r.o(t,k)&&t[k]&&t[k][0](),t[k]=0;return r.O(P)},u=s.webpackChunk_N_E=s.webpackChunk_N_E||[];u.forEach(o.bind(null,0)),u.push=o.bind(null,u.push.bind(u))})()})(),(s.webpackChunk_N_E=s.webpackChunk_N_E||[]).push([[241],{676:st,8819:ot,9642:ct,5105:at,1651:rt,796:_t,8949:nt,7908:tt,4155:et,9985:Ze,1583:Ye,8264:Qe,4363:ze,6947:Ve,6202:Je,5927:Ge,828:We,4828:Xe,6631:He,8816:qe,6991:Be,4591:Ke,7444:Le,3665:De,8042:Ue,6776:Me,4101:Fe,662:Ce,7701:Ie,9573:Ae,3039:$e,5577:Te,1959:he,5276:je,5228:pe,5303:ie,7322:Pe,5558:ue,5405:Se}]),(s.webpackChunk_N_E=s.webpackChunk_N_E||[]).push([[805],{4337:Oe,5996:Re,7960:we,6914:Ne,9548:ve,5028:ye,2039:Ee,2988:me,2561:be,581:xe,932:le,1863:ge,7037:fe,3818:ke,1730:de}]),(s.webpackChunk_N_E=s.webpackChunk_N_E||[]).push([[71],{2067:se,6195:oe,6682:(g,l,r)=>{"use strict";r.r(l),r.d(l,{ComponentMod:()=>D,default:()=>L});var t={};r.r(t),r.d(t,{POST:()=>N,runtime:()=>E});var o={};r.r(o),r.d(o,{originalPathname:()=>C,patchFetch:()=>U,requestAsyncStorage:()=>P,routeModule:()=>w,serverHooks:()=>M,staticGenerationAsyncStorage:()=>j});var u=r(932),x=r(2561),b=r(4828),p=r(6631),k=r(9985),y=r(5822);let E="edge";async function N(K,{params:O}){try{let{env:$}=(0,y.getRequestContext)(),e=$.DB,{id:c}=await O;if(!e)return k.xk.json({error:"Database not available"},{status:500});let{feedback:n}=await K.json();if(!n?.trim())return k.xk.json({error:"feedback is required"},{status:400});let _=await e.prepare("SELECT id, account, content, feedback FROM posts WHERE id = ?").bind(c).first();if(!_)return k.xk.json({error:"Post not found"},{status:404});let h=[];if(_.feedback)try{h=JSON.parse(_.feedback)}catch{h=[]}h.push(`[${new Date().toISOString()}] ${n}`),await e.prepare(`
      UPDATE posts SET feedback = ? WHERE id = ?
    `).bind(JSON.stringify(h),c).run();let f=`task_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,v=new Date().toISOString();await e.prepare(`
      INSERT INTO agent_tasks (id, type, target_id, target_type, description, status, assigned_to, priority, source_dashboard, created_at, payload)
      VALUES (?, 'post_edit', ?, 'post', ?, 'pending', 'onde-pr', 'high', 'onde.surf', ?, ?)
    `).bind(f,c,`Revise post based on feedback: ${n}`,v,JSON.stringify({post_id:c,feedback:n,original_content:_.content})).run();try{await e.prepare(`
        INSERT INTO activity_log (type, title, description, actor, created_at)
        VALUES ('post_feedback', ?, ?, 'dashboard', ?)
      `).bind(`Feedback sent for @${_.account} post`,n.substring(0,100),v).run()}catch{}return k.xk.json({success:!0,message:"Feedback sent to OndePR agent",task_id:f})}catch($){return console.error("Feedback post error:",$),k.xk.json({error:"Failed to send feedback"},{status:500})}}let w=new x.AppRouteRouteModule({definition:{kind:b.x.APP_ROUTE,page:"/api/pr/posts/[id]/feedback/route",pathname:"/api/pr/posts/[id]/feedback",filename:"route",bundlePath:"app/api/pr/posts/[id]/feedback/route"},resolvedPagePath:"/Users/mattiapetrucciani/CascadeProjects/Onde/apps/surfboard/src/app/api/pr/posts/[id]/feedback/route.ts",nextConfigOutput:"",userland:t}),{requestAsyncStorage:P,staticGenerationAsyncStorage:j,serverHooks:M}=w,C="/api/pr/posts/[id]/feedback/route";function U(){return(0,p.XH)({serverHooks:M,staticGenerationAsyncStorage:j})}let D=o,L=u.a.wrap(w)},7185:ce,5822:ae},g=>{var l=t=>g(g.s=t);g.O(0,[241,805],()=>l(6682));var r=g.O();(i._ENTRIES=typeof i._ENTRIES>"u"?{}:i._ENTRIES)["middleware_app/api/pr/posts/[id]/feedback/route"]=r}]),function(){let g={exports:{},loaded:!1};return function(r,t){"use strict";var o=Object.defineProperty,u=Object.getOwnPropertyDescriptor,x=Object.getOwnPropertyNames,b=Object.prototype.hasOwnProperty,p=(e,c)=>{for(var n in c)o(e,n,{get:c[n],enumerable:!0})},k=(e,c,n,_)=>{if(c&&typeof c=="object"||typeof c=="function")for(let h of x(c))!b.call(e,h)&&h!==n&&o(e,h,{get:()=>c[h],enumerable:!(_=u(c,h))||_.enumerable});return e},y=e=>k(o({},"__esModule",{value:!0}),e),E={};p(E,{default:()=>K}),r.exports=y(E);var N=(W(),Z(F)),w="@next/request-context",P=Symbol.for(w),j=Symbol.for("internal.storage");function M(){let e=i;if(!e[P]){let c=new N.AsyncLocalStorage,n={get:()=>c.getStore(),[j]:c};e[P]=n}return e[P]}var C=M();function U(e,c){return C[j].run(e,c)}function D(e){let c={};return e&&e.forEach((n,_)=>{c[_]=n,_.toLowerCase()==="set-cookie"&&(c[_]=L(n))}),c}function L(e){let c=[],n=0,_,h,f,v,T;function R(){for(;n<e.length&&/\s/.test(e.charAt(n));)n+=1;return n<e.length}function S(){return h=e.charAt(n),h!=="="&&h!==";"&&h!==","}for(;n<e.length;){for(_=n,T=!1;R();)if(h=e.charAt(n),h===","){for(f=n,n+=1,R(),v=n;n<e.length&&S();)n+=1;n<e.length&&e.charAt(n)==="="?(T=!0,n=v,c.push(e.substring(_,f)),_=n):n=f+1}else n+=1;(!T||n>=e.length)&&c.push(e.substring(_,e.length))}return c}function K(e){let c=e.staticRoutes.map(_=>({regexp:new RegExp(_.namedRegex),page:_.page})),n=e.dynamicRoutes?.map(_=>({regexp:new RegExp(_.namedRegex),page:_.page}))||[];return async function(_,h){let f=new URL(_.url).pathname,v={};if(e.nextConfig?.basePath&&f.startsWith(e.nextConfig.basePath)&&(f=f.replace(e.nextConfig.basePath,"")||"/"),e.nextConfig?.i18n)for(let R of e.nextConfig.i18n.locales){let S=new RegExp(`^/${R}($|/)`,"i");if(f.match(S)){f=f.replace(S,"/")||"/";break}}for(let R of c)if(R.regexp.exec(f)){v.name=R.page;break}if(!v.name){let R=$(f);for(let S of n||[]){if(R&&!$(S.page))continue;let H=S.regexp.exec(f);if(H){v={name:S.page,params:H.groups};break}}}let T=await U({waitUntil:h.waitUntil},()=>i._ENTRIES[`middleware_${e.name}`].default.call({},{request:{url:_.url,method:_.method,headers:D(_.headers),ip:O(_.headers,"x-real-ip"),geo:{city:O(_.headers,"x-vercel-ip-city",!0),country:O(_.headers,"x-vercel-ip-country",!0),latitude:O(_.headers,"x-vercel-ip-latitude"),longitude:O(_.headers,"x-vercel-ip-longitude"),region:O(_.headers,"x-vercel-ip-country-region",!0)},nextConfig:e.nextConfig,page:v,body:_.body}}));return T.waitUntil&&h.waitUntil(T.waitUntil),T.response}}function O(e,c,n=!1){let _=e.get(c)||void 0;return n&&_?decodeURIComponent(_):_}function $(e){return e==="/api"||e.startsWith("/api/")}}(g,g.exports),g.exports}.call({}).default({name:"app/api/pr/posts/[id]/feedback/route",staticRoutes:[{page:"/",regex:"^/(?:/)?$",routeKeys:{},namedRegex:"^/(?:/)?$"},{page:"/_not-found",regex:"^/_not\\-found(?:/)?$",routeKeys:{},namedRegex:"^/_not\\-found(?:/)?$"},{page:"/coming-soon",regex:"^/coming\\-soon(?:/)?$",routeKeys:{},namedRegex:"^/coming\\-soon(?:/)?$"},{page:"/corde",regex:"^/corde(?:/)?$",routeKeys:{},namedRegex:"^/corde(?:/)?$"},{page:"/frh",regex:"^/frh(?:/)?$",routeKeys:{},namedRegex:"^/frh(?:/)?$"},{page:"/house",regex:"^/house(?:/)?$",routeKeys:{},namedRegex:"^/house(?:/)?$"},{page:"/login",regex:"^/login(?:/)?$",routeKeys:{},namedRegex:"^/login(?:/)?$"},{page:"/pr",regex:"^/pr(?:/)?$",routeKeys:{},namedRegex:"^/pr(?:/)?$"},{page:"/social",regex:"^/social(?:/)?$",routeKeys:{},namedRegex:"^/social(?:/)?$"}],dynamicRoutes:[{page:"/api/agent-tasks/[id]",regex:"^/api/agent\\-tasks/([^/]+?)(?:/)?$",routeKeys:{nxtPid:"nxtPid"},namedRegex:"^/api/agent\\-tasks/(?<nxtPid>[^/]+?)(?:/)?$"},{page:"/api/auth/[...nextauth]",regex:"^/api/auth/(.+?)(?:/)?$",routeKeys:{nxtPnextauth:"nxtPnextauth"},namedRegex:"^/api/auth/(?<nxtPnextauth>.+?)(?:/)?$"},{page:"/api/pr/posts/[id]/approve",regex:"^/api/pr/posts/([^/]+?)/approve(?:/)?$",routeKeys:{nxtPid:"nxtPid"},namedRegex:"^/api/pr/posts/(?<nxtPid>[^/]+?)/approve(?:/)?$"},{page:"/api/pr/posts/[id]/feedback",regex:"^/api/pr/posts/([^/]+?)/feedback(?:/)?$",routeKeys:{nxtPid:"nxtPid"},namedRegex:"^/api/pr/posts/(?<nxtPid>[^/]+?)/feedback(?:/)?$"}],nextConfig:{basePath:""}})))(d,d,d);export{xt as default};
