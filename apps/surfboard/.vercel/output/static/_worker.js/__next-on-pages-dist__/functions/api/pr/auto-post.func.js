var z=Object.defineProperty;var re=Object.getOwnPropertyDescriptor;var ce=Object.getOwnPropertyNames;var ae=Object.prototype.hasOwnProperty;var se=(s,d)=>()=>(s&&(d=s(s=0)),d);var V=(s,d,F,x)=>{if(d&&typeof d=="object"||typeof d=="function")for(let E of ce(d))!ae.call(s,E)&&E!==F&&z(s,E,{get:()=>d[E],enumerable:!(x=re(d,E))||x.enumerable});return s},Y=(s,d,F)=>(V(s,d,"default"),F&&V(F,d,"default"));var ue=s=>V(z({},"__esModule",{value:!0}),s);var K={};import*as bt from"async_hooks";var Q=se(()=>{Y(K,bt)});import{__getNamedExports as ie}from"../../../../__next-on-pages-dist__/webpack/562f1929e61c51936b027740cd20d5f9.js";import{__getNamedExports as pe}from"../../../../__next-on-pages-dist__/webpack/d6830180ae0f03b84fd7a5e7248c5aa2.js";import{__getNamedExports as he}from"../../../../__next-on-pages-dist__/webpack/d2550da8fc2781985fea0b1c0d3097c7.js";import{__getNamedExports as de}from"../../../../__next-on-pages-dist__/webpack/030bd997c35875172fa1ffa5b8a901e4.js";import{__getNamedExports as ke}from"../../../../__next-on-pages-dist__/manifest/537259e2ed205f5a7994cb4f05664668.js";var l=globalThis.__nextOnPagesRoutesIsolation.getProxyFor("/api/pr/auto-post"),Z=ie(l,l,l),ge=Z.__chunk_5822,le=Z.__chunk_7185,U=pe(l,l,l),fe=U.__chunk_6195,me=U.__chunk_2067,xe=U.__chunk_5558,Ee=U.__chunk_5303,ye=U.__chunk_5228,be=U.__chunk_1959,R=he(l,l,l),we=R.__chunk_1730,Re=R.__chunk_3818,Te=R.__chunk_7037,Se=R.__chunk_1863,ve=R.__chunk_932,Ne=R.__chunk_581,Oe=R.__chunk_2561,Ae=R.__chunk_2988,Ce=R.__chunk_2039,Pe=R.__chunk_5028,$e=R.__chunk_9548,Ie=R.__chunk_6914,je=R.__chunk_7960,Me=R.__chunk_5996,Ue=R.__chunk_4337,c=de(l,l,l),Fe=c.__chunk_5405,De=c.__chunk_7322,Ke=c.__chunk_5276,Le=c.__chunk_5577,He=c.__chunk_3039,Be=c.__chunk_9573,Xe=c.__chunk_7701,Ge=c.__chunk_662,qe=c.__chunk_4101,We=c.__chunk_6776,Je=c.__chunk_8042,Ve=c.__chunk_3665,Ye=c.__chunk_7444,ze=c.__chunk_4591,Qe=c.__chunk_6991,Ze=c.__chunk_8816,et=c.__chunk_6631,tt=c.__chunk_4828,nt=c.__chunk_828,_t=c.__chunk_5927,ot=c.__chunk_6202,rt=c.__chunk_6947,ct=c.__chunk_4363,at=c.__chunk_8264,st=c.__chunk_1583,ut=c.__chunk_9985,it=c.__chunk_4155,pt=c.__chunk_7908,ht=c.__chunk_8949,dt=c.__chunk_796,kt=c.__chunk_1651,gt=c.__chunk_5105,lt=c.__chunk_9642,ft=c.__chunk_8819,mt=c.__chunk_676,ee=ke(l,l,l),xt=ee.__NEXT_FONT_MANIFEST,Et=ee.__REACT_LOADABLE_MANIFEST,Nt=((s,d,F)=>(d._ENTRIES={},s.__BUILD_MANIFEST={polyfillFiles:["static/chunks/polyfills-42372ed130431b0a.js"],devFiles:[],ampDevFiles:[],lowPriorityFiles:[],rootMainFiles:["static/chunks/webpack-a3c37fcbf859f6f9.js","static/chunks/fd9d1056-dcba7f094ce3d609.js","static/chunks/30-b50f13889648ea77.js","static/chunks/main-app-17503da640fcbefb.js"],pages:{"/_app":["static/chunks/webpack-a3c37fcbf859f6f9.js","static/chunks/framework-3664cab31236a9fa.js","static/chunks/main-dc5c0cdb2c2c0bdb.js","static/chunks/pages/_app-72b849fbd24ac258.js"],"/_error":["static/chunks/webpack-a3c37fcbf859f6f9.js","static/chunks/framework-3664cab31236a9fa.js","static/chunks/main-dc5c0cdb2c2c0bdb.js","static/chunks/pages/_error-7ba65e1336b92748.js"]},ampFirstPages:[]},s.__BUILD_MANIFEST.lowPriorityFiles=["/static/FQBh2Ar4Fsg4ZG1NC9Wb7/_buildManifest.js",,"/static/FQBh2Ar4Fsg4ZG1NC9Wb7/_ssgManifest.js"],s.__REACT_LOADABLE_MANIFEST=Et,s.__NEXT_FONT_MANIFEST=xt,s.__INTERCEPTION_ROUTE_REWRITE_MANIFEST="[]",(()=>{"use strict";var x={},E={};function o(_){var a=E[_];if(a!==void 0)return a.exports;var u=E[_]={exports:{}},y=!0;try{x[_](u,u.exports,o),y=!1}finally{y&&delete E[_]}return u.exports}o.m=x,o.amdO={},(()=>{var _=[];o.O=(a,u,y,b)=>{if(u){b=b||0;for(var k=_.length;k>0&&_[k-1][2]>b;k--)_[k]=_[k-1];_[k]=[u,y,b];return}for(var m=1/0,k=0;k<_.length;k++){for(var[u,y,b]=_[k],v=!0,S=0;S<u.length;S++)m>=b&&Object.keys(o.O).every(P=>o.O[P](u[S]))?u.splice(S--,1):(v=!1,b<m&&(m=b));if(v){_.splice(k--,1);var N=y();N!==void 0&&(a=N)}}return a}})(),o.n=_=>{var a=_&&_.__esModule?()=>_.default:()=>_;return o.d(a,{a}),a},o.d=(_,a)=>{for(var u in a)o.o(a,u)&&!o.o(_,u)&&Object.defineProperty(_,u,{enumerable:!0,get:a[u]})},o.e=()=>Promise.resolve(),o.g=function(){if(typeof d=="object")return d;try{return this||Function("return this")()}catch{if(typeof window=="object")return window}}(),o.o=(_,a)=>Object.prototype.hasOwnProperty.call(_,a),o.r=_=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(_,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(_,"__esModule",{value:!0})},(()=>{var _={993:0};o.O.j=y=>_[y]===0;var a=(y,b)=>{var k,m,[v,S,N]=b,A=0;if(v.some(I=>_[I]!==0)){for(k in S)o.o(S,k)&&(o.m[k]=S[k]);if(N)var C=N(o)}for(y&&y(b);A<v.length;A++)m=v[A],o.o(_,m)&&_[m]&&_[m][0](),_[m]=0;return o.O(C)},u=s.webpackChunk_N_E=s.webpackChunk_N_E||[];u.forEach(a.bind(null,0)),u.push=a.bind(null,u.push.bind(u))})()})(),(s.webpackChunk_N_E=s.webpackChunk_N_E||[]).push([[241],{676:mt,8819:ft,9642:lt,5105:gt,1651:kt,796:dt,8949:ht,7908:pt,4155:it,9985:ut,1583:st,8264:at,4363:ct,6947:rt,6202:ot,5927:_t,828:nt,4828:tt,6631:et,8816:Ze,6991:Qe,4591:ze,7444:Ye,3665:Ve,8042:Je,6776:We,4101:qe,662:Ge,7701:Xe,9573:Be,3039:He,5577:Le,1959:be,5276:Ke,5228:ye,5303:Ee,7322:De,5558:xe,5405:Fe}]),(s.webpackChunk_N_E=s.webpackChunk_N_E||[]).push([[805],{4337:Ue,5996:Me,7960:je,6914:Ie,9548:$e,5028:Pe,2039:Ce,2988:Ae,2561:Oe,581:Ne,932:ve,1863:Se,7037:Te,3818:Re,1730:we}]),(s.webpackChunk_N_E=s.webpackChunk_N_E||[]).push([[658],{2067:me,6195:fe,5992:(x,E,o)=>{"use strict";o.r(E),o.d(E,{ComponentMod:()=>X,default:()=>e});var _={};o.r(_),o.d(_,{GET:()=>C,POST:()=>I,runtime:()=>S});var a={};o.r(a),o.d(a,{originalPathname:()=>W,patchFetch:()=>O,requestAsyncStorage:()=>q,routeModule:()=>P,serverHooks:()=>B,staticGenerationAsyncStorage:()=>H});var u=o(932),y=o(2561),b=o(4828),k=o(6631),m=o(9985),v=o(5822);let S="edge";async function N(r,t){try{let n="https://api.twitter.com/2/tweets",i=Math.floor(Date.now()/1e3).toString(),p=Math.random().toString(36).substring(2),g={oauth_consumer_key:t.apiKey,oauth_token:t.accessToken,oauth_signature_method:"HMAC-SHA1",oauth_timestamp:i,oauth_nonce:p,oauth_version:"1.0"},f=Object.keys(g).sort().map($=>`${encodeURIComponent($)}=${encodeURIComponent(g[$])}`).join("&"),h=`POST&${encodeURIComponent(n)}&${encodeURIComponent(f)}`,T=`${encodeURIComponent(t.apiSecret)}&${encodeURIComponent(t.accessTokenSecret)}`,w=new TextEncoder,G=w.encode(T),j=w.encode(h),M=await crypto.subtle.importKey("raw",G,{name:"HMAC",hash:"SHA-1"},!1,["sign"]),te=await crypto.subtle.sign("HMAC",M,j),ne=btoa(String.fromCharCode(...new Uint8Array(te)));g.oauth_signature=ne;let _e="OAuth "+Object.keys(g).sort().map($=>`${encodeURIComponent($)}="${encodeURIComponent(g[$])}"`).join(", "),D=await fetch(n,{method:"POST",headers:{Authorization:_e,"Content-Type":"application/json"},body:JSON.stringify({text:r})});if(!D.ok){let $=await D.text();return console.error("Twitter API error:",D.status,$),{success:!1,error:`Twitter API error: ${D.status}`}}let oe=await D.json(),J=oe.data?.id;return{success:!0,tweet_id:J,url:J?`https://x.com/i/status/${J}`:void 0}}catch(n){return console.error("postToTwitter error:",n),{success:!1,error:String(n)}}}async function A(r,t,n,i){try{let p=i.TELEGRAM_BOT_TOKEN,g=i.TELEGRAM_CHAT_ID;if(!p||!g)return;let f=`Posted to @${r==="onde"?"Onde_FRH":r==="frh"?"FreeRiverHouse":"magmatic__"}:

${t.substring(0,100)}...

${n}`;await fetch(`https://api.telegram.org/bot${p}/sendMessage`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({chat_id:g,text:f,disable_web_page_preview:!1})})}catch(p){console.error("Telegram notify error:",p)}}async function C(){return L()}async function I(r){return L((await r.json().catch(()=>({}))).post_id)}async function L(r){try{let{env:t}=(0,v.getRequestContext)(),n=t.DB;if(!n)return m.xk.json({error:"Database not available"},{status:500});let i=`
      SELECT * FROM posts
      WHERE status = 'approved'
      AND auto_post = 1
      AND posted_at IS NULL
    `,p=[];r&&(i+=" AND id = ?",p.push(r)),i+=" ORDER BY approved_at ASC LIMIT 5";let g=(await n.prepare(i).bind(...p).all()).results||[];if(g.length===0)return m.xk.json({success:!0,message:"No approved posts to process",processed:0});let f=[];for(let h of g){let T=function(G,j){let M=G==="onde"?"ONDE":G==="frh"?"FREERIVERHOUSE":"MAGMATIC";return{apiKey:j[`X_${M}_API_KEY`],apiSecret:j[`X_${M}_API_SECRET`],accessToken:j[`X_${M}_ACCESS_TOKEN`],accessTokenSecret:j[`X_${M}_ACCESS_TOKEN_SECRET`]}}(h.account,t);if(!T.apiKey||!T.accessToken){console.error(`Missing Twitter credentials for account: ${h.account}`),f.push({id:h.id,success:!1,error:"Missing credentials"});continue}let w=await N(h.content,T);if(w.success&&w.url){await n.prepare(`
          UPDATE posts
          SET status = 'posted', posted_at = ?, post_url = ?, twitter_post_id = ?, posted_from = 'auto'
          WHERE id = ?
        `).bind(new Date().toISOString(),w.url,w.tweet_id,h.id).run();try{await n.prepare(`
            INSERT INTO activity_log (type, title, description, actor, created_at)
            VALUES ('post_posted', ?, ?, 'auto-post', ?)
          `).bind(`Posted to @${h.account}`,w.url,new Date().toISOString()).run()}catch{}await A(h.account,h.content,w.url,t),f.push({id:h.id,success:!0,url:w.url})}else await n.prepare(`
          UPDATE posts SET error = ? WHERE id = ?
        `).bind(w.error||"Unknown error",h.id).run(),f.push({id:h.id,success:!1,error:w.error})}return m.xk.json({success:!0,processed:f.length,results:f})}catch(t){return console.error("Auto-post error:",t),m.xk.json({error:"Auto-post failed"},{status:500})}}let P=new y.AppRouteRouteModule({definition:{kind:b.x.APP_ROUTE,page:"/api/pr/auto-post/route",pathname:"/api/pr/auto-post",filename:"route",bundlePath:"app/api/pr/auto-post/route"},resolvedPagePath:"/Users/mattiapetrucciani/CascadeProjects/Onde/apps/surfboard/src/app/api/pr/auto-post/route.ts",nextConfigOutput:"",userland:_}),{requestAsyncStorage:q,staticGenerationAsyncStorage:H,serverHooks:B}=P,W="/api/pr/auto-post/route";function O(){return(0,k.XH)({serverHooks:B,staticGenerationAsyncStorage:H})}let X=a,e=u.a.wrap(P)},7185:le,5822:ge},x=>{var E=_=>x(x.s=_);x.O(0,[241,805],()=>E(5992));var o=x.O();(d._ENTRIES=typeof d._ENTRIES>"u"?{}:d._ENTRIES)["middleware_app/api/pr/auto-post/route"]=o}]),function(){let x={exports:{},loaded:!1};return function(o,_){"use strict";var a=Object.defineProperty,u=Object.getOwnPropertyDescriptor,y=Object.getOwnPropertyNames,b=Object.prototype.hasOwnProperty,k=(e,r)=>{for(var t in r)a(e,t,{get:r[t],enumerable:!0})},m=(e,r,t,n)=>{if(r&&typeof r=="object"||typeof r=="function")for(let i of y(r))!b.call(e,i)&&i!==t&&a(e,i,{get:()=>r[i],enumerable:!(n=u(r,i))||n.enumerable});return e},v=e=>m(a({},"__esModule",{value:!0}),e),S={};k(S,{default:()=>W}),o.exports=v(S);var N=(Q(),ue(K)),A="@next/request-context",C=Symbol.for(A),I=Symbol.for("internal.storage");function L(){let e=d;if(!e[C]){let r=new N.AsyncLocalStorage,t={get:()=>r.getStore(),[I]:r};e[C]=t}return e[C]}var P=L();function q(e,r){return P[I].run(e,r)}function H(e){let r={};return e&&e.forEach((t,n)=>{r[n]=t,n.toLowerCase()==="set-cookie"&&(r[n]=B(t))}),r}function B(e){let r=[],t=0,n,i,p,g,f;function h(){for(;t<e.length&&/\s/.test(e.charAt(t));)t+=1;return t<e.length}function T(){return i=e.charAt(t),i!=="="&&i!==";"&&i!==","}for(;t<e.length;){for(n=t,f=!1;h();)if(i=e.charAt(t),i===","){for(p=t,t+=1,h(),g=t;t<e.length&&T();)t+=1;t<e.length&&e.charAt(t)==="="?(f=!0,t=g,r.push(e.substring(n,p)),n=t):t=p+1}else t+=1;(!f||t>=e.length)&&r.push(e.substring(n,e.length))}return r}function W(e){let r=e.staticRoutes.map(n=>({regexp:new RegExp(n.namedRegex),page:n.page})),t=e.dynamicRoutes?.map(n=>({regexp:new RegExp(n.namedRegex),page:n.page}))||[];return async function(n,i){let p=new URL(n.url).pathname,g={};if(e.nextConfig?.basePath&&p.startsWith(e.nextConfig.basePath)&&(p=p.replace(e.nextConfig.basePath,"")||"/"),e.nextConfig?.i18n)for(let h of e.nextConfig.i18n.locales){let T=new RegExp(`^/${h}($|/)`,"i");if(p.match(T)){p=p.replace(T,"/")||"/";break}}for(let h of r)if(h.regexp.exec(p)){g.name=h.page;break}if(!g.name){let h=X(p);for(let T of t||[]){if(h&&!X(T.page))continue;let w=T.regexp.exec(p);if(w){g={name:T.page,params:w.groups};break}}}let f=await q({waitUntil:i.waitUntil},()=>d._ENTRIES[`middleware_${e.name}`].default.call({},{request:{url:n.url,method:n.method,headers:H(n.headers),ip:O(n.headers,"x-real-ip"),geo:{city:O(n.headers,"x-vercel-ip-city",!0),country:O(n.headers,"x-vercel-ip-country",!0),latitude:O(n.headers,"x-vercel-ip-latitude"),longitude:O(n.headers,"x-vercel-ip-longitude"),region:O(n.headers,"x-vercel-ip-country-region",!0)},nextConfig:e.nextConfig,page:g,body:n.body}}));return f.waitUntil&&i.waitUntil(f.waitUntil),f.response}}function O(e,r,t=!1){let n=e.get(r)||void 0;return t&&n?decodeURIComponent(n):n}function X(e){return e==="/api"||e.startsWith("/api/")}}(x,x.exports),x.exports}.call({}).default({name:"app/api/pr/auto-post/route",staticRoutes:[{page:"/",regex:"^/(?:/)?$",routeKeys:{},namedRegex:"^/(?:/)?$"},{page:"/_not-found",regex:"^/_not\\-found(?:/)?$",routeKeys:{},namedRegex:"^/_not\\-found(?:/)?$"},{page:"/coming-soon",regex:"^/coming\\-soon(?:/)?$",routeKeys:{},namedRegex:"^/coming\\-soon(?:/)?$"},{page:"/corde",regex:"^/corde(?:/)?$",routeKeys:{},namedRegex:"^/corde(?:/)?$"},{page:"/frh",regex:"^/frh(?:/)?$",routeKeys:{},namedRegex:"^/frh(?:/)?$"},{page:"/house",regex:"^/house(?:/)?$",routeKeys:{},namedRegex:"^/house(?:/)?$"},{page:"/login",regex:"^/login(?:/)?$",routeKeys:{},namedRegex:"^/login(?:/)?$"},{page:"/pr",regex:"^/pr(?:/)?$",routeKeys:{},namedRegex:"^/pr(?:/)?$"},{page:"/social",regex:"^/social(?:/)?$",routeKeys:{},namedRegex:"^/social(?:/)?$"}],dynamicRoutes:[{page:"/api/agent-tasks/[id]",regex:"^/api/agent\\-tasks/([^/]+?)(?:/)?$",routeKeys:{nxtPid:"nxtPid"},namedRegex:"^/api/agent\\-tasks/(?<nxtPid>[^/]+?)(?:/)?$"},{page:"/api/auth/[...nextauth]",regex:"^/api/auth/(.+?)(?:/)?$",routeKeys:{nxtPnextauth:"nxtPnextauth"},namedRegex:"^/api/auth/(?<nxtPnextauth>.+?)(?:/)?$"},{page:"/api/pr/posts/[id]/approve",regex:"^/api/pr/posts/([^/]+?)/approve(?:/)?$",routeKeys:{nxtPid:"nxtPid"},namedRegex:"^/api/pr/posts/(?<nxtPid>[^/]+?)/approve(?:/)?$"},{page:"/api/pr/posts/[id]/feedback",regex:"^/api/pr/posts/([^/]+?)/feedback(?:/)?$",routeKeys:{nxtPid:"nxtPid"},namedRegex:"^/api/pr/posts/(?<nxtPid>[^/]+?)/feedback(?:/)?$"}],nextConfig:{basePath:""}})))(l,l,l);export{Nt as default};
