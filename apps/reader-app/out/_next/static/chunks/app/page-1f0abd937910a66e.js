(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{8791:(e,t,a)=>{Promise.resolve().then(a.bind(a,8717))},8717:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>C});var s=a(5155),n=a(9827),r=a(709);let i={theme:"light",fontSize:18,fontFamily:"serif",lineHeight:1.8,marginSize:"medium"},l=[{id:"pride-prejudice",title:"Pride and Prejudice",author:"Jane Austen",cover:"https://www.gutenberg.org/cache/epub/1342/pg1342.cover.medium.jpg",progress:0},{id:"moby-dick",title:"Moby Dick",author:"Herman Melville",cover:"https://www.gutenberg.org/cache/epub/2701/pg2701.cover.medium.jpg",progress:0},{id:"frankenstein",title:"Frankenstein",author:"Mary Shelley",cover:"https://www.gutenberg.org/cache/epub/84/pg84.cover.medium.jpg",progress:0}],o=(0,n.v)()((0,r.Zr)((e,t)=>({currentBook:null,books:l,highlights:[],bookmarks:[],settings:i,isSettingsOpen:!1,isTocOpen:!1,setCurrentBook:t=>e({currentBook:t}),addBook:t=>e(e=>({books:[...e.books,t]})),removeBook:t=>e(e=>({books:e.books.filter(e=>e.id!==t)})),updateBookProgress:(t,a,s,n)=>e(e=>{var r;return{books:e.books.map(e=>e.id===t?{...e,progress:a,currentCfi:null!=s?s:e.currentCfi,currentLocation:null!=n?n:e.currentLocation,lastRead:Date.now()}:e),currentBook:(null===(r=e.currentBook)||void 0===r?void 0:r.id)===t?{...e.currentBook,progress:a,currentCfi:null!=s?s:e.currentBook.currentCfi,currentLocation:null!=n?n:e.currentBook.currentLocation}:e.currentBook}}),addHighlight:t=>e(e=>({highlights:[...e.highlights,{...t,id:crypto.randomUUID(),createdAt:Date.now()}]})),removeHighlight:t=>e(e=>({highlights:e.highlights.filter(e=>e.id!==t)})),addBookmark:t=>e(e=>({bookmarks:[...e.bookmarks,{...t,id:crypto.randomUUID(),createdAt:Date.now()}]})),removeBookmark:t=>e(e=>({bookmarks:e.bookmarks.filter(e=>e.id!==t)})),updateSettings:t=>e(e=>({settings:{...e.settings,...t}})),toggleSettings:()=>e(e=>({isSettingsOpen:!e.isSettingsOpen})),toggleToc:()=>e(e=>({isTocOpen:!e.isTocOpen}))}),{name:"onde-reader-storage",partialize:e=>({books:e.books,highlights:e.highlights,bookmarks:e.bookmarks,settings:e.settings})}));var c=a(2115);let d="epubs";function h(){return new Promise((e,t)=>{let a=indexedDB.open("onde-reader-db",1);a.onerror=()=>t(a.error),a.onupgradeneeded=()=>{let e=a.result;e.objectStoreNames.contains(d)||e.createObjectStore(d,{keyPath:"id"})},a.onsuccess=()=>e(a.result)})}async function u(e,t){let a=await h();return new Promise((s,n)=>{let r=a.transaction(d,"readwrite");r.objectStore(d).put({id:e,data:t}),r.oncomplete=()=>{a.close(),s()},r.onerror=()=>{a.close(),n(r.error)}})}async function m(e){let t=await h();return new Promise((a,s)=>{let n=t.transaction(d,"readonly").objectStore(d).get(e);n.onsuccess=()=>{var e;t.close();let s=n.result;a(null!==(e=null==s?void 0:s.data)&&void 0!==e?e:null)},n.onerror=()=>{t.close(),s(n.error)}})}function g(){let{books:e,setCurrentBook:t,addBook:a,settings:n}=o(),[r,i]=(0,c.useState)(!1),l=(0,c.useRef)(null),d=e=>{t(e)},h=async e=>{var s;let n=null===(s=e.target.files)||void 0===s?void 0:s[0];if(n){i(!0);try{let e={id:crypto.randomUUID(),title:n.name.replace(".epub",""),author:"Unknown Author",progress:0},s=await n.arrayBuffer();await u(e.id,s),a(e),t(e)}catch(e){console.error("Failed to upload book:",e)}finally{i(!1)}}};return(0,s.jsxs)("div",{className:"min-h-screen p-8 ".concat("dark"===n.theme?"bg-gray-900 text-white":"sepia"===n.theme?"bg-sepia-100 text-sepia-900":"bg-gray-50 text-gray-900"),children:[(0,s.jsx)("header",{className:"max-w-6xl mx-auto mb-12",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-4xl font-bold tracking-tight",children:"\uD83D\uDCDA Library"}),(0,s.jsx)("p",{className:"text-lg opacity-70 mt-2",children:"Your personal reading collection"})]}),(0,s.jsx)("button",{onClick:()=>{var e;return null===(e=l.current)||void 0===e?void 0:e.click()},disabled:r,className:"flex items-center gap-2 px-6 py-3 bg-blue-600 text-white rounded-xl hover:bg-blue-700 transition-colors disabled:opacity-50",children:r?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:"animate-spin",children:"⏳"}),"Uploading..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{children:"➕"}),"Add Book"]})}),(0,s.jsx)("input",{ref:l,type:"file",accept:".epub",onChange:h,className:"hidden"})]})}),e.some(e=>e.progress>0)&&(0,s.jsxs)("section",{className:"max-w-6xl mx-auto mb-12",children:[(0,s.jsx)("h2",{className:"text-2xl font-semibold mb-6",children:"\uD83D\uDCD6 Continue Reading"}),(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:e.filter(e=>e.progress>0&&e.progress<100).sort((e,t)=>(t.lastRead||0)-(e.lastRead||0)).slice(0,3).map(e=>(0,s.jsx)(x,{book:e,onClick:d},e.id))})]}),(0,s.jsxs)("section",{className:"max-w-6xl mx-auto",children:[(0,s.jsx)("h2",{className:"text-2xl font-semibold mb-6",children:"\uD83D\uDCDA All Books"}),(0,s.jsxs)("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-6",children:[e.map(e=>(0,s.jsx)(b,{book:e,onClick:d},e.id)),(0,s.jsxs)("button",{onClick:()=>{var e;return null===(e=l.current)||void 0===e?void 0:e.click()},className:"aspect-[2/3] rounded-xl border-2 border-dashed border-gray-300 dark:border-gray-700 flex flex-col items-center justify-center gap-3 hover:border-blue-500 hover:bg-blue-50 dark:hover:bg-blue-900/20 transition-colors",children:[(0,s.jsx)("span",{className:"text-4xl",children:"➕"}),(0,s.jsx)("span",{className:"text-sm opacity-70",children:"Add EPUB"})]})]})]})]})}function b(e){let{book:t,onClick:a}=e;return(0,s.jsxs)("button",{onClick:()=>a(t),className:"group relative aspect-[2/3] rounded-xl overflow-hidden shadow-lg hover:shadow-xl transition-all hover:-translate-y-1",children:[t.cover?(0,s.jsx)("img",{src:t.cover,alt:t.title,className:"w-full h-full object-cover"}):(0,s.jsx)("div",{className:"w-full h-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center p-4",children:(0,s.jsx)("span",{className:"text-white text-center font-medium line-clamp-3",children:t.title})}),t.progress>0&&(0,s.jsx)("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-black/20",children:(0,s.jsx)("div",{className:"h-full bg-green-500",style:{width:"".concat(t.progress,"%")}})}),(0,s.jsxs)("div",{className:"absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity flex flex-col items-center justify-center p-4",children:[(0,s.jsx)("span",{className:"text-white text-center font-medium line-clamp-2",children:t.title}),(0,s.jsx)("span",{className:"text-white/70 text-sm mt-1",children:t.author}),t.progress>0&&(0,s.jsxs)("span",{className:"text-green-400 text-sm mt-2",children:[Math.round(t.progress),"% complete"]})]})]})}function x(e){let{book:t,onClick:a}=e;return(0,s.jsxs)("button",{onClick:()=>a(t),className:"flex gap-4 p-4 bg-white dark:bg-gray-800 rounded-xl shadow-md hover:shadow-lg transition-all hover:-translate-y-1",children:[(0,s.jsx)("div",{className:"w-20 h-28 rounded-lg overflow-hidden flex-shrink-0",children:t.cover?(0,s.jsx)("img",{src:t.cover,alt:t.title,className:"w-full h-full object-cover"}):(0,s.jsx)("div",{className:"w-full h-full bg-gradient-to-br from-blue-500 to-purple-600"})}),(0,s.jsxs)("div",{className:"flex-1 text-left",children:[(0,s.jsx)("h3",{className:"font-semibold line-clamp-2",children:t.title}),(0,s.jsx)("p",{className:"text-sm opacity-70",children:t.author}),(0,s.jsxs)("div",{className:"mt-3",children:[(0,s.jsx)("div",{className:"h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:(0,s.jsx)("div",{className:"h-full bg-gradient-to-r from-blue-500 to-purple-500",style:{width:"".concat(t.progress,"%")}})}),(0,s.jsxs)("p",{className:"text-xs opacity-60 mt-1",children:[Math.round(t.progress),"% complete"]})]})]})]})}function p(){let{settings:e,updateSettings:t,toggleSettings:a}=o();return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"fixed inset-0 bg-black/50 z-50",onClick:a}),(0,s.jsx)("div",{className:"fixed bottom-0 left-0 right-0 z-50 rounded-t-3xl shadow-2xl p-6 ".concat("dark"===e.theme?"bg-gray-800 text-white":"sepia"===e.theme?"bg-sepia-200 text-sepia-900":"bg-white text-gray-900"),children:(0,s.jsxs)("div",{className:"max-w-lg mx-auto",children:[(0,s.jsx)("div",{className:"w-12 h-1.5 bg-gray-300 dark:bg-gray-600 rounded-full mx-auto mb-6"}),(0,s.jsx)("h3",{className:"text-lg font-semibold mb-6",children:"Reading Settings"}),(0,s.jsxs)("div",{className:"mb-8",children:[(0,s.jsx)("label",{className:"text-sm font-medium opacity-70 mb-3 block",children:"Theme"}),(0,s.jsx)("div",{className:"flex gap-3",children:[{id:"light",label:"Light",icon:"☀️"},{id:"dark",label:"Dark",icon:"\uD83C\uDF19"},{id:"sepia",label:"Sepia",icon:"\uD83D\uDCDC"}].map(a=>(0,s.jsxs)("button",{onClick:()=>t({theme:a.id}),className:"flex-1 py-3 px-4 rounded-xl flex flex-col items-center gap-2 transition-all ".concat(e.theme===a.id?"ring-2 ring-blue-500 bg-blue-50 dark:bg-blue-900/30":"bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600"),children:[(0,s.jsx)("span",{className:"text-2xl",children:a.icon}),(0,s.jsx)("span",{className:"text-sm",children:a.label})]},a.id))})]}),(0,s.jsxs)("div",{className:"mb-8",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,s.jsx)("label",{className:"text-sm font-medium opacity-70",children:"Font Size"}),(0,s.jsxs)("span",{className:"text-sm font-mono",children:[e.fontSize,"px"]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsx)("span",{className:"text-sm",children:"A"}),(0,s.jsx)("input",{type:"range",min:"14",max:"28",value:e.fontSize,onChange:e=>t({fontSize:parseInt(e.target.value)}),className:"flex-1 h-2 bg-gray-200 dark:bg-gray-700 rounded-lg appearance-none cursor-pointer accent-blue-500"}),(0,s.jsx)("span",{className:"text-xl",children:"A"})]})]}),(0,s.jsxs)("div",{className:"mb-8",children:[(0,s.jsx)("label",{className:"text-sm font-medium opacity-70 mb-3 block",children:"Font Style"}),(0,s.jsxs)("div",{className:"flex gap-3",children:[(0,s.jsx)("button",{onClick:()=>t({fontFamily:"serif"}),className:"flex-1 py-3 px-4 rounded-xl font-serif transition-all ".concat("serif"===e.fontFamily?"ring-2 ring-blue-500 bg-blue-50 dark:bg-blue-900/30":"bg-gray-100 dark:bg-gray-700"),children:"Serif"}),(0,s.jsx)("button",{onClick:()=>t({fontFamily:"sans"}),className:"flex-1 py-3 px-4 rounded-xl font-sans transition-all ".concat("sans"===e.fontFamily?"ring-2 ring-blue-500 bg-blue-50 dark:bg-blue-900/30":"bg-gray-100 dark:bg-gray-700"),children:"Sans-Serif"})]})]}),(0,s.jsxs)("div",{className:"mb-8",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,s.jsx)("label",{className:"text-sm font-medium opacity-70",children:"Line Spacing"}),(0,s.jsx)("span",{className:"text-sm font-mono",children:e.lineHeight.toFixed(1)})]}),(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsx)("span",{className:"text-xs opacity-50",children:"Tight"}),(0,s.jsx)("input",{type:"range",min:"1.4",max:"2.2",step:"0.1",value:e.lineHeight,onChange:e=>t({lineHeight:parseFloat(e.target.value)}),className:"flex-1 h-2 bg-gray-200 dark:bg-gray-700 rounded-lg appearance-none cursor-pointer accent-blue-500"}),(0,s.jsx)("span",{className:"text-xs opacity-50",children:"Loose"})]})]}),(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("label",{className:"text-sm font-medium opacity-70 mb-3 block",children:"Page Margins"}),(0,s.jsx)("div",{className:"flex gap-3",children:["small","medium","large"].map(a=>(0,s.jsx)("button",{onClick:()=>t({marginSize:a}),className:"flex-1 py-3 px-4 rounded-xl capitalize transition-all ".concat(e.marginSize===a?"ring-2 ring-blue-500 bg-blue-50 dark:bg-blue-900/30":"bg-gray-100 dark:bg-gray-700"),children:a},a))})]}),(0,s.jsx)("button",{onClick:a,className:"w-full py-3 bg-blue-600 text-white rounded-xl font-medium hover:bg-blue-700 transition-colors",children:"Done"})]})})]})}function f(e){let{items:t,currentIndex:a,onSelect:n}=e,{settings:r,toggleToc:i}=o();return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"fixed inset-0 bg-black/50 z-50",onClick:i}),(0,s.jsxs)("div",{className:"fixed left-0 top-0 bottom-0 w-80 max-w-[85vw] z-50 shadow-2xl flex flex-col ".concat("dark"===r.theme?"bg-gray-800 text-white":"sepia"===r.theme?"bg-sepia-200 text-sepia-900":"bg-white text-gray-900"),children:[(0,s.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold",children:"Table of Contents"}),(0,s.jsx)("button",{onClick:i,className:"p-2 rounded-lg hover:bg-black/10 dark:hover:bg-white/10",children:"✕"})]}),(0,s.jsx)("nav",{className:"flex-1 overflow-y-auto p-2",children:t.map((e,t)=>(0,s.jsx)(y,{item:e,index:t,isActive:t===a,onSelect:n,settings:r},e.id))}),(0,s.jsx)("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700",children:(0,s.jsxs)("div",{className:"text-sm opacity-70 text-center",children:[t.length," chapters"]})})]})]})}function y(e){var t;let{item:a,index:n,isActive:r,onSelect:i,settings:l,depth:o=0}=e;return(0,s.jsxs)("div",{style:{paddingLeft:"".concat(16*o,"px")},children:[(0,s.jsx)("button",{onClick:()=>i(n),className:"w-full text-left px-4 py-3 rounded-lg transition-colors mb-1 ".concat(r?"dark"===l.theme?"bg-blue-900/50 text-blue-300":"bg-blue-100 text-blue-700":"hover:bg-black/5 dark:hover:bg-white/5"),children:(0,s.jsxs)("span",{className:"flex items-center gap-3",children:[r&&(0,s.jsx)("span",{className:"w-1.5 h-1.5 bg-blue-500 rounded-full"}),(0,s.jsx)("span",{className:r?"font-medium":"",children:a.label})]})}),null===(t=a.subitems)||void 0===t?void 0:t.map((e,t)=>(0,s.jsx)(y,{item:e,index:n+t+1,isActive:!1,onSelect:i,settings:l,depth:o+1},e.id))]})}let v=[{title:"Chapter 1: The Beginning",content:'It is a truth universally acknowledged, that a single man in possession of a good fortune, must be in want of a wife.\n\nHowever little known the feelings or views of such a man may be on his first entering a neighbourhood, this truth is so well fixed in the minds of the surrounding families, that he is considered the rightful property of some one or other of their daughters.\n\n"My dear Mr. Bennet," said his lady to him one day, "have you heard that Netherfield Park is let at last?"\n\nMr. Bennet replied that he had not.\n\n"But it is," returned she; "for Mrs. Long has just been here, and she told me all about it."\n\nMr. Bennet made no answer.\n\n"Do you not want to know who has taken it?" cried his wife impatiently.\n\n"You want to tell me, and I have no objection to hearing it."\n\nThis was invitation enough.\n\n"Why, my dear, you must know, Mrs. Long says that Netherfield is taken by a young man of large fortune from the north of England; that he came down on Monday in a chaise and four to see the place, and was so much delighted with it, that he agreed with Mr. Morris immediately; that he is to take possession before Michaelmas, and some of his servants are to be in the house by the end of next week."\n\n"What is his name?"\n\n"Bingley."\n\n"Is he married or single?"\n\n"Oh! Single, my dear, to be sure! A single man of large fortune; four or five thousand a year. What a fine thing for our girls!"'},{title:"Chapter 2: First Impressions",content:'Mr. Bennet was among the earliest of those who waited on Mr. Bingley. He had always intended to visit him, though to the last always assuring his wife that he should not go; and till the evening after the visit was paid she had no knowledge of it.\n\nIt was then disclosed in the following manner. Observing his second daughter employed in trimming a hat, he suddenly addressed her with:\n\n"I hope Mr. Bingley will like it, Lizzy."\n\n"We are not in a way to know what Mr. Bingley likes," said her mother resentfully, "since we are not to visit."\n\n"But you forget, mamma," said Elizabeth, "that we shall meet him at the assemblies, and that Mrs. Long promised to introduce him."\n\n"I do not believe Mrs. Long will do any such thing. She has two nieces of her own. She is a selfish, hypocritical woman, and I have no opinion of her."\n\n"No more have I," said Mr. Bennet; "and I am glad to find that you do not depend on her serving you."\n\nMrs. Bennet deigned not to make any reply, but, unable to contain herself, began scolding one of her daughters.\n\n"Don\'t keep coughing so, Kitty, for Heaven\'s sake! Have a little compassion on my nerves. You tear them to pieces."\n\n"Kitty has no discretion in her coughs," said her father; "she times them ill."\n\n"I do not cough for my own amusement," replied Kitty fretfully.'},{title:"Chapter 3: The Ball",content:'Not all that Mrs. Bennet, however, with the assistance of her five daughters, could ask on the subject, was sufficient to draw from her husband any satisfactory description of Mr. Bingley.\n\nThey attacked him in various ways—with barefaced questions, ingenious suppositions, and distant surmises; but he eluded the skill of them all, and they were at last obliged to accept the second-hand intelligence of their neighbour, Lady Lucas.\n\nHer report was highly favourable. Sir William had been delighted with him. He was quite young, wonderfully handsome, extremely agreeable, and, to crown the whole, he meant to be at the next assembly with a large party.\n\nNothing could be more delightful! To be fond of dancing was a certain step towards falling in love; and very lively hopes of Mr. Bingley\'s heart were entertained.\n\n"If I can but see one of my daughters happily settled at Netherfield," said Mrs. Bennet to her husband, "and all the others equally well married, I shall have nothing to wish for."\n\nIn a few days Mr. Bingley returned Mr. Bennet\'s visit, and sat about ten minutes with him in his library. He had entertained hopes of being admitted to a sight of the young ladies, of whose beauty he had heard much; but he saw only the father.\n\nThe ladies were somewhat more fortunate, for they had the advantage of ascertaining from an upper window that he wore a blue coat, and rode a black horse.'}];function k(){let{currentBook:e,setCurrentBook:t,updateBookProgress:a,settings:n,isSettingsOpen:r,isTocOpen:i,toggleSettings:l,toggleToc:d}=o(),[h,u]=(0,c.useState)(0),[m,g]=(0,c.useState)([]),[b,x]=(0,c.useState)(!0),y=(0,c.useRef)(null),k=(0,c.useRef)(null),w=(0,c.useRef)(0),j=(0,c.useRef)(0),N=v.length,C=(h+1)/N*100;(0,c.useEffect)(()=>{e&&a(e.id,C)},[C,e,a]),(0,c.useEffect)(()=>{g(v.map((e,t)=>({id:"ch-".concat(t),href:"#ch-".concat(t),label:e.title})))},[]);let S=(0,c.useCallback)(()=>{h>0&&u(e=>e-1)},[h]),B=(0,c.useCallback)(()=>{h<N-1&&u(e=>e+1)},[h,N]);(0,c.useEffect)(()=>{let e=e=>{"ArrowLeft"===e.key||"ArrowUp"===e.key?S():"ArrowRight"===e.key||"ArrowDown"===e.key||" "===e.key?(e.preventDefault(),B()):"Escape"===e.key&&t(null)};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[S,B,t]);let D={light:"bg-white text-gray-900",dark:"bg-gray-900 text-gray-100",sepia:"bg-sepia-100 text-sepia-900"};return(0,s.jsxs)("div",{className:"min-h-screen ".concat(D[n.theme]," transition-colors duration-300"),onClick:()=>{x(!0),y.current&&clearTimeout(y.current),y.current=setTimeout(()=>{x(!1)},3e3)},onTouchStart:e=>{w.current=e.touches[0].clientX},onTouchEnd:e=>{j.current=e.changedTouches[0].clientX;let t=w.current-j.current;Math.abs(t)>50&&(t>0?B():S())},ref:k,children:[(0,s.jsx)("div",{className:"fixed top-0 left-0 right-0 z-50",children:(0,s.jsx)("div",{className:"progress-bar",style:{width:"".concat(C,"%")}})}),(0,s.jsx)("header",{className:"fixed top-0 left-0 right-0 z-40 transition-transform duration-300 ".concat(b?"translate-y-0":"-translate-y-full"),children:(0,s.jsx)("div",{className:"".concat(D[n.theme]," bg-opacity-95 backdrop-blur-sm shadow-md"),children:(0,s.jsxs)("div",{className:"flex items-center justify-between px-4 py-3",children:[(0,s.jsx)("button",{onClick:e=>{e.stopPropagation(),t(null)},className:"p-2 rounded-lg hover:bg-black/10 dark:hover:bg-white/10",children:"← Library"}),(0,s.jsxs)("div",{className:"flex-1 text-center px-4",children:[(0,s.jsx)("h1",{className:"font-semibold truncate",children:null==e?void 0:e.title}),(0,s.jsx)("p",{className:"text-sm opacity-70",children:v[h].title})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("button",{onClick:e=>{e.stopPropagation(),d()},className:"p-2 rounded-lg hover:bg-black/10 dark:hover:bg-white/10",title:"Table of Contents",children:"\uD83D\uDCD6"}),(0,s.jsx)("button",{onClick:e=>{e.stopPropagation(),l()},className:"p-2 rounded-lg hover:bg-black/10 dark:hover:bg-white/10",title:"Settings",children:"⚙️"})]})]})})}),(0,s.jsx)("main",{className:"min-h-screen pt-20 pb-24 ".concat({small:"px-4 md:px-8",medium:"px-8 md:px-16 lg:px-24",large:"px-12 md:px-24 lg:px-32"}[n.marginSize]," reader-scroll"),children:(0,s.jsxs)("article",{className:"max-w-3xl mx-auto reader-content",style:{fontSize:"".concat(n.fontSize,"px"),lineHeight:n.lineHeight,fontFamily:"serif"===n.fontFamily?'Georgia, Cambria, "Times New Roman", serif':"system-ui, -apple-system, sans-serif"},children:[(0,s.jsx)("h2",{className:"text-2xl font-bold mb-8 text-center",children:v[h].title}),v[h].content.split("\n\n").map((e,t)=>(0,s.jsx)("p",{className:"mb-4",children:e},t))]})}),(0,s.jsx)("footer",{className:"fixed bottom-0 left-0 right-0 z-40 transition-transform duration-300 ".concat(b?"translate-y-0":"translate-y-full"),children:(0,s.jsx)("div",{className:"".concat(D[n.theme]," bg-opacity-95 backdrop-blur-sm shadow-[0_-2px_10px_rgba(0,0,0,0.1)]"),children:(0,s.jsxs)("div",{className:"flex items-center justify-between px-4 py-3",children:[(0,s.jsx)("button",{onClick:e=>{e.stopPropagation(),S()},disabled:0===h,className:"px-4 py-2 rounded-lg hover:bg-black/10 dark:hover:bg-white/10 disabled:opacity-30",children:"← Prev"}),(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsxs)("p",{className:"text-sm opacity-70",children:["Chapter ",h+1," of ",N]}),(0,s.jsxs)("p",{className:"text-xs opacity-50",children:[Math.round(C),"% complete"]})]}),(0,s.jsx)("button",{onClick:e=>{e.stopPropagation(),B()},disabled:h===N-1,className:"px-4 py-2 rounded-lg hover:bg-black/10 dark:hover:bg-white/10 disabled:opacity-30",children:"Next →"})]})})}),r&&(0,s.jsx)(p,{}),i&&(0,s.jsx)(f,{items:m,currentIndex:h,onSelect:e=>{u(e),d()}})]})}var w=a(2569);function j(e){let{bookUrl:t,bookId:a}=e,{currentBook:n,setCurrentBook:r,updateBookProgress:i,settings:l,isSettingsOpen:d,isTocOpen:h,toggleSettings:u,toggleToc:m,addBook:g,books:b}=o(),[x,y]=(0,c.useState)(!0),[v,k]=(0,c.useState)(null),[j,N]=(0,c.useState)([]),[C,S]=(0,c.useState)(!0),[B,D]=(0,c.useState)(0),[M,L]=(0,c.useState)(""),[z,T]=(0,c.useState)(0),[A,P]=(0,c.useState)(0),R=(0,c.useRef)(null),E=(0,c.useRef)(null),U=(0,c.useRef)(null),I=(0,c.useRef)(null),F=e=>e.map((e,t)=>({id:"toc-".concat(t),href:e.href,label:e.label,subitems:e.subitems?F(e.subitems):void 0})),H=(0,c.useCallback)(()=>{if(!U.current)return;let e={light:{background:"#ffffff",color:"#1a1a1a"},dark:{background:"#1a1a1a",color:"#f0f0f0"},sepia:{background:"#f4ecd8",color:"#5c4a32"}};U.current.themes.override("color",e[l.theme].color),U.current.themes.override("background",e[l.theme].background),U.current.themes.override("font-size","".concat(l.fontSize,"px")),U.current.themes.override("line-height","".concat(l.lineHeight)),U.current.themes.override("font-family","serif"===l.fontFamily?'Georgia, Cambria, "Times New Roman", serif':"system-ui, -apple-system, sans-serif")},[l]);(0,c.useEffect)(()=>{if(R.current)return(async()=>{try{y(!0),k(null),U.current&&U.current.destroy(),E.current&&E.current.destroy();let e=(0,w.Ay)(t);E.current=e,await e.ready;let s=await e.loaded.metadata,n=await e.coverUrl(),l=b.find(e=>e.id===a);l||g({id:a,title:s.title||"Unknown Title",author:s.creator||"Unknown Author",cover:n||void 0,progress:0}),r({id:a,title:s.title||"Unknown Title",author:s.creator||"Unknown Author",cover:n||void 0,progress:(null==l?void 0:l.progress)||0,currentCfi:null==l?void 0:l.currentCfi});let o=await e.loaded.navigation;N(F(o.toc)),await e.locations.generate(1024),P(e.locations.length());let c=e.renderTo(R.current,{width:"100%",height:"100%",spread:"none",flow:"paginated"});U.current=c,H(),c.on("locationChanged",t=>{let s=e.locations.locationFromCfi(t.start.cfi),n=e.locations.length(),r=Math.round(s/n*100);D(r),T(s);let l=e.spine.get(t.start.cfi);if(l){let e=o.toc.find(e=>e.href===l.href||e.href.startsWith(l.href.split("#")[0]));e&&L(e.label)}i(a,r,t.start.cfi,s)}),(null==l?void 0:l.currentCfi)?await c.display(l.currentCfi):await c.display(),c.on("keyup",e=>{"ArrowLeft"===e.key||"ArrowUp"===e.key?c.prev():("ArrowRight"===e.key||"ArrowDown"===e.key||" "===e.key)&&c.next()}),y(!1)}catch(e){console.error("Error loading EPUB:",e),k("Failed to load book. Please try again."),y(!1)}})(),()=>{U.current&&U.current.destroy(),E.current&&E.current.destroy()}},[t,a]),(0,c.useEffect)(()=>{H()},[l,H]);let O=()=>{var e;null===(e=U.current)||void 0===e||e.prev()},_=()=>{var e;null===(e=U.current)||void 0===e||e.next()};(0,c.useEffect)(()=>{let e=e=>{"ArrowLeft"===e.key||"ArrowUp"===e.key?O():"ArrowRight"===e.key||"ArrowDown"===e.key||" "===e.key?(e.preventDefault(),_()):"Escape"===e.key&&r(null)};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[r]);let W=(0,c.useRef)(0),X={light:"bg-white text-gray-900",dark:"bg-gray-900 text-gray-100",sepia:"bg-sepia-100 text-sepia-900"};return x?(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center ".concat(X[l.theme]),children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"}),(0,s.jsx)("p",{children:"Loading book..."})]})}):v?(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center ".concat(X[l.theme]),children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("p",{className:"text-red-500 mb-4",children:v}),(0,s.jsx)("button",{onClick:()=>r(null),className:"px-4 py-2 bg-blue-500 text-white rounded-lg",children:"Back to Library"})]})}):(0,s.jsxs)("div",{className:"min-h-screen ".concat(X[l.theme]," transition-colors duration-300"),onClick:()=>{S(!0),I.current&&clearTimeout(I.current),I.current=setTimeout(()=>{S(!1)},3e3)},onTouchStart:e=>{W.current=e.touches[0].clientX},onTouchEnd:e=>{let t=e.changedTouches[0].clientX,a=W.current-t;Math.abs(a)>50&&(a>0?_():O())},children:[(0,s.jsx)("div",{className:"fixed top-0 left-0 right-0 z-50",children:(0,s.jsx)("div",{className:"progress-bar",style:{width:"".concat(B,"%")}})}),(0,s.jsx)("header",{className:"fixed top-0 left-0 right-0 z-40 transition-transform duration-300 ".concat(C?"translate-y-0":"-translate-y-full"),children:(0,s.jsx)("div",{className:"".concat(X[l.theme]," bg-opacity-95 backdrop-blur-sm shadow-md"),children:(0,s.jsxs)("div",{className:"flex items-center justify-between px-4 py-3",children:[(0,s.jsx)("button",{onClick:e=>{e.stopPropagation(),r(null)},className:"p-2 rounded-lg hover:bg-black/10 dark:hover:bg-white/10",children:"← Library"}),(0,s.jsxs)("div",{className:"flex-1 text-center px-4",children:[(0,s.jsx)("h1",{className:"font-semibold truncate",children:null==n?void 0:n.title}),(0,s.jsx)("p",{className:"text-sm opacity-70",children:M||"Reading..."})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("button",{onClick:e=>{e.stopPropagation(),m()},className:"p-2 rounded-lg hover:bg-black/10 dark:hover:bg-white/10",title:"Table of Contents",children:"\uD83D\uDCD6"}),(0,s.jsx)("button",{onClick:e=>{e.stopPropagation(),u()},className:"p-2 rounded-lg hover:bg-black/10 dark:hover:bg-white/10",title:"Settings",children:"⚙️"})]})]})})}),(0,s.jsx)("main",{className:"fixed inset-0 pt-16 pb-16",children:(0,s.jsx)("div",{ref:R,className:"w-full h-full",style:{padding:"small"===l.marginSize?"0 16px":"medium"===l.marginSize?"0 32px":"0 48px"}})}),(0,s.jsx)("footer",{className:"fixed bottom-0 left-0 right-0 z-40 transition-transform duration-300 ".concat(C?"translate-y-0":"translate-y-full"),children:(0,s.jsx)("div",{className:"".concat(X[l.theme]," bg-opacity-95 backdrop-blur-sm shadow-[0_-2px_10px_rgba(0,0,0,0.1)]"),children:(0,s.jsxs)("div",{className:"flex items-center justify-between px-4 py-3",children:[(0,s.jsx)("button",{onClick:e=>{e.stopPropagation(),O()},className:"px-4 py-2 rounded-lg hover:bg-black/10 dark:hover:bg-white/10",children:"← Prev"}),(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsxs)("p",{className:"text-sm opacity-70",children:[z," / ",A]}),(0,s.jsxs)("p",{className:"text-xs opacity-50",children:[B,"% complete"]})]}),(0,s.jsx)("button",{onClick:e=>{e.stopPropagation(),_()},className:"px-4 py-2 rounded-lg hover:bg-black/10 dark:hover:bg-white/10",children:"Next →"})]})})}),d&&(0,s.jsx)(p,{}),h&&(0,s.jsx)(f,{items:j,currentIndex:-1,onSelect:e=>{let t=j[e];t&&U.current&&U.current.display(t.href),m()}})]})}let N={"pride-prejudice":"https://www.gutenberg.org/ebooks/1342.epub.noimages","moby-dick":"https://www.gutenberg.org/ebooks/2701.epub.noimages",frankenstein:"https://www.gutenberg.org/ebooks/84.epub.noimages"};function C(){let{currentBook:e}=o(),[t,a]=(0,c.useState)(null),[n,r]=(0,c.useState)(!1);return((0,c.useEffect)(()=>{if(!e){(null==t?void 0:t.startsWith("blob:"))&&URL.revokeObjectURL(t),a(null);return}(async()=>{r(!0);try{let t=await m(e.id);if(t){a(function(e){let t=new Blob([e],{type:"application/epub+zip"});return URL.createObjectURL(t)}(t));return}if(N[e.id]){a(N[e.id]);return}a(null)}catch(e){console.error("Error loading EPUB:",e),a(null)}finally{r(!1)}})()},[null==e?void 0:e.id]),(0,c.useEffect)(()=>()=>{(null==t?void 0:t.startsWith("blob:"))&&URL.revokeObjectURL(t)},[t]),e)?n?(0,s.jsx)("main",{className:"min-h-screen bg-gray-100 dark:bg-gray-900 flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"}),(0,s.jsx)("p",{className:"text-gray-600 dark:text-gray-300",children:"Preparing book..."})]})}):t?(0,s.jsx)("main",{className:"min-h-screen bg-gray-100 dark:bg-gray-900",children:(0,s.jsx)(j,{bookUrl:t,bookId:e.id})}):(0,s.jsx)("main",{className:"min-h-screen bg-gray-100 dark:bg-gray-900",children:(0,s.jsx)(k,{})}):(0,s.jsx)("main",{className:"min-h-screen bg-gray-100 dark:bg-gray-900",children:(0,s.jsx)(g,{})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[920,476,441,517,358],()=>t(8791)),_N_E=e.O()}]);