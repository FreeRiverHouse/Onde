(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{8791:(e,t,a)=>{Promise.resolve().then(a.bind(a,2701))},2701:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>z});var r=a(5155),n=a(9827),s=a(709);let l={theme:"light",fontSize:18,fontFamily:"serif",lineHeight:1.8,marginSize:"medium"},i=[{id:"pride-prejudice",title:"Pride and Prejudice",author:"Jane Austen",cover:"https://www.gutenberg.org/cache/epub/1342/pg1342.cover.medium.jpg",progress:0},{id:"moby-dick",title:"Moby Dick",author:"Herman Melville",cover:"https://www.gutenberg.org/cache/epub/2701/pg2701.cover.medium.jpg",progress:0},{id:"frankenstein",title:"Frankenstein",author:"Mary Shelley",cover:"https://www.gutenberg.org/cache/epub/84/pg84.cover.medium.jpg",progress:0}],o=(0,n.v)()((0,s.Zr)((e,t)=>({currentBook:null,books:i,highlights:[],bookmarks:[],vocabulary:[],settings:l,isSettingsOpen:!1,isTocOpen:!1,setCurrentBook:t=>e({currentBook:t}),addBook:t=>e(e=>({books:[...e.books,t]})),removeBook:t=>e(e=>({books:e.books.filter(e=>e.id!==t)})),updateBookProgress:(t,a,r,n)=>e(e=>{var s;return{books:e.books.map(e=>e.id===t?{...e,progress:a,currentCfi:null!=r?r:e.currentCfi,currentLocation:null!=n?n:e.currentLocation,lastRead:Date.now()}:e),currentBook:(null===(s=e.currentBook)||void 0===s?void 0:s.id)===t?{...e.currentBook,progress:a,currentCfi:null!=r?r:e.currentBook.currentCfi,currentLocation:null!=n?n:e.currentBook.currentLocation}:e.currentBook}}),addHighlight:t=>e(e=>({highlights:[...e.highlights,{...t,id:crypto.randomUUID(),createdAt:Date.now()}]})),removeHighlight:t=>e(e=>({highlights:e.highlights.filter(e=>e.id!==t)})),addBookmark:t=>e(e=>({bookmarks:[...e.bookmarks,{...t,id:crypto.randomUUID(),createdAt:Date.now()}]})),removeBookmark:t=>e(e=>({bookmarks:e.bookmarks.filter(e=>e.id!==t)})),addVocabularyWord:t=>e(e=>e.vocabulary.some(e=>e.word.toLowerCase()===t.word.toLowerCase())?e:{vocabulary:[...e.vocabulary,{...t,id:crypto.randomUUID(),createdAt:Date.now()}]}),removeVocabularyWord:t=>e(e=>({vocabulary:e.vocabulary.filter(e=>e.id!==t)})),updateSettings:t=>e(e=>({settings:{...e.settings,...t}})),toggleSettings:()=>e(e=>({isSettingsOpen:!e.isSettingsOpen})),toggleToc:()=>e(e=>({isTocOpen:!e.isTocOpen}))}),{name:"onde-reader-storage",partialize:e=>({books:e.books,highlights:e.highlights,bookmarks:e.bookmarks,vocabulary:e.vocabulary,settings:e.settings})}));var c=a(2115);let d="epubs";function h(){return new Promise((e,t)=>{let a=indexedDB.open("onde-reader-db",1);a.onerror=()=>t(a.error),a.onupgradeneeded=()=>{let e=a.result;e.objectStoreNames.contains(d)||e.createObjectStore(d,{keyPath:"id"})},a.onsuccess=()=>e(a.result)})}async function u(e,t){let a=await h();return new Promise((r,n)=>{let s=a.transaction(d,"readwrite");s.objectStore(d).put({id:e,data:t}),s.oncomplete=()=>{a.close(),r()},s.onerror=()=>{a.close(),n(s.error)}})}async function g(e){let t=await h();return new Promise((a,r)=>{let n=t.transaction(d,"readonly").objectStore(d).get(e);n.onsuccess=()=>{var e;t.close();let r=n.result;a(null!==(e=null==r?void 0:r.data)&&void 0!==e?e:null)},n.onerror=()=>{t.close(),r(n.error)}})}function m(){let{books:e,setCurrentBook:t,addBook:a,settings:n}=o(),[s,l]=(0,c.useState)(!1),i=(0,c.useRef)(null),d=e=>{t(e)},h=async e=>{var r;let n=null===(r=e.target.files)||void 0===r?void 0:r[0];if(n){l(!0);try{let e={id:crypto.randomUUID(),title:n.name.replace(".epub",""),author:"Unknown Author",progress:0},r=await n.arrayBuffer();await u(e.id,r),a(e),t(e)}catch(e){console.error("Failed to upload book:",e)}finally{l(!1)}}};return(0,r.jsxs)("div",{className:"min-h-screen p-8 ".concat("dark"===n.theme?"bg-gray-900 text-white":"sepia"===n.theme?"bg-sepia-100 text-sepia-900":"bg-gray-50 text-gray-900"),children:[(0,r.jsx)("header",{className:"max-w-6xl mx-auto mb-12",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-4xl font-bold tracking-tight",children:"\uD83D\uDCDA Library"}),(0,r.jsx)("p",{className:"text-lg opacity-70 mt-2",children:"Your personal reading collection"})]}),(0,r.jsx)("button",{onClick:()=>{var e;return null===(e=i.current)||void 0===e?void 0:e.click()},disabled:s,className:"flex items-center gap-2 px-6 py-3 bg-blue-600 text-white rounded-xl hover:bg-blue-700 transition-colors disabled:opacity-50",children:s?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{className:"animate-spin",children:"⏳"}),"Uploading..."]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{children:"➕"}),"Add Book"]})}),(0,r.jsx)("input",{ref:i,type:"file",accept:".epub",onChange:h,className:"hidden"})]})}),e.some(e=>e.progress>0)&&(0,r.jsxs)("section",{className:"max-w-6xl mx-auto mb-12",children:[(0,r.jsx)("h2",{className:"text-2xl font-semibold mb-6",children:"\uD83D\uDCD6 Continue Reading"}),(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:e.filter(e=>e.progress>0&&e.progress<100).sort((e,t)=>(t.lastRead||0)-(e.lastRead||0)).slice(0,3).map(e=>(0,r.jsx)(b,{book:e,onClick:d},e.id))})]}),(0,r.jsxs)("section",{className:"max-w-6xl mx-auto",children:[(0,r.jsx)("h2",{className:"text-2xl font-semibold mb-6",children:"\uD83D\uDCDA All Books"}),(0,r.jsxs)("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-6",children:[e.map(e=>(0,r.jsx)(x,{book:e,onClick:d},e.id)),(0,r.jsxs)("button",{onClick:()=>{var e;return null===(e=i.current)||void 0===e?void 0:e.click()},className:"aspect-[2/3] rounded-xl border-2 border-dashed border-gray-300 dark:border-gray-700 flex flex-col items-center justify-center gap-3 hover:border-blue-500 hover:bg-blue-50 dark:hover:bg-blue-900/20 transition-colors",children:[(0,r.jsx)("span",{className:"text-4xl",children:"➕"}),(0,r.jsx)("span",{className:"text-sm opacity-70",children:"Add EPUB"})]})]})]})]})}function x(e){let{book:t,onClick:a}=e;return(0,r.jsxs)("button",{onClick:()=>a(t),className:"group relative aspect-[2/3] rounded-xl overflow-hidden shadow-lg hover:shadow-xl transition-all hover:-translate-y-1",children:[t.cover?(0,r.jsx)("img",{src:t.cover,alt:t.title,className:"w-full h-full object-cover"}):(0,r.jsx)("div",{className:"w-full h-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center p-4",children:(0,r.jsx)("span",{className:"text-white text-center font-medium line-clamp-3",children:t.title})}),t.progress>0&&(0,r.jsx)("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-black/20",children:(0,r.jsx)("div",{className:"h-full bg-green-500",style:{width:"".concat(t.progress,"%")}})}),(0,r.jsxs)("div",{className:"absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity flex flex-col items-center justify-center p-4",children:[(0,r.jsx)("span",{className:"text-white text-center font-medium line-clamp-2",children:t.title}),(0,r.jsx)("span",{className:"text-white/70 text-sm mt-1",children:t.author}),t.progress>0&&(0,r.jsxs)("span",{className:"text-green-400 text-sm mt-2",children:[Math.round(t.progress),"% complete"]})]})]})}function b(e){let{book:t,onClick:a}=e;return(0,r.jsxs)("button",{onClick:()=>a(t),className:"flex gap-4 p-4 bg-white dark:bg-gray-800 rounded-xl shadow-md hover:shadow-lg transition-all hover:-translate-y-1",children:[(0,r.jsx)("div",{className:"w-20 h-28 rounded-lg overflow-hidden flex-shrink-0",children:t.cover?(0,r.jsx)("img",{src:t.cover,alt:t.title,className:"w-full h-full object-cover"}):(0,r.jsx)("div",{className:"w-full h-full bg-gradient-to-br from-blue-500 to-purple-600"})}),(0,r.jsxs)("div",{className:"flex-1 text-left",children:[(0,r.jsx)("h3",{className:"font-semibold line-clamp-2",children:t.title}),(0,r.jsx)("p",{className:"text-sm opacity-70",children:t.author}),(0,r.jsxs)("div",{className:"mt-3",children:[(0,r.jsx)("div",{className:"h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:(0,r.jsx)("div",{className:"h-full bg-gradient-to-r from-blue-500 to-purple-500",style:{width:"".concat(t.progress,"%")}})}),(0,r.jsxs)("p",{className:"text-xs opacity-60 mt-1",children:[Math.round(t.progress),"% complete"]})]})]})]})}function p(){let{settings:e,updateSettings:t,toggleSettings:a}=o();return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"fixed inset-0 bg-black/50 z-50",onClick:a}),(0,r.jsx)("div",{className:"fixed bottom-0 left-0 right-0 z-50 rounded-t-3xl shadow-2xl p-6 ".concat("dark"===e.theme?"bg-gray-800 text-white":"sepia"===e.theme?"bg-sepia-200 text-sepia-900":"bg-white text-gray-900"),children:(0,r.jsxs)("div",{className:"max-w-lg mx-auto",children:[(0,r.jsx)("div",{className:"w-12 h-1.5 bg-gray-300 dark:bg-gray-600 rounded-full mx-auto mb-6"}),(0,r.jsx)("h3",{className:"text-lg font-semibold mb-6",children:"Reading Settings"}),(0,r.jsxs)("div",{className:"mb-8",children:[(0,r.jsx)("label",{className:"text-sm font-medium opacity-70 mb-3 block",children:"Theme"}),(0,r.jsx)("div",{className:"flex gap-3",children:[{id:"light",label:"Light",icon:"☀️"},{id:"dark",label:"Dark",icon:"\uD83C\uDF19"},{id:"sepia",label:"Sepia",icon:"\uD83D\uDCDC"}].map(a=>(0,r.jsxs)("button",{onClick:()=>t({theme:a.id}),className:"flex-1 py-3 px-4 rounded-xl flex flex-col items-center gap-2 transition-all ".concat(e.theme===a.id?"ring-2 ring-blue-500 bg-blue-50 dark:bg-blue-900/30":"bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600"),children:[(0,r.jsx)("span",{className:"text-2xl",children:a.icon}),(0,r.jsx)("span",{className:"text-sm",children:a.label})]},a.id))})]}),(0,r.jsxs)("div",{className:"mb-8",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,r.jsx)("label",{className:"text-sm font-medium opacity-70",children:"Font Size"}),(0,r.jsxs)("span",{className:"text-sm font-mono",children:[e.fontSize,"px"]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsx)("span",{className:"text-sm",children:"A"}),(0,r.jsx)("input",{type:"range",min:"14",max:"28",value:e.fontSize,onChange:e=>t({fontSize:parseInt(e.target.value)}),className:"flex-1 h-2 bg-gray-200 dark:bg-gray-700 rounded-lg appearance-none cursor-pointer accent-blue-500"}),(0,r.jsx)("span",{className:"text-xl",children:"A"})]})]}),(0,r.jsxs)("div",{className:"mb-8",children:[(0,r.jsx)("label",{className:"text-sm font-medium opacity-70 mb-3 block",children:"Font Style"}),(0,r.jsxs)("div",{className:"flex gap-3",children:[(0,r.jsx)("button",{onClick:()=>t({fontFamily:"serif"}),className:"flex-1 py-3 px-4 rounded-xl font-serif transition-all ".concat("serif"===e.fontFamily?"ring-2 ring-blue-500 bg-blue-50 dark:bg-blue-900/30":"bg-gray-100 dark:bg-gray-700"),children:"Serif"}),(0,r.jsx)("button",{onClick:()=>t({fontFamily:"sans"}),className:"flex-1 py-3 px-4 rounded-xl font-sans transition-all ".concat("sans"===e.fontFamily?"ring-2 ring-blue-500 bg-blue-50 dark:bg-blue-900/30":"bg-gray-100 dark:bg-gray-700"),children:"Sans-Serif"})]})]}),(0,r.jsxs)("div",{className:"mb-8",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,r.jsx)("label",{className:"text-sm font-medium opacity-70",children:"Line Spacing"}),(0,r.jsx)("span",{className:"text-sm font-mono",children:e.lineHeight.toFixed(1)})]}),(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsx)("span",{className:"text-xs opacity-50",children:"Tight"}),(0,r.jsx)("input",{type:"range",min:"1.4",max:"2.2",step:"0.1",value:e.lineHeight,onChange:e=>t({lineHeight:parseFloat(e.target.value)}),className:"flex-1 h-2 bg-gray-200 dark:bg-gray-700 rounded-lg appearance-none cursor-pointer accent-blue-500"}),(0,r.jsx)("span",{className:"text-xs opacity-50",children:"Loose"})]})]}),(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)("label",{className:"text-sm font-medium opacity-70 mb-3 block",children:"Page Margins"}),(0,r.jsx)("div",{className:"flex gap-3",children:["small","medium","large"].map(a=>(0,r.jsx)("button",{onClick:()=>t({marginSize:a}),className:"flex-1 py-3 px-4 rounded-xl capitalize transition-all ".concat(e.marginSize===a?"ring-2 ring-blue-500 bg-blue-50 dark:bg-blue-900/30":"bg-gray-100 dark:bg-gray-700"),children:a},a))})]}),(0,r.jsx)("button",{onClick:a,className:"w-full py-3 bg-blue-600 text-white rounded-xl font-medium hover:bg-blue-700 transition-colors",children:"Done"})]})})]})}function f(e){let{items:t,currentIndex:a,onSelect:n}=e,{settings:s,toggleToc:l}=o();return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"fixed inset-0 bg-black/50 z-50",onClick:l}),(0,r.jsxs)("div",{className:"fixed left-0 top-0 bottom-0 w-80 max-w-[85vw] z-50 shadow-2xl flex flex-col ".concat("dark"===s.theme?"bg-gray-800 text-white":"sepia"===s.theme?"bg-sepia-200 text-sepia-900":"bg-white text-gray-900"),children:[(0,r.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold",children:"Table of Contents"}),(0,r.jsx)("button",{onClick:l,className:"p-2 rounded-lg hover:bg-black/10 dark:hover:bg-white/10",children:"✕"})]}),(0,r.jsx)("nav",{className:"flex-1 overflow-y-auto p-2",children:t.map((e,t)=>(0,r.jsx)(y,{item:e,index:t,isActive:t===a,onSelect:n,settings:s},e.id))}),(0,r.jsx)("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700",children:(0,r.jsxs)("div",{className:"text-sm opacity-70 text-center",children:[t.length," chapters"]})})]})]})}function y(e){var t;let{item:a,index:n,isActive:s,onSelect:l,settings:i,depth:o=0}=e;return(0,r.jsxs)("div",{style:{paddingLeft:"".concat(16*o,"px")},children:[(0,r.jsx)("button",{onClick:()=>l(n),className:"w-full text-left px-4 py-3 rounded-lg transition-colors mb-1 ".concat(s?"dark"===i.theme?"bg-blue-900/50 text-blue-300":"bg-blue-100 text-blue-700":"hover:bg-black/5 dark:hover:bg-white/5"),children:(0,r.jsxs)("span",{className:"flex items-center gap-3",children:[s&&(0,r.jsx)("span",{className:"w-1.5 h-1.5 bg-blue-500 rounded-full"}),(0,r.jsx)("span",{className:s?"font-medium":"",children:a.label})]})}),null===(t=a.subitems)||void 0===t?void 0:t.map((e,t)=>(0,r.jsx)(y,{item:e,index:n+t+1,isActive:!1,onSelect:l,settings:i,depth:o+1},e.id))]})}let v=[{title:"Chapter 1: The Beginning",content:'It is a truth universally acknowledged, that a single man in possession of a good fortune, must be in want of a wife.\n\nHowever little known the feelings or views of such a man may be on his first entering a neighbourhood, this truth is so well fixed in the minds of the surrounding families, that he is considered the rightful property of some one or other of their daughters.\n\n"My dear Mr. Bennet," said his lady to him one day, "have you heard that Netherfield Park is let at last?"\n\nMr. Bennet replied that he had not.\n\n"But it is," returned she; "for Mrs. Long has just been here, and she told me all about it."\n\nMr. Bennet made no answer.\n\n"Do you not want to know who has taken it?" cried his wife impatiently.\n\n"You want to tell me, and I have no objection to hearing it."\n\nThis was invitation enough.\n\n"Why, my dear, you must know, Mrs. Long says that Netherfield is taken by a young man of large fortune from the north of England; that he came down on Monday in a chaise and four to see the place, and was so much delighted with it, that he agreed with Mr. Morris immediately; that he is to take possession before Michaelmas, and some of his servants are to be in the house by the end of next week."\n\n"What is his name?"\n\n"Bingley."\n\n"Is he married or single?"\n\n"Oh! Single, my dear, to be sure! A single man of large fortune; four or five thousand a year. What a fine thing for our girls!"'},{title:"Chapter 2: First Impressions",content:'Mr. Bennet was among the earliest of those who waited on Mr. Bingley. He had always intended to visit him, though to the last always assuring his wife that he should not go; and till the evening after the visit was paid she had no knowledge of it.\n\nIt was then disclosed in the following manner. Observing his second daughter employed in trimming a hat, he suddenly addressed her with:\n\n"I hope Mr. Bingley will like it, Lizzy."\n\n"We are not in a way to know what Mr. Bingley likes," said her mother resentfully, "since we are not to visit."\n\n"But you forget, mamma," said Elizabeth, "that we shall meet him at the assemblies, and that Mrs. Long promised to introduce him."\n\n"I do not believe Mrs. Long will do any such thing. She has two nieces of her own. She is a selfish, hypocritical woman, and I have no opinion of her."\n\n"No more have I," said Mr. Bennet; "and I am glad to find that you do not depend on her serving you."\n\nMrs. Bennet deigned not to make any reply, but, unable to contain herself, began scolding one of her daughters.\n\n"Don\'t keep coughing so, Kitty, for Heaven\'s sake! Have a little compassion on my nerves. You tear them to pieces."\n\n"Kitty has no discretion in her coughs," said her father; "she times them ill."\n\n"I do not cough for my own amusement," replied Kitty fretfully.'},{title:"Chapter 3: The Ball",content:'Not all that Mrs. Bennet, however, with the assistance of her five daughters, could ask on the subject, was sufficient to draw from her husband any satisfactory description of Mr. Bingley.\n\nThey attacked him in various ways—with barefaced questions, ingenious suppositions, and distant surmises; but he eluded the skill of them all, and they were at last obliged to accept the second-hand intelligence of their neighbour, Lady Lucas.\n\nHer report was highly favourable. Sir William had been delighted with him. He was quite young, wonderfully handsome, extremely agreeable, and, to crown the whole, he meant to be at the next assembly with a large party.\n\nNothing could be more delightful! To be fond of dancing was a certain step towards falling in love; and very lively hopes of Mr. Bingley\'s heart were entertained.\n\n"If I can but see one of my daughters happily settled at Netherfield," said Mrs. Bennet to her husband, "and all the others equally well married, I shall have nothing to wish for."\n\nIn a few days Mr. Bingley returned Mr. Bennet\'s visit, and sat about ten minutes with him in his library. He had entertained hopes of being admitted to a sight of the young ladies, of whose beauty he had heard much; but he saw only the father.\n\nThe ladies were somewhat more fortunate, for they had the advantage of ascertaining from an upper window that he wore a blue coat, and rode a black horse.'}];function k(){let{currentBook:e,setCurrentBook:t,updateBookProgress:a,settings:n,isSettingsOpen:s,isTocOpen:l,toggleSettings:i,toggleToc:d}=o(),[h,u]=(0,c.useState)(0),[g,m]=(0,c.useState)([]),[x,b]=(0,c.useState)(!0),y=(0,c.useRef)(null),k=(0,c.useRef)(null),j=(0,c.useRef)(0),w=(0,c.useRef)(0),N=v.length,C=(h+1)/N*100;(0,c.useEffect)(()=>{e&&a(e.id,C)},[C,e,a]),(0,c.useEffect)(()=>{m(v.map((e,t)=>({id:"ch-".concat(t),href:"#ch-".concat(t),label:e.title})))},[]);let D=(0,c.useCallback)(()=>{h>0&&u(e=>e-1)},[h]),S=(0,c.useCallback)(()=>{h<N-1&&u(e=>e+1)},[h,N]);(0,c.useEffect)(()=>{let e=e=>{"ArrowLeft"===e.key||"ArrowUp"===e.key?D():"ArrowRight"===e.key||"ArrowDown"===e.key||" "===e.key?(e.preventDefault(),S()):"Escape"===e.key&&t(null)};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[D,S,t]);let A={light:"bg-white text-gray-900",dark:"bg-gray-900 text-gray-100",sepia:"bg-sepia-100 text-sepia-900"};return(0,r.jsxs)("div",{className:"min-h-screen ".concat(A[n.theme]," transition-colors duration-300"),onClick:()=>{b(!0),y.current&&clearTimeout(y.current),y.current=setTimeout(()=>{b(!1)},3e3)},onTouchStart:e=>{j.current=e.touches[0].clientX},onTouchEnd:e=>{w.current=e.changedTouches[0].clientX;let t=j.current-w.current;Math.abs(t)>50&&(t>0?S():D())},ref:k,children:[(0,r.jsx)("div",{className:"fixed top-0 left-0 right-0 z-50",children:(0,r.jsx)("div",{className:"progress-bar",style:{width:"".concat(C,"%")}})}),(0,r.jsx)("header",{className:"fixed top-0 left-0 right-0 z-40 transition-transform duration-300 ".concat(x?"translate-y-0":"-translate-y-full"),children:(0,r.jsx)("div",{className:"".concat(A[n.theme]," bg-opacity-95 backdrop-blur-sm shadow-md"),children:(0,r.jsxs)("div",{className:"flex items-center justify-between px-4 py-3",children:[(0,r.jsx)("button",{onClick:e=>{e.stopPropagation(),t(null)},className:"p-2 rounded-lg hover:bg-black/10 dark:hover:bg-white/10",children:"← Library"}),(0,r.jsxs)("div",{className:"flex-1 text-center px-4",children:[(0,r.jsx)("h1",{className:"font-semibold truncate",children:null==e?void 0:e.title}),(0,r.jsx)("p",{className:"text-sm opacity-70",children:v[h].title})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("button",{onClick:e=>{e.stopPropagation(),d()},className:"p-2 rounded-lg hover:bg-black/10 dark:hover:bg-white/10",title:"Table of Contents",children:"\uD83D\uDCD6"}),(0,r.jsx)("button",{onClick:e=>{e.stopPropagation(),i()},className:"p-2 rounded-lg hover:bg-black/10 dark:hover:bg-white/10",title:"Settings",children:"⚙️"})]})]})})}),(0,r.jsx)("main",{className:"min-h-screen pt-20 pb-24 ".concat({small:"px-4 md:px-8",medium:"px-8 md:px-16 lg:px-24",large:"px-12 md:px-24 lg:px-32"}[n.marginSize]," reader-scroll"),children:(0,r.jsxs)("article",{className:"max-w-3xl mx-auto reader-content",style:{fontSize:"".concat(n.fontSize,"px"),lineHeight:n.lineHeight,fontFamily:"serif"===n.fontFamily?'Georgia, Cambria, "Times New Roman", serif':"system-ui, -apple-system, sans-serif"},children:[(0,r.jsx)("h2",{className:"text-2xl font-bold mb-8 text-center",children:v[h].title}),v[h].content.split("\n\n").map((e,t)=>(0,r.jsx)("p",{className:"mb-4",children:e},t))]})}),(0,r.jsx)("footer",{className:"fixed bottom-0 left-0 right-0 z-40 transition-transform duration-300 ".concat(x?"translate-y-0":"translate-y-full"),children:(0,r.jsx)("div",{className:"".concat(A[n.theme]," bg-opacity-95 backdrop-blur-sm shadow-[0_-2px_10px_rgba(0,0,0,0.1)]"),children:(0,r.jsxs)("div",{className:"flex items-center justify-between px-4 py-3",children:[(0,r.jsx)("button",{onClick:e=>{e.stopPropagation(),D()},disabled:0===h,className:"px-4 py-2 rounded-lg hover:bg-black/10 dark:hover:bg-white/10 disabled:opacity-30",children:"← Prev"}),(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsxs)("p",{className:"text-sm opacity-70",children:["Chapter ",h+1," of ",N]}),(0,r.jsxs)("p",{className:"text-xs opacity-50",children:[Math.round(C),"% complete"]})]}),(0,r.jsx)("button",{onClick:e=>{e.stopPropagation(),S()},disabled:h===N-1,className:"px-4 py-2 rounded-lg hover:bg-black/10 dark:hover:bg-white/10 disabled:opacity-30",children:"Next →"})]})})}),s&&(0,r.jsx)(p,{}),l&&(0,r.jsx)(f,{items:g,currentIndex:h,onSelect:e=>{u(e),d()}})]})}function j(e){var t,a,n;let{word:s,position:l,cfi:i,bookId:d,onClose:h,onHighlightWithNote:u}=e,{addHighlight:g,addVocabularyWord:m}=o(),[x,b]=(0,c.useState)(!0),[p,f]=(0,c.useState)(null),[y,v]=(0,c.useState)(null),[k,j]=(0,c.useState)(!1),[w,N]=(0,c.useState)(!1),C=s.trim().toLowerCase().replace(/[^a-zA-Z'-]/g,"");(0,c.useEffect)(()=>{!async function(){if(!C){f("Invalid word"),b(!1);return}try{b(!0),f(null);let e=await fetch("https://api.dictionaryapi.dev/api/v2/entries/en/".concat(encodeURIComponent(C)));if(!e.ok){404===e.status?f("Word not found"):f("Failed to fetch definition"),b(!1);return}let t=await e.json();t&&t.length>0&&v(t[0])}catch(e){console.error("Dictionary lookup error:",e),f("Network error")}finally{b(!1)}}()},[C]);let D={left:Math.min(Math.max(l.x-150,10),window.innerWidth-320),top:Math.max(l.y+10,10),maxHeight:window.innerHeight-l.y-40},S=(null==y?void 0:y.phonetic)||(null==y?void 0:null===(a=y.phonetics)||void 0===a?void 0:null===(t=a.find(e=>e.text))||void 0===t?void 0:t.text),A=null==y?void 0:null===(n=y.phonetics)||void 0===n?void 0:n.some(e=>e.audio);return(0,r.jsx)("div",{className:"fixed z-[100] animate-in fade-in slide-in-from-top-2 duration-200",style:D,onClick:e=>e.stopPropagation(),children:(0,r.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-xl border border-gray-200 dark:border-gray-700  w-[300px] max-w-[calc(100vw-20px)] overflow-hidden",children:[(0,r.jsx)("div",{className:"px-4 py-3 border-b border-gray-100 dark:border-gray-700 bg-gradient-to-r from-blue-50 to-purple-50 dark:from-blue-900/20 dark:to-purple-900/20",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"text-lg font-semibold text-gray-900 dark:text-white capitalize",children:C}),S&&(0,r.jsx)("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:S})]}),(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[A&&(0,r.jsx)("button",{onClick:()=>{var e,t;let a=null==y?void 0:null===(t=y.phonetics)||void 0===t?void 0:null===(e=t.find(e=>e.audio))||void 0===e?void 0:e.audio;if(a){j(!0);let e=new Audio(a);e.onended=()=>j(!1),e.onerror=()=>j(!1),e.play().catch(()=>j(!1))}},disabled:k,className:"p-1.5 hover:bg-white/50 dark:hover:bg-gray-700/50 rounded-full transition-colors",title:"Play pronunciation",children:k?"\uD83D\uDD0A":"\uD83D\uDD08"}),(0,r.jsx)("button",{onClick:h,className:"p-1.5 hover:bg-white/50 dark:hover:bg-gray-700/50 rounded-full transition-colors text-gray-500",children:"✕"})]})]})}),(0,r.jsx)("div",{className:"p-4 max-h-[300px] overflow-y-auto",children:x?(0,r.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,r.jsx)("div",{className:"w-6 h-6 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"})}):p?(0,r.jsxs)("div",{className:"text-center py-6",children:[(0,r.jsx)("span",{className:"text-4xl mb-2 block",children:"\uD83D\uDCDA"}),(0,r.jsx)("p",{className:"text-gray-500 dark:text-gray-400",children:p}),(0,r.jsx)("p",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1",children:"Try selecting a different word"})]}):y?(0,r.jsx)("div",{className:"space-y-3",children:y.meanings.slice(0,3).map((e,t)=>(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"inline-block px-2 py-0.5 text-xs font-medium bg-gray-100 dark:bg-gray-700  text-gray-600 dark:text-gray-300 rounded-full mb-1",children:e.partOfSpeech}),(0,r.jsx)("ol",{className:"list-decimal list-inside space-y-1",children:e.definitions.slice(0,2).map((e,t)=>(0,r.jsxs)("li",{className:"text-sm text-gray-700 dark:text-gray-300",children:[e.definition,e.example&&(0,r.jsxs)("p",{className:"text-xs text-gray-500 dark:text-gray-400 ml-4 mt-0.5 italic",children:['"',e.example,'"']})]},t))})]},t))}):null}),y&&(0,r.jsxs)("div",{className:"px-3 py-2 border-t border-gray-100 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50 flex gap-2",children:[(0,r.jsx)("button",{onClick:()=>{if(y){var e,t,a,r;m({word:C,definition:(null===(t=y.meanings[0])||void 0===t?void 0:null===(e=t.definitions[0])||void 0===e?void 0:e.definition)||"",phonetic:y.phonetic||(null===(r=y.phonetics)||void 0===r?void 0:null===(a=r.find(e=>e.text))||void 0===a?void 0:a.text),bookId:d}),N(!0),setTimeout(()=>N(!1),2e3)}},disabled:w,className:"flex-1 px-3 py-1.5 text-sm bg-gradient-to-r from-amber-400 to-orange-400  text-white rounded-lg hover:from-amber-500 hover:to-orange-500  transition-all flex items-center justify-center gap-1.5 disabled:opacity-50 disabled:cursor-default",children:w?(0,r.jsx)(r.Fragment,{children:"✓ Saved"}):(0,r.jsx)(r.Fragment,{children:"\uD83D\uDCDA Add to Vocabulary"})}),i&&d&&(0,r.jsx)("button",{onClick:()=>{if(y&&i&&d){var e,t;let a=(null===(t=y.meanings[0])||void 0===t?void 0:null===(e=t.definitions[0])||void 0===e?void 0:e.definition)||"",r="\uD83D\uDCD6 ".concat(y.phonetic||"","\n").concat(a);u?u(r):(g({bookId:d,cfi:i,text:C,color:"blue",note:r}),h())}},className:"px-3 py-1.5 text-sm bg-blue-500 text-white rounded-lg  hover:bg-blue-600 transition-colors flex items-center gap-1.5",title:"Save as highlight with definition",children:"\uD83D\uDCA1"})]})]})})}let w=[{color:"yellow",label:"Yellow",bg:"bg-yellow-300"},{color:"green",label:"Green",bg:"bg-green-300"},{color:"blue",label:"Blue",bg:"bg-blue-300"},{color:"pink",label:"Pink",bg:"bg-pink-300"}];function N(e){let{position:t,selectedText:a,cfi:n,bookId:s,onClose:l}=e,{addHighlight:i}=o(),[d,h]=(0,c.useState)(!1),[u,g]=(0,c.useState)(!1),[m,x]=(0,c.useState)(""),[b,p]=(0,c.useState)("yellow"),f=function(e){let t=e.trim();return/^[a-zA-Z]+(['-][a-zA-Z]+)*$/.test(t)&&t.length>=2}(a),y=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t?(p(e),h(!0)):(i({bookId:s,cfi:n,text:a,color:e}),l())},v={left:Math.min(t.x,window.innerWidth-200),top:Math.max(t.y-60,10)};return(0,r.jsxs)("div",{className:"fixed z-[100] animate-in fade-in zoom-in-95 duration-150",style:v,onClick:e=>e.stopPropagation(),children:[(0,r.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 overflow-hidden",children:d?(0,r.jsxs)("div",{className:"p-3 min-w-[280px]",children:[(0,r.jsx)("div",{className:"flex items-center gap-1 mb-3",children:w.map(e=>{let{color:t,bg:a}=e;return(0,r.jsx)("button",{onClick:()=>p(t),className:"w-7 h-7 rounded-full ".concat(a," transition-all ").concat(b===t?"ring-2 ring-offset-2 ring-gray-400 scale-110":"hover:scale-105")},t)})}),(0,r.jsxs)("div",{className:"text-xs text-gray-500 dark:text-gray-400 mb-2 line-clamp-2 italic",children:['"',a.slice(0,100),a.length>100?"...":"",'"']}),(0,r.jsx)("textarea",{value:m,onChange:e=>x(e.target.value),placeholder:"Add a note...",className:"w-full p-2 text-sm border border-gray-200 dark:border-gray-600 rounded-lg  bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none",rows:3,autoFocus:!0}),(0,r.jsxs)("div",{className:"flex justify-end gap-2 mt-2",children:[(0,r.jsx)("button",{onClick:l,className:"px-3 py-1.5 text-sm text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:"Cancel"}),(0,r.jsx)("button",{onClick:()=>{i({bookId:s,cfi:n,text:a,color:b,note:m.trim()||void 0}),l()},className:"px-3 py-1.5 text-sm bg-blue-500 text-white rounded-lg hover:bg-blue-600",children:"Save"})]})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"flex items-center gap-1 p-2 border-b border-gray-100 dark:border-gray-700",children:w.map(e=>{let{color:t,label:a,bg:n}=e;return(0,r.jsx)("button",{onClick:()=>y(t),className:"w-8 h-8 rounded-full ".concat(n," hover:scale-110 transition-transform"),title:a},t)})}),(0,r.jsxs)("div",{className:"p-1",children:[f&&(0,r.jsxs)("button",{onClick:()=>g(!0),className:"w-full px-3 py-2 text-left text-sm hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg flex items-center gap-2 text-blue-600 dark:text-blue-400 font-medium",children:[(0,r.jsx)("span",{children:"\uD83D\uDCD6"}),(0,r.jsxs)("span",{children:['Look up "',a.trim(),'"']})]}),(0,r.jsxs)("button",{onClick:()=>{h(!0)},className:"w-full px-3 py-2 text-left text-sm hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg flex items-center gap-2",children:[(0,r.jsx)("span",{children:"\uD83D\uDCDD"}),(0,r.jsx)("span",{children:"Add note..."})]}),(0,r.jsxs)("button",{onClick:()=>{navigator.clipboard.writeText(a),l()},className:"w-full px-3 py-2 text-left text-sm hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg flex items-center gap-2",children:[(0,r.jsx)("span",{children:"\uD83D\uDCCB"}),(0,r.jsx)("span",{children:"Copy text"})]})]})]})}),u&&(0,r.jsx)(j,{word:a.trim(),position:{x:t.x+20,y:t.y+60},cfi:n,bookId:s,onClose:()=>g(!1),onHighlightWithNote:e=>{i({bookId:s,cfi:n,text:a.trim(),color:"blue",note:e}),l()}})]})}let C=[{color:"yellow",label:"Yellow",bg:"bg-yellow-100",text:"text-yellow-800"},{color:"green",label:"Green",bg:"bg-green-100",text:"text-green-800"},{color:"blue",label:"Blue",bg:"bg-blue-100",text:"text-blue-800"},{color:"pink",label:"Pink",bg:"bg-pink-100",text:"text-pink-800"}];function D(e){let{bookId:t,onNavigate:a,onClose:n}=e,{highlights:s,bookmarks:l,removeHighlight:i,removeBookmark:d,settings:h}=o(),[u,g]=(0,c.useState)("highlights"),[m,x]=(0,c.useState)(""),[b,p]=(0,c.useState)("all"),[f,y]=(0,c.useState)(null),v=(0,c.useMemo)(()=>s.filter(e=>e.bookId===t).filter(e=>"all"===b||e.color===b).filter(e=>{var t;if(!m)return!0;let a=m.toLowerCase();return e.text.toLowerCase().includes(a)||(null===(t=e.note)||void 0===t?void 0:t.toLowerCase().includes(a))}).sort((e,t)=>t.createdAt-e.createdAt),[s,t,b,m]),k=(0,c.useMemo)(()=>l.filter(e=>e.bookId===t).filter(e=>{var t;return!m||(null===(t=e.title)||void 0===t?void 0:t.toLowerCase().includes(m.toLowerCase()))}).sort((e,t)=>t.createdAt-e.createdAt),[l,t,m]),j=e=>new Date(e).toLocaleDateString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),w=e=>C.find(t=>t.color===e)||C[0];return(0,r.jsxs)("div",{className:"fixed inset-0 z-50 flex",onClick:n,children:[(0,r.jsx)("div",{className:"absolute inset-0 bg-black/40"}),(0,r.jsxs)("div",{className:"relative ml-auto w-full max-w-md h-full ".concat({light:"bg-white text-gray-900",dark:"bg-gray-900 text-gray-100",sepia:"bg-sepia-100 text-sepia-900"}[h.theme]," shadow-2xl animate-in slide-in-from-right duration-300 flex flex-col"),onClick:e=>e.stopPropagation(),children:[(0,r.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold",children:"Annotations"}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("button",{onClick:()=>{let e=new Blob([["# Annotations Export","","## Highlights (".concat(v.length,")"),"",...v.map((e,t)=>["### ".concat(t+1,". [").concat(e.color.toUpperCase(),"]"),"> ".concat(e.text),e.note?"\n**Note:** ".concat(e.note):"","*".concat(j(e.createdAt),"*"),""].filter(Boolean).join("\n")),"","## Bookmarks (".concat(k.length,")"),"",...k.map((e,t)=>["".concat(t+1,". ").concat(e.title||"Untitled bookmark"),"   *".concat(j(e.createdAt),"*"),""].join("\n"))].join("\n")],{type:"text/markdown"}),t=URL.createObjectURL(e),a=document.createElement("a");a.href=t,a.download="annotations.md",a.click(),URL.revokeObjectURL(t)},className:"p-2 rounded-lg hover:bg-black/10 dark:hover:bg-white/10",title:"Export to Markdown",children:"\uD83D\uDCE4"}),(0,r.jsx)("button",{onClick:n,className:"p-2 rounded-lg hover:bg-black/10 dark:hover:bg-white/10",children:"✕"})]})]}),(0,r.jsxs)("div",{className:"flex border-b border-gray-200 dark:border-gray-700",children:[(0,r.jsxs)("button",{onClick:()=>g("highlights"),className:"flex-1 py-3 text-sm font-medium transition-colors ".concat("highlights"===u?"border-b-2 border-blue-500 text-blue-500":"text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"),children:["Highlights (",v.length,")"]}),(0,r.jsxs)("button",{onClick:()=>g("bookmarks"),className:"flex-1 py-3 text-sm font-medium transition-colors ".concat("bookmarks"===u?"border-b-2 border-blue-500 text-blue-500":"text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"),children:["Bookmarks (",k.length,")"]})]}),(0,r.jsxs)("div",{className:"p-3 space-y-2 border-b border-gray-200 dark:border-gray-700",children:[(0,r.jsx)("input",{type:"text",value:m,onChange:e=>x(e.target.value),placeholder:"Search annotations...",className:"w-full px-3 py-2 rounded-lg text-sm ".concat({light:"bg-gray-100 text-gray-900 placeholder-gray-500",dark:"bg-gray-800 text-gray-100 placeholder-gray-500",sepia:"bg-sepia-200 text-sepia-900 placeholder-sepia-700"}[h.theme]," focus:outline-none focus:ring-2 focus:ring-blue-500")}),"highlights"===u&&(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)("button",{onClick:()=>p("all"),className:"px-3 py-1 text-xs rounded-full transition-colors ".concat("all"===b?"bg-gray-700 text-white":"bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600"),children:"All"}),C.map(e=>{let{color:t,bg:a}=e;return(0,r.jsx)("button",{onClick:()=>p(t),className:"w-6 h-6 rounded-full ".concat(a," transition-transform ").concat(b===t?"ring-2 ring-offset-1 ring-gray-400 scale-110":"")},t)})]})]}),(0,r.jsx)("div",{className:"flex-1 overflow-y-auto p-3 space-y-2",children:"highlights"===u?0===v.length?(0,r.jsxs)("div",{className:"text-center py-12 text-gray-500",children:[(0,r.jsx)("p",{className:"text-4xl mb-2",children:"\uD83D\uDD8D️"}),(0,r.jsx)("p",{children:"No highlights yet"}),(0,r.jsx)("p",{className:"text-sm mt-1",children:"Select text while reading to add highlights"})]}):v.map(e=>{let t=w(e.color);return(0,r.jsxs)("div",{className:"p-3 rounded-lg ".concat(t.bg," ").concat(t.text," cursor-pointer hover:shadow-md transition-shadow"),onClick:()=>a(e.cfi),children:[(0,r.jsxs)("p",{className:"text-sm line-clamp-3",children:['"',e.text,'"']}),e.note&&(0,r.jsxs)("div",{className:"mt-2 pt-2 border-t border-black/10 text-sm cursor-pointer ".concat(f===e.id?"":"line-clamp-2"),onClick:t=>{t.stopPropagation(),y(f===e.id?null:e.id)},children:["\uD83D\uDCDD ",e.note]}),(0,r.jsxs)("div",{className:"flex items-center justify-between mt-2 text-xs opacity-70",children:[(0,r.jsx)("span",{children:j(e.createdAt)}),(0,r.jsx)("button",{onClick:t=>{t.stopPropagation(),confirm("Delete this highlight?")&&i(e.id)},className:"p-1 hover:bg-black/10 rounded",children:"\uD83D\uDDD1️"})]})]},e.id)}):0===k.length?(0,r.jsxs)("div",{className:"text-center py-12 text-gray-500",children:[(0,r.jsx)("p",{className:"text-4xl mb-2",children:"\uD83D\uDD16"}),(0,r.jsx)("p",{children:"No bookmarks yet"}),(0,r.jsx)("p",{className:"text-sm mt-1",children:"Tap the bookmark icon while reading"})]}):k.map(e=>(0,r.jsx)("div",{className:"p-3 rounded-lg bg-amber-50 dark:bg-amber-900/20 cursor-pointer hover:shadow-md transition-shadow",onClick:()=>a(e.cfi),children:(0,r.jsxs)("div",{className:"flex items-start gap-2",children:[(0,r.jsx)("span",{className:"text-lg",children:"\uD83D\uDD16"}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsx)("p",{className:"font-medium truncate",children:e.title||"Untitled bookmark"}),(0,r.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:j(e.createdAt)})]}),(0,r.jsx)("button",{onClick:t=>{t.stopPropagation(),confirm("Delete this bookmark?")&&d(e.id)},className:"p-1 hover:bg-black/10 rounded text-gray-500",children:"\uD83D\uDDD1️"})]})},e.id))})]})]})}function S(e){let{isOpen:t,onClose:a,bookId:n}=e,{vocabulary:s,removeVocabularyWord:l,books:i}=o(),[d,h]=(0,c.useState)("all"),[u,g]=(0,c.useState)("");if(!t)return null;let m=s;if("current"===d&&n&&(m=s.filter(e=>e.bookId===n)),u){let e=u.toLowerCase();m=m.filter(t=>t.word.toLowerCase().includes(e)||t.definition.toLowerCase().includes(e))}m=[...m].sort((e,t)=>t.createdAt-e.createdAt);let x=e=>{if(!e)return"Unknown";let t=i.find(t=>t.id===e);return(null==t?void 0:t.title)||"Unknown"};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"fixed inset-0 bg-black/30 z-[90] transition-opacity",onClick:a}),(0,r.jsxs)("div",{className:"fixed right-0 top-0 bottom-0 w-full max-w-md bg-white dark:bg-gray-900  shadow-2xl z-[95] animate-in slide-in-from-right duration-300 flex flex-col",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between px-4 py-3 border-b border-gray-200 dark:border-gray-700",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"text-xl",children:"\uD83D\uDCDA"}),(0,r.jsx)("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Vocabulary"}),(0,r.jsx)("span",{className:"px-2 py-0.5 text-xs bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-300 rounded-full",children:m.length})]}),(0,r.jsx)("button",{onClick:a,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-full",children:"✕"})]}),(0,r.jsxs)("div",{className:"px-4 py-3 border-b border-gray-100 dark:border-gray-800 space-y-3",children:[(0,r.jsx)("input",{type:"text",value:u,onChange:e=>g(e.target.value),placeholder:"Search words...",className:"w-full px-3 py-2 text-sm border border-gray-200 dark:border-gray-700 rounded-lg  bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-amber-500"}),n&&(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{onClick:()=>h("all"),className:"px-3 py-1 text-sm rounded-full transition-colors ".concat("all"===d?"bg-amber-500 text-white":"bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400"),children:"All Books"}),(0,r.jsx)("button",{onClick:()=>h("current"),className:"px-3 py-1 text-sm rounded-full transition-colors ".concat("current"===d?"bg-amber-500 text-white":"bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400"),children:"Current Book"})]})]}),(0,r.jsx)("div",{className:"flex-1 overflow-y-auto px-4 py-3",children:0===m.length?(0,r.jsxs)("div",{className:"text-center py-12",children:[(0,r.jsx)("span",{className:"text-4xl mb-3 block",children:"\uD83D\uDCD6"}),(0,r.jsx)("p",{className:"text-gray-500 dark:text-gray-400",children:u?"No words match your search":"No words saved yet"}),(0,r.jsx)("p",{className:"text-sm text-gray-400 dark:text-gray-500 mt-1",children:'Select a word while reading and tap "Look up" to add it'})]}):(0,r.jsx)("div",{className:"space-y-3",children:m.map(e=>(0,r.jsxs)("div",{className:"p-3 bg-gradient-to-br from-amber-50 to-orange-50 dark:from-amber-900/20 dark:to-orange-900/20  rounded-xl border border-amber-200/50 dark:border-amber-800/30",children:[(0,r.jsxs)("div",{className:"flex items-start justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"font-semibold text-gray-900 dark:text-white capitalize",children:e.word}),e.phonetic&&(0,r.jsx)("span",{className:"ml-2 text-sm text-gray-500 dark:text-gray-400",children:e.phonetic})]}),(0,r.jsx)("button",{onClick:()=>l(e.id),className:"text-gray-400 hover:text-red-500 transition-colors p-1",title:"Remove word",children:"\uD83D\uDDD1️"})]}),(0,r.jsx)("p",{className:"text-sm text-gray-700 dark:text-gray-300 mt-1",children:e.definition}),e.bookId&&(0,r.jsxs)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2",children:["\uD83D\uDCD6 ",x(e.bookId)]})]},e.id))})}),m.length>0&&(0,r.jsx)("div",{className:"px-4 py-3 border-t border-gray-200 dark:border-gray-700",children:(0,r.jsxs)("button",{onClick:()=>{let e=new Blob([["# My Vocabulary List","","*Exported on ".concat(new Date().toLocaleDateString(),"*"),"",...m.map(e=>["## ".concat(e.word),e.phonetic?"*".concat(e.phonetic,"*"):"","",e.definition,"",e.bookId?"\uD83D\uDCD6 From: ".concat(x(e.bookId)):"","","---",""].filter(Boolean).join("\n"))].join("\n")],{type:"text/markdown"}),t=URL.createObjectURL(e),a=document.createElement("a");a.href=t,a.download="vocabulary.md",a.click(),URL.revokeObjectURL(t)},className:"w-full px-4 py-2 bg-gradient-to-r from-amber-400 to-orange-400 text-white  rounded-lg hover:from-amber-500 hover:to-orange-500 transition-all flex items-center justify-center gap-2",children:[(0,r.jsx)("span",{children:"\uD83D\uDCE4"}),(0,r.jsx)("span",{children:"Export to Markdown"})]})})]})]})}var A=a(2569);function B(e){let{bookUrl:t,bookId:a}=e,{currentBook:n,setCurrentBook:s,updateBookProgress:l,settings:i,isSettingsOpen:d,isTocOpen:h,toggleSettings:u,toggleToc:g,addBook:m,books:x,highlights:b,bookmarks:y,addBookmark:v,removeBookmark:k}=o(),j=y.some(e=>e.bookId===a&&e.cfi===V),w=b.filter(e=>e.bookId===a),[C,B]=(0,c.useState)(!0),[L,z]=(0,c.useState)(null),[M,I]=(0,c.useState)([]),[U,P]=(0,c.useState)(!0),[R,T]=(0,c.useState)(0),[E,F]=(0,c.useState)(""),[H,O]=(0,c.useState)(0),[W,_]=(0,c.useState)(0),[V,Y]=(0,c.useState)(""),[G,X]=(0,c.useState)(!1),[Z,q]=(0,c.useState)(!1),[K,$]=(0,c.useState)(null),J=(0,c.useRef)(null),Q=(0,c.useRef)(null),ee=(0,c.useRef)(null),et=(0,c.useRef)(null),ea=e=>e.map((e,t)=>({id:"toc-".concat(t),href:e.href,label:e.label,subitems:e.subitems?ea(e.subitems):void 0})),er=(0,c.useCallback)(()=>{if(!ee.current)return;let e={light:{background:"#ffffff",color:"#1a1a1a"},dark:{background:"#1a1a1a",color:"#f0f0f0"},sepia:{background:"#f4ecd8",color:"#5c4a32"}};ee.current.themes.override("color",e[i.theme].color),ee.current.themes.override("background",e[i.theme].background),ee.current.themes.override("font-size","".concat(i.fontSize,"px")),ee.current.themes.override("line-height","".concat(i.lineHeight)),ee.current.themes.override("font-family","serif"===i.fontFamily?'Georgia, Cambria, "Times New Roman", serif':"system-ui, -apple-system, sans-serif")},[i]);(0,c.useEffect)(()=>{if(J.current)return(async()=>{try{B(!0),z(null),ee.current&&ee.current.destroy(),Q.current&&Q.current.destroy();let e=(0,A.Ay)(t);Q.current=e,await e.ready;let r=await e.loaded.metadata,n=await e.coverUrl(),i=x.find(e=>e.id===a);i||m({id:a,title:r.title||"Unknown Title",author:r.creator||"Unknown Author",cover:n||void 0,progress:0}),s({id:a,title:r.title||"Unknown Title",author:r.creator||"Unknown Author",cover:n||void 0,progress:(null==i?void 0:i.progress)||0,currentCfi:null==i?void 0:i.currentCfi});let o=await e.loaded.navigation;I(ea(o.toc)),await e.locations.generate(1024),_(e.locations.length());let c=e.renderTo(J.current,{width:"100%",height:"100%",spread:"none",flow:"paginated"});ee.current=c,er(),c.on("locationChanged",t=>{let r=e.locations.locationFromCfi(t.start.cfi),n=e.locations.length(),s=Math.round(r/n*100);T(s),O(r),Y(t.start.cfi);let i=e.spine.get(t.start.cfi);if(i){let e=o.toc.find(e=>e.href===i.href||e.href.startsWith(i.href.split("#")[0]));e&&F(e.label)}l(a,s,t.start.cfi,r)}),c.on("selected",(e,t)=>{var a;let r=null==t?void 0:null===(a=t.window)||void 0===a?void 0:a.getSelection();if(!r||0===r.rangeCount)return;let n=r.toString().trim();if(n.length<3)return;let s=r.getRangeAt(0).getBoundingClientRect();$({position:{x:s.left+s.width/2,y:s.top},selectedText:n,cfi:String(e)})}),(null==i?void 0:i.currentCfi)?await c.display(i.currentCfi):await c.display(),c.on("rendered",()=>{b.filter(e=>e.bookId===a).forEach(e=>{var t,a;null===(a=c.annotations)||void 0===a||null===(t=a.highlight)||void 0===t||t.call(a,e.cfi,{},()=>{},void 0,{fill:{yellow:"rgba(255, 255, 0, 0.3)",green:"rgba(0, 255, 0, 0.3)",blue:"rgba(0, 100, 255, 0.3)",pink:"rgba(255, 182, 193, 0.5)"}[e.color]})})}),c.on("keyup",e=>{"ArrowLeft"===e.key||"ArrowUp"===e.key?c.prev():("ArrowRight"===e.key||"ArrowDown"===e.key||" "===e.key)&&c.next()}),B(!1)}catch(e){console.error("Error loading EPUB:",e),z("Failed to load book. Please try again."),B(!1)}})(),()=>{ee.current&&ee.current.destroy(),Q.current&&Q.current.destroy()}},[t,a]),(0,c.useEffect)(()=>{er()},[i,er]);let en=()=>{var e;null===(e=ee.current)||void 0===e||e.prev()},es=()=>{var e;null===(e=ee.current)||void 0===e||e.next()},el=()=>{if(!V)return;let e=y.find(e=>e.bookId===a&&e.cfi===V);e?k(e.id):v({bookId:a,cfi:V,title:E||"Page ".concat(H)})};(0,c.useEffect)(()=>{let e=e=>{"ArrowLeft"===e.key||"ArrowUp"===e.key?en():"ArrowRight"===e.key||"ArrowDown"===e.key||" "===e.key?(e.preventDefault(),es()):"Escape"===e.key&&s(null)};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[s]);let ei=(0,c.useRef)(0),eo=()=>{P(!0),et.current&&clearTimeout(et.current),et.current=setTimeout(()=>{P(!1)},3e3)},ec={light:"bg-white text-gray-900",dark:"bg-gray-900 text-gray-100",sepia:"bg-sepia-100 text-sepia-900"};return L?(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center ".concat(ec[i.theme]),children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("p",{className:"text-red-500 mb-4",children:L}),(0,r.jsx)("button",{onClick:()=>s(null),className:"px-4 py-2 bg-blue-500 text-white rounded-lg",children:"Back to Library"})]})}):(0,r.jsxs)("div",{className:"min-h-screen ".concat(ec[i.theme]," transition-colors duration-300"),onClick:()=>{K&&$(null),eo()},onTouchStart:e=>{ei.current=e.touches[0].clientX},onTouchEnd:e=>{let t=e.changedTouches[0].clientX,a=ei.current-t;Math.abs(a)>50&&(a>0?es():en())},children:[(0,r.jsx)("div",{className:"fixed top-0 left-0 right-0 z-50",children:(0,r.jsx)("div",{className:"progress-bar",style:{width:"".concat(R,"%")}})}),(0,r.jsx)("header",{className:"fixed top-0 left-0 right-0 z-40 transition-transform duration-300 ".concat(U?"translate-y-0":"-translate-y-full"),children:(0,r.jsx)("div",{className:"".concat(ec[i.theme]," bg-opacity-95 backdrop-blur-sm shadow-md"),children:(0,r.jsxs)("div",{className:"flex items-center justify-between px-4 py-3",children:[(0,r.jsx)("button",{onClick:e=>{e.stopPropagation(),s(null)},className:"p-2 rounded-lg hover:bg-black/10 dark:hover:bg-white/10",children:"← Library"}),(0,r.jsxs)("div",{className:"flex-1 text-center px-4",children:[(0,r.jsx)("h1",{className:"font-semibold truncate",children:null==n?void 0:n.title}),(0,r.jsx)("p",{className:"text-sm opacity-70",children:E||"Reading..."})]}),(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)("button",{onClick:e=>{e.stopPropagation(),el()},className:"p-2 rounded-lg hover:bg-black/10 dark:hover:bg-white/10 transition-colors ".concat(j?"text-amber-500":""),title:j?"Remove Bookmark":"Add Bookmark",children:j?"\uD83D\uDD16":"\uD83C\uDFF7️"}),(0,r.jsxs)("button",{onClick:e=>{e.stopPropagation(),X(!0)},className:"p-2 rounded-lg hover:bg-black/10 dark:hover:bg-white/10 relative",title:"Annotations",children:["\uD83D\uDD8D️",(w.length>0||y.filter(e=>e.bookId===a).length>0)&&(0,r.jsx)("span",{className:"absolute -top-1 -right-1 w-4 h-4 bg-blue-500 text-white text-xs rounded-full flex items-center justify-center",children:w.length+y.filter(e=>e.bookId===a).length})]}),(0,r.jsx)("button",{onClick:e=>{e.stopPropagation(),q(!0)},className:"p-2 rounded-lg hover:bg-black/10 dark:hover:bg-white/10",title:"Vocabulary",children:"\uD83D\uDCDA"}),(0,r.jsx)("button",{onClick:e=>{e.stopPropagation(),g()},className:"p-2 rounded-lg hover:bg-black/10 dark:hover:bg-white/10",title:"Table of Contents",children:"\uD83D\uDCD6"}),(0,r.jsx)("button",{onClick:e=>{e.stopPropagation(),u()},className:"p-2 rounded-lg hover:bg-black/10 dark:hover:bg-white/10",title:"Settings",children:"⚙️"})]})]})})}),(0,r.jsx)("main",{className:"fixed inset-0 pt-16 pb-16",children:(0,r.jsx)("div",{ref:J,className:"w-full h-full",style:{padding:"small"===i.marginSize?"0 16px":"medium"===i.marginSize?"0 32px":"0 48px"}})}),C&&(0,r.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-inherit",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"}),(0,r.jsx)("p",{children:"Loading book..."})]})}),(0,r.jsx)("footer",{className:"fixed bottom-0 left-0 right-0 z-40 transition-transform duration-300 ".concat(U?"translate-y-0":"translate-y-full"),children:(0,r.jsx)("div",{className:"".concat(ec[i.theme]," bg-opacity-95 backdrop-blur-sm shadow-[0_-2px_10px_rgba(0,0,0,0.1)]"),children:(0,r.jsxs)("div",{className:"flex items-center justify-between px-4 py-3",children:[(0,r.jsx)("button",{onClick:e=>{e.stopPropagation(),en()},className:"px-4 py-2 rounded-lg hover:bg-black/10 dark:hover:bg-white/10",children:"← Prev"}),(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsxs)("p",{className:"text-sm opacity-70",children:[H," / ",W]}),(0,r.jsxs)("p",{className:"text-xs opacity-50",children:[R,"% complete"]})]}),(0,r.jsx)("button",{onClick:e=>{e.stopPropagation(),es()},className:"px-4 py-2 rounded-lg hover:bg-black/10 dark:hover:bg-white/10",children:"Next →"})]})})}),d&&(0,r.jsx)(p,{}),h&&(0,r.jsx)(f,{items:M,currentIndex:-1,onSelect:e=>{let t=M[e];t&&ee.current&&ee.current.display(t.href),g()}}),K&&(0,r.jsx)(N,{position:K.position,selectedText:K.selectedText,cfi:K.cfi,bookId:a,onClose:()=>$(null)}),G&&(0,r.jsx)(D,{bookId:a,onNavigate:e=>{ee.current&&(ee.current.display(e),X(!1))},onClose:()=>X(!1)}),(0,r.jsx)(S,{isOpen:Z,onClose:()=>q(!1),bookId:a})]})}let L=["pride-prejudice","moby-dick","frankenstein"];function z(){let{currentBook:e}=o(),[t,a]=(0,c.useState)(null),[n,s]=(0,c.useState)(!1);return((0,c.useEffect)(()=>{if(!e){(null==t?void 0:t.startsWith("blob:"))&&URL.revokeObjectURL(t),a(null);return}(async()=>{s(!0);try{let t=await g(e.id);if(t){a(function(e){let t=new Blob([e],{type:"application/epub+zip"});return URL.createObjectURL(t)}(t));return}if(L.includes(e.id)){a(function(e){{let t=window.location.pathname.replace(/\/$/,"");return"".concat(t,"/books/").concat(e,".epub")}}(e.id));return}a(null)}catch(e){console.error("Error loading EPUB:",e),a(null)}finally{s(!1)}})()},[null==e?void 0:e.id]),(0,c.useEffect)(()=>()=>{(null==t?void 0:t.startsWith("blob:"))&&URL.revokeObjectURL(t)},[t]),e)?n?(0,r.jsx)("main",{className:"min-h-screen bg-gray-100 dark:bg-gray-900 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-gray-600 dark:text-gray-300",children:"Preparing book..."})]})}):t?(0,r.jsx)("main",{className:"min-h-screen bg-gray-100 dark:bg-gray-900",children:(0,r.jsx)(B,{bookUrl:t,bookId:e.id})}):(0,r.jsx)("main",{className:"min-h-screen bg-gray-100 dark:bg-gray-900",children:(0,r.jsx)(k,{})}):(0,r.jsx)("main",{className:"min-h-screen bg-gray-100 dark:bg-gray-900",children:(0,r.jsx)(m,{})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[920,476,441,517,358],()=>t(8791)),_N_E=e.O()}]);