(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{8791:(e,t,a)=>{Promise.resolve().then(a.bind(a,4799))},4799:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>eg});var r=a(5155),s=a(9827),l=a(709);let n={theme:"light",fontSize:18,fontFamily:"serif",lineHeight:1.8,marginSize:"medium"},o={voiceName:null,rate:1,pitch:1,volume:1,autoPageTurn:!0},i=[{id:"pride-prejudice",title:"Pride and Prejudice",author:"Jane Austen",cover:"https://www.gutenberg.org/cache/epub/1342/pg1342.cover.medium.jpg",progress:0},{id:"moby-dick",title:"Moby Dick",author:"Herman Melville",cover:"https://www.gutenberg.org/cache/epub/2701/pg2701.cover.medium.jpg",progress:0},{id:"frankenstein",title:"Frankenstein",author:"Mary Shelley",cover:"https://www.gutenberg.org/cache/epub/84/pg84.cover.medium.jpg",progress:0}],d=(0,s.v)()((0,l.Zr)((e,t)=>({currentBook:null,books:i,highlights:[],bookmarks:[],vocabulary:[],settings:n,ttsSettings:o,isSettingsOpen:!1,isTocOpen:!1,setCurrentBook:t=>e({currentBook:t}),addBook:t=>e(e=>({books:[...e.books,t]})),removeBook:t=>e(e=>({books:e.books.filter(e=>e.id!==t)})),updateBookProgress:(t,a,r,s)=>e(e=>{var l;return{books:e.books.map(e=>e.id===t?{...e,progress:a,currentCfi:null!=r?r:e.currentCfi,currentLocation:null!=s?s:e.currentLocation,lastRead:Date.now()}:e),currentBook:(null===(l=e.currentBook)||void 0===l?void 0:l.id)===t?{...e.currentBook,progress:a,currentCfi:null!=r?r:e.currentBook.currentCfi,currentLocation:null!=s?s:e.currentBook.currentLocation}:e.currentBook}}),updateBookMetadata:(t,a)=>e(e=>{var r;return{books:e.books.map(e=>e.id===t?{...e,...a}:e),currentBook:(null===(r=e.currentBook)||void 0===r?void 0:r.id)===t?{...e.currentBook,...a}:e.currentBook}}),addHighlight:t=>e(e=>({highlights:[...e.highlights,{...t,id:crypto.randomUUID(),createdAt:Date.now()}]})),removeHighlight:t=>e(e=>({highlights:e.highlights.filter(e=>e.id!==t)})),addBookmark:t=>e(e=>({bookmarks:[...e.bookmarks,{...t,id:crypto.randomUUID(),createdAt:Date.now()}]})),removeBookmark:t=>e(e=>({bookmarks:e.bookmarks.filter(e=>e.id!==t)})),addVocabularyWord:t=>e(e=>e.vocabulary.some(e=>e.word.toLowerCase()===t.word.toLowerCase())?e:{vocabulary:[...e.vocabulary,{...t,id:crypto.randomUUID(),createdAt:Date.now()}]}),removeVocabularyWord:t=>e(e=>({vocabulary:e.vocabulary.filter(e=>e.id!==t)})),updateSettings:t=>e(e=>({settings:{...e.settings,...t}})),updateTtsSettings:t=>e(e=>({ttsSettings:{...e.ttsSettings,...t}})),toggleSettings:()=>e(e=>({isSettingsOpen:!e.isSettingsOpen})),toggleToc:()=>e(e=>({isTocOpen:!e.isTocOpen}))}),{name:"onde-reader-storage",partialize:e=>({books:e.books,highlights:e.highlights,bookmarks:e.bookmarks,vocabulary:e.vocabulary,settings:e.settings,ttsSettings:e.ttsSettings})}));var c=a(2115);let u="epubs";function g(){return new Promise((e,t)=>{let a=indexedDB.open("onde-reader-db",1);a.onerror=()=>t(a.error),a.onupgradeneeded=()=>{let e=a.result;e.objectStoreNames.contains(u)||e.createObjectStore(u,{keyPath:"id"})},a.onsuccess=()=>e(a.result)})}async function m(e,t){let a=await g();return new Promise((r,s)=>{let l=a.transaction(u,"readwrite");l.objectStore(u).put({id:e,data:t}),l.oncomplete=()=>{a.close(),r()},l.onerror=()=>{a.close(),s(l.error)}})}async function h(e){let t=await g();return new Promise((a,r)=>{let s=t.transaction(u,"readonly").objectStore(u).get(e);s.onsuccess=()=>{var e;t.close();let r=s.result;a(null!==(e=null==r?void 0:r.data)&&void 0!==e?e:null)},s.onerror=()=>{t.close(),r(s.error)}})}function x(e,t){return Math.ceil(e*(1-t/100))}function b(e){if(e<60)return"".concat(e,"m");let t=Math.floor(e/60),a=e%60;return 0===a?"".concat(t,"h"):"".concat(t,"h ").concat(a,"m")}function p(e){let{className:t="",compact:a=!1}=e,{isOnline:s,wasOffline:l}=function(){let[e,t]=(0,c.useState)(!0),[a,r]=(0,c.useState)(!1),s=(0,c.useCallback)(async()=>{try{return(await fetch("/manifest.json",{method:"HEAD",cache:"no-store"})).ok}catch(e){return!1}},[]);return(0,c.useEffect)(()=>{"undefined"!=typeof navigator&&t(navigator.onLine);let e=()=>{t(!0),r(!0),setTimeout(()=>r(!1),3e3)},a=()=>{t(!1),r(!1)};return window.addEventListener("online",e),window.addEventListener("offline",a),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",a)}},[]),{isOnline:e,wasOffline:a,checkConnectivity:s}}();return s&&!l?null:s?l?(0,r.jsxs)("div",{className:"flex items-center gap-1.5 ".concat(a?"text-xs":"text-sm"," text-green-600 dark:text-green-400 ").concat(t),children:[(0,r.jsx)("span",{className:"relative flex h-2 w-2",children:(0,r.jsx)("span",{className:"relative inline-flex rounded-full h-2 w-2 bg-green-500"})}),!a&&(0,r.jsx)("span",{children:"Back online"})]}):null:(0,r.jsxs)("div",{className:"flex items-center gap-1.5 ".concat(a?"text-xs":"text-sm"," ").concat(t),title:"You're offline. Books you've opened will still work.",children:[(0,r.jsxs)("span",{className:"relative flex h-2 w-2",children:[(0,r.jsx)("span",{className:"absolute inline-flex h-full w-full rounded-full bg-yellow-400 opacity-75 animate-ping"}),(0,r.jsx)("span",{className:"relative inline-flex rounded-full h-2 w-2 bg-yellow-500"})]}),!a&&(0,r.jsx)("span",{className:"text-yellow-600 dark:text-yellow-400",children:"Offline"})]})}let y="onde-reader-library-prefs";function f(){let{books:e,setCurrentBook:t,addBook:a,settings:s}=d(),[l,n]=(0,c.useState)(!1),[o,i]=(0,c.useState)(!1),[u,g]=(0,c.useState)([]),h=(0,c.useRef)(null),x=(0,c.useRef)(0),[b,f]=(0,c.useState)(""),[j,w]=(0,c.useState)("all"),[N,S]=(0,c.useState)("recent"),[C,D]=(0,c.useState)(!1);(0,c.useEffect)(()=>{let e=function(){try{let e=localStorage.getItem(y);if(e)return JSON.parse(e)}catch(e){}return{filter:"all",sort:"recent"}}();w(e.filter),S(e.sort)},[]),(0,c.useEffect)(()=>{!function(e){try{localStorage.setItem(y,JSON.stringify(e))}catch(e){}}({filter:j,sort:N})},[j,N]);let R=(0,c.useMemo)(()=>{let t=[...e];if(b.trim()){let e=b.toLowerCase();t=t.filter(t=>t.title.toLowerCase().includes(e)||t.author.toLowerCase().includes(e))}switch(j){case"reading":t=t.filter(e=>e.progress>0&&e.progress<100);break;case"completed":t=t.filter(e=>e.progress>=100);break;case"unread":t=t.filter(e=>0===e.progress||!e.progress)}switch(N){case"recent":t.sort((e,t)=>(t.lastRead||0)-(e.lastRead||0));break;case"title":t.sort((e,t)=>e.title.localeCompare(t.title));break;case"author":t.sort((e,t)=>e.author.localeCompare(t.author));break;case"progress":t.sort((e,t)=>(t.progress||0)-(e.progress||0))}return t},[e,b,j,N]),A=e=>{t(e)},M=async(e,t,a)=>{try{g(t=>t.map(t=>t.fileName===e.name?{...t,status:"uploading",progress:30}:t));let t={id:crypto.randomUUID(),title:e.name.replace(".epub",""),author:"Unknown Author",progress:0},a=await e.arrayBuffer();return g(t=>t.map(t=>t.fileName===e.name?{...t,progress:60}:t)),await m(t.id,a),g(t=>t.map(t=>t.fileName===e.name?{...t,status:"done",progress:100}:t)),t}catch(t){return console.error("Failed to upload ".concat(e.name,":"),t),g(t=>t.map(t=>t.fileName===e.name?{...t,status:"error"}:t)),null}},T=async e=>{let r=Array.from(e).filter(e=>e.name.toLowerCase().endsWith(".epub"));if(0===r.length)return;n(!0),g(r.map(e=>({fileName:e.name,progress:0,status:"pending"})));let s=[];for(let e=0;e<r.length;e++){let t=await M(r[e],e,r.length);t&&(s.push(t),a(t))}s.length>0&&t(s[s.length-1]),setTimeout(()=>{g([]),n(!1)},1500)},L=async e=>{let t=e.target.files;t&&0!==t.length&&(await T(t),h.current&&(h.current.value=""))},E=(0,c.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),x.current++,e.dataTransfer.items&&e.dataTransfer.items.length>0&&i(!0)},[]),B=(0,c.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),x.current--,0===x.current&&i(!1)},[]),P=(0,c.useCallback)(e=>{e.preventDefault(),e.stopPropagation()},[]),I=(0,c.useCallback)(async e=>{e.preventDefault(),e.stopPropagation(),i(!1),x.current=0;let t=e.dataTransfer.files;t&&t.length>0&&await T(t)},[]);return(0,r.jsxs)("div",{onDragEnter:E,onDragLeave:B,onDragOver:P,onDrop:I,className:"min-h-screen p-8 relative ".concat("dark"===s.theme?"bg-gray-900 text-white":"sepia"===s.theme?"bg-sepia-100 text-sepia-900":"bg-gray-50 text-gray-900"),children:[o&&(0,r.jsx)("div",{className:"fixed inset-0 z-50 bg-blue-500/20 backdrop-blur-sm flex items-center justify-center pointer-events-none",children:(0,r.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-2xl p-12 text-center border-4 border-dashed border-blue-500 animate-pulse",children:[(0,r.jsx)("div",{className:"text-6xl mb-4",children:"\uD83D\uDCDA"}),(0,r.jsx)("h3",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:"Drop your EPUBs here!"}),(0,r.jsx)("p",{className:"text-gray-600 dark:text-gray-300 mt-2",children:"Release to add to your library"})]})}),u.length>0&&(0,r.jsx)("div",{className:"fixed inset-0 z-40 bg-black/50 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-2xl p-6 max-w-md w-full mx-4",children:[(0,r.jsxs)("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[(0,r.jsx)("span",{className:"animate-spin",children:"\uD83D\uDCD6"}),"Uploading ",u.length," book",u.length>1?"s":"","..."]}),(0,r.jsx)("div",{className:"space-y-3",children:u.map((e,t)=>(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,r.jsx)("span",{className:"truncate max-w-[200px]",children:e.fileName}),(0,r.jsxs)("span",{className:"flex items-center gap-1",children:["done"===e.status&&(0,r.jsx)("span",{className:"text-green-500",children:"✓"}),"error"===e.status&&(0,r.jsx)("span",{className:"text-red-500",children:"✗"}),"uploading"===e.status&&(0,r.jsx)("span",{className:"animate-spin",children:"⏳"}),"pending"===e.status&&(0,r.jsx)("span",{className:"opacity-50",children:"⋯"})]})]}),(0,r.jsx)("div",{className:"h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:(0,r.jsx)("div",{className:"h-full transition-all duration-300 ".concat("error"===e.status?"bg-red-500":"done"===e.status?"bg-green-500":"bg-blue-500"),style:{width:"".concat(e.progress,"%")}})})]},t))})]})}),(0,r.jsx)("header",{className:"max-w-6xl mx-auto mb-12",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("h1",{className:"text-4xl font-bold tracking-tight",children:"\uD83D\uDCDA Library"}),(0,r.jsx)(p,{})]}),(0,r.jsx)("p",{className:"text-lg opacity-70 mt-2",children:"Your personal reading collection"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsxs)("a",{href:"/reader-vr/",className:"flex items-center gap-2 px-5 py-3 bg-purple-600 text-white rounded-xl hover:bg-purple-700 transition-colors",title:"Try VR Reading Mode",children:[(0,r.jsx)("span",{children:"\uD83E\uDD7D"}),"VR Mode"]}),(0,r.jsx)("button",{onClick:()=>{var e;return null===(e=h.current)||void 0===e?void 0:e.click()},disabled:l,className:"flex items-center gap-2 px-6 py-3 bg-blue-600 text-white rounded-xl hover:bg-blue-700 transition-colors disabled:opacity-50",children:l?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{className:"animate-spin",children:"⏳"}),"Uploading..."]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{children:"➕"}),"Add Book"]})})]}),(0,r.jsx)("input",{ref:h,type:"file",accept:".epub",multiple:!0,onChange:L,className:"hidden"})]})}),(0,r.jsxs)("div",{className:"max-w-6xl mx-auto mb-8",children:[(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4",children:[(0,r.jsxs)("div",{className:"relative flex-1",children:[(0,r.jsx)("input",{type:"text",placeholder:"Search by title or author...",value:b,onChange:e=>f(e.target.value),className:"w-full pl-10 pr-4 py-3 rounded-xl border focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors ".concat("dark"===s.theme?"bg-gray-800 border-gray-700 text-white placeholder-gray-400":"sepia"===s.theme?"bg-sepia-50 border-sepia-300 text-sepia-900 placeholder-sepia-500":"bg-white border-gray-200 text-gray-900 placeholder-gray-400")}),(0,r.jsx)("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-xl",children:"\uD83D\uDD0D"}),b&&(0,r.jsx)("button",{onClick:()=>f(""),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:"✕"})]}),(0,r.jsxs)("button",{onClick:()=>D(!C),className:"sm:hidden px-4 py-3 rounded-xl border flex items-center justify-center gap-2 ".concat("dark"===s.theme?"bg-gray-800 border-gray-700 text-white":"sepia"===s.theme?"bg-sepia-50 border-sepia-300 text-sepia-900":"bg-white border-gray-200 text-gray-900"),children:[(0,r.jsx)("span",{children:"\uD83C\uDF9B️"}),"Filters",("all"!==j||"recent"!==N)&&(0,r.jsx)("span",{className:"w-2 h-2 bg-blue-500 rounded-full"})]}),(0,r.jsxs)("div",{className:"flex gap-3 ".concat(C?"flex":"hidden sm:flex"),children:[(0,r.jsxs)("select",{value:j,onChange:e=>w(e.target.value),className:"px-4 py-3 rounded-xl border focus:outline-none focus:ring-2 focus:ring-blue-500 cursor-pointer ".concat("dark"===s.theme?"bg-gray-800 border-gray-700 text-white":"sepia"===s.theme?"bg-sepia-50 border-sepia-300 text-sepia-900":"bg-white border-gray-200 text-gray-900"),children:[(0,r.jsx)("option",{value:"all",children:"\uD83D\uDCDA All Books"}),(0,r.jsx)("option",{value:"reading",children:"\uD83D\uDCD6 Currently Reading"}),(0,r.jsx)("option",{value:"completed",children:"✅ Completed"}),(0,r.jsx)("option",{value:"unread",children:"\uD83C\uDD95 Unread"})]}),(0,r.jsxs)("select",{value:N,onChange:e=>S(e.target.value),className:"px-4 py-3 rounded-xl border focus:outline-none focus:ring-2 focus:ring-blue-500 cursor-pointer ".concat("dark"===s.theme?"bg-gray-800 border-gray-700 text-white":"sepia"===s.theme?"bg-sepia-50 border-sepia-300 text-sepia-900":"bg-white border-gray-200 text-gray-900"),children:[(0,r.jsx)("option",{value:"recent",children:"\uD83D\uDD50 Recently Read"}),(0,r.jsx)("option",{value:"title",children:"\uD83D\uDD24 Title A-Z"}),(0,r.jsx)("option",{value:"author",children:"\uD83D\uDC64 Author A-Z"}),(0,r.jsx)("option",{value:"progress",children:"\uD83D\uDCCA Progress"})]})]})]}),(b||"all"!==j)&&(0,r.jsxs)("p",{className:"mt-3 text-sm opacity-70",children:[R.length," book",1!==R.length?"s":""," found",b&&' for "'.concat(b,'"'),"all"!==j&&" (".concat(j,")")]})]}),!b&&"all"===j&&e.some(e=>e.progress>0&&e.progress<100)&&(0,r.jsxs)("section",{className:"max-w-6xl mx-auto mb-12",children:[(0,r.jsx)("h2",{className:"text-2xl font-semibold mb-6",children:"\uD83D\uDCD6 Continue Reading"}),(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:e.filter(e=>e.progress>0&&e.progress<100).sort((e,t)=>(t.lastRead||0)-(e.lastRead||0)).slice(0,3).map(e=>(0,r.jsx)(k,{book:e,onClick:A},e.id))})]}),(0,r.jsxs)("section",{className:"max-w-6xl mx-auto",children:[(0,r.jsx)("h2",{className:"text-2xl font-semibold mb-6",children:"all"===j?"\uD83D\uDCDA All Books":"reading"===j?"\uD83D\uDCD6 Currently Reading":"completed"===j?"✅ Completed":"\uD83C\uDD95 Unread"}),(0,r.jsxs)("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-6",children:[0===R.length&&(b||"all"!==j)?(0,r.jsxs)("div",{className:"col-span-full text-center py-12 opacity-60",children:[(0,r.jsx)("span",{className:"text-4xl block mb-4",children:"\uD83D\uDCED"}),(0,r.jsx)("p",{children:"No books found"}),(0,r.jsx)("button",{onClick:()=>{f(""),w("all")},className:"mt-2 text-blue-500 hover:underline",children:"Clear filters"})]}):R.map(e=>(0,r.jsx)(v,{book:e,onClick:A},e.id)),(0,r.jsxs)("button",{onClick:()=>{var e;return null===(e=h.current)||void 0===e?void 0:e.click()},className:"aspect-[2/3] rounded-xl border-2 border-dashed flex flex-col items-center justify-center gap-3 transition-colors ".concat(o?"border-blue-500 bg-blue-50 dark:bg-blue-900/30 scale-105":"border-gray-300 dark:border-gray-700 hover:border-blue-500 hover:bg-blue-50 dark:hover:bg-blue-900/20"),children:[(0,r.jsx)("span",{className:"text-4xl",children:o?"\uD83D\uDCE5":"➕"}),(0,r.jsx)("span",{className:"text-sm opacity-70 text-center px-2",children:o?"Drop here!":"Add EPUB(s)"}),(0,r.jsx)("span",{className:"text-xs opacity-40",children:"or drag & drop"})]})]})]})]})}function v(e){let{book:t,onClick:a}=e,s=t.estimatedReadingMinutes&&t.progress>0?x(t.estimatedReadingMinutes,t.progress):t.estimatedReadingMinutes;return(0,r.jsxs)("button",{onClick:()=>a(t),className:"group relative aspect-[2/3] rounded-xl overflow-hidden shadow-lg hover:shadow-xl transition-all hover:-translate-y-1",children:[t.cover?(0,r.jsx)("img",{src:t.cover,alt:t.title,className:"w-full h-full object-cover"}):(0,r.jsx)("div",{className:"w-full h-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center p-4",children:(0,r.jsx)("span",{className:"text-white text-center font-medium line-clamp-3",children:t.title})}),s&&(0,r.jsxs)("div",{className:"absolute top-2 right-2 bg-black/60 text-white text-xs px-2 py-1 rounded-full flex items-center gap-1",children:[(0,r.jsx)("span",{children:"⏱️"}),(0,r.jsx)("span",{children:b(s)})]}),t.progress>0&&(0,r.jsx)("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-black/20",children:(0,r.jsx)("div",{className:"h-full bg-green-500",style:{width:"".concat(t.progress,"%")}})}),(0,r.jsxs)("div",{className:"absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity flex flex-col items-center justify-center p-4",children:[(0,r.jsx)("span",{className:"text-white text-center font-medium line-clamp-2",children:t.title}),(0,r.jsx)("span",{className:"text-white/70 text-sm mt-1",children:t.author}),t.progress>0&&(0,r.jsxs)("span",{className:"text-green-400 text-sm mt-2",children:[Math.round(t.progress),"% complete"]}),s&&(0,r.jsx)("span",{className:"text-blue-300 text-sm mt-1",children:t.progress>0?"".concat(b(s)," left"):b(s)})]})]})}function k(e){let{book:t,onClick:a}=e,s=t.estimatedReadingMinutes?x(t.estimatedReadingMinutes,t.progress):void 0;return(0,r.jsxs)("button",{onClick:()=>a(t),className:"flex gap-4 p-4 bg-white dark:bg-gray-800 rounded-xl shadow-md hover:shadow-lg transition-all hover:-translate-y-1",children:[(0,r.jsx)("div",{className:"w-20 h-28 rounded-lg overflow-hidden flex-shrink-0",children:t.cover?(0,r.jsx)("img",{src:t.cover,alt:t.title,className:"w-full h-full object-cover"}):(0,r.jsx)("div",{className:"w-full h-full bg-gradient-to-br from-blue-500 to-purple-600"})}),(0,r.jsxs)("div",{className:"flex-1 text-left",children:[(0,r.jsx)("h3",{className:"font-semibold line-clamp-2",children:t.title}),(0,r.jsx)("p",{className:"text-sm opacity-70",children:t.author}),(0,r.jsxs)("div",{className:"mt-3",children:[(0,r.jsx)("div",{className:"h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:(0,r.jsx)("div",{className:"h-full bg-gradient-to-r from-blue-500 to-purple-500",style:{width:"".concat(t.progress,"%")}})}),(0,r.jsxs)("div",{className:"flex justify-between items-center mt-1",children:[(0,r.jsxs)("p",{className:"text-xs opacity-60",children:[Math.round(t.progress),"% complete"]}),s&&(0,r.jsxs)("p",{className:"text-xs text-blue-500",children:["⏱️ ",b(s)," left"]})]})]})]})]})}var j=a(5453),w=a(2818);let N=w.env.NEXT_PUBLIC_SUPABASE_URL||"https://reader-sync.supabase.co",S=w.env.NEXT_PUBLIC_SUPABASE_ANON_KEY||"",C=!!(N&&S),D=C?(0,j.UU)(N,S):null,R="onde-reader-device-id",A="onde-reader-sync-code";function M(){let e=localStorage.getItem(R);return e||(e=crypto.randomUUID(),localStorage.setItem(R,e)),e}function T(){return localStorage.getItem(A)}function L(e){localStorage.setItem(A,e)}let E="onde-reader-sync-status",B={enabled:!1,syncCode:null,lastSyncedAt:null,isSyncing:!1,error:null,deviceCount:1};function P(){let e=localStorage.getItem(E);if(e)try{let t=JSON.parse(e);B={...B,...t,isSyncing:!1}}catch(e){}return B.syncCode=T(),B.enabled=!!B.syncCode,B}function I(e){B={...B,...e},localStorage.setItem(E,JSON.stringify({lastSyncedAt:B.lastSyncedAt,deviceCount:B.deviceCount}))}async function U(){let e=function(){let e="ABCDEFGHJKLMNPQRSTUVWXYZ23456789",t="";for(let a=0;a<6;a++)t+=e.charAt(Math.floor(Math.random()*e.length));return t}(),t=M();if(!C||!D)return L(e),I({enabled:!0,syncCode:e,deviceCount:1,error:null}),{success:!0,syncCode:e};try{let{data:a}=await D.from("reader_sync").select("sync_code").eq("sync_code",e).single();if(a)return U();let{error:r}=await D.from("reader_sync").insert({sync_code:e,device_id:t,data:null,created_at:new Date().toISOString()});if(r)throw r;return L(e),I({enabled:!0,syncCode:e,deviceCount:1,error:null}),{success:!0,syncCode:e}}catch(a){let t=a instanceof Error?a.message:"Failed to enable sync";return I({error:t}),{success:!1,syncCode:e,error:t}}}async function z(e){let t=e.toUpperCase().trim();if(!/^[A-Z0-9]{6}$/.test(t))return{success:!1,error:"Invalid sync code format"};if(!C||!D)return L(t),I({enabled:!0,syncCode:t,error:null}),{success:!0};try{let{data:e,error:a}=await D.from("reader_sync").select("sync_code, data").eq("sync_code",t).single();if(a||!e)return{success:!1,error:"Sync code not found"};return L(t),I({enabled:!0,syncCode:t,error:null}),{success:!0}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to join sync"}}}async function F(e){let t=T();if(!t)return{success:!1,error:"Sync not enabled"};if(I({isSyncing:!0}),C&&D)try{let a={version:1,syncCode:t,deviceId:M(),lastSyncedAt:Date.now(),data:e},{error:r}=await D.from("reader_sync").upsert({sync_code:t,device_id:M(),data:a,updated_at:new Date().toISOString()},{onConflict:"sync_code"});if(r)throw r;return I({lastSyncedAt:Date.now(),isSyncing:!1,error:null}),{success:!0}}catch(t){let e=t instanceof Error?t.message:"Push failed";return I({isSyncing:!1,error:e}),{success:!1,error:e}}else{let a={version:1,syncCode:t,deviceId:M(),lastSyncedAt:Date.now(),data:e};return localStorage.setItem("onde-reader-sync-".concat(t),JSON.stringify(a)),I({lastSyncedAt:Date.now(),isSyncing:!1,error:null}),{success:!0}}}async function O(){let e=T();if(!e)return{success:!1,error:"Sync not enabled"};if(I({isSyncing:!0}),C&&D)try{let{data:t,error:a}=await D.from("reader_sync").select("data").eq("sync_code",e).single();if(a)throw a;if(!(null==t?void 0:t.data))return I({isSyncing:!1}),{success:!0,data:void 0};let r=t.data;return I({lastSyncedAt:Date.now(),isSyncing:!1,error:null}),{success:!0,data:r.data}}catch(t){let e=t instanceof Error?t.message:"Pull failed";return I({isSyncing:!1,error:e}),{success:!1,error:e}}else{let t=localStorage.getItem("onde-reader-sync-".concat(e));if(!t)return I({isSyncing:!1}),{success:!0,data:void 0};try{let e=JSON.parse(t);return I({lastSyncedAt:Date.now(),isSyncing:!1,error:null}),{success:!0,data:e.data}}catch(e){return I({isSyncing:!1,error:"Invalid sync data"}),{success:!1,error:"Invalid sync data"}}}}async function _(e){if(!T())return{success:!1,error:"Sync not enabled"};let t=await O();if(!t.success)return{success:!1,error:t.error};if(!t.data){let t=await F(e);return{success:t.success,mergedData:e,error:t.error}}let a=function(e,t){function a(e,t){let a=new Map;for(let t of e)a.set(t.id,t);for(let e of t){let t=a.get(e.id);if(t){let r=t.createdAt||0;(e.createdAt||Date.now())>=r&&a.set(e.id,e)}else a.set(e.id,e)}return Array.from(a.values())}let r=a(e.books,t.books).map(a=>{let r=e.books.find(e=>e.id===a.id),s=t.books.find(e=>e.id===a.id);return r&&s?{...a,progress:Math.max(r.progress||0,s.progress||0),lastRead:Math.max(r.lastRead||0,s.lastRead||0),currentLocation:(r.lastRead||0)>(s.lastRead||0)?r.currentLocation:s.currentLocation,currentCfi:(r.lastRead||0)>(s.lastRead||0)?r.currentCfi:s.currentCfi}:a}),s=a(e.highlights,t.highlights),l=a(e.bookmarks,t.bookmarks);return{books:r,highlights:s,bookmarks:l,vocabulary:a(e.vocabulary,t.vocabulary),settings:e.settings,ttsSettings:e.ttsSettings}}(e,t.data),r=await F(a);return{success:r.success,mergedData:r.success?a:void 0,error:r.error}}function H(e){let{className:t=""}=e,{isEnabled:a,isSyncing:s,lastSyncedAt:l,syncCode:n,error:o,enable:i,join:u,disable:g,sync:m}=function(){let[e,t]=(0,c.useState)(()=>P()),a=(0,c.useRef)(null),r=d(e=>e.books),s=d(e=>e.highlights),l=d(e=>e.bookmarks),n=d(e=>e.vocabulary),o=d(e=>e.settings),i=d(e=>e.ttsSettings),u=d(e=>e.addBook),g=d(e=>e.removeBook),m=d(e=>e.addHighlight),h=d(e=>e.removeHighlight),x=d(e=>e.addBookmark),b=d(e=>e.removeBookmark),p=d(e=>e.addVocabularyWord),y=d(e=>e.updateSettings),f=d(e=>e.updateTtsSettings);(0,c.useEffect)(()=>{let e=setInterval(()=>{t(P())},5e3);return()=>clearInterval(e)},[]);let v=(0,c.useCallback)(()=>({books:r,highlights:s,bookmarks:l,vocabulary:n,settings:o,ttsSettings:i}),[r,s,l,n,o,i]),k=(0,c.useCallback)(e=>{let t=new Set(r.map(e=>e.id)),a=new Set(e.books.map(e=>e.id));for(let e of r)a.has(e.id)||g(e.id);for(let a of e.books)t.has(a.id)||u(a);let n=new Set(s.map(e=>e.id)),o=new Set(e.highlights.map(e=>e.id));for(let e of s)o.has(e.id)||h(e.id);for(let t of e.highlights)n.has(t.id)||m(t);let i=new Set(l.map(e=>e.id)),d=new Set(e.bookmarks.map(e=>e.id));for(let e of l)d.has(e.id)||b(e.id);for(let t of e.bookmarks)i.has(t.id)||x(t);for(let t of e.vocabulary)p(t)},[r,s,l,u,g,m,h,x,b,p,y,f]),j=(0,c.useCallback)(async()=>{if(!e.enabled)return{success:!1,error:"Sync not enabled"};t(e=>({...e,isSyncing:!0}));let a=await _(v());return a.success&&a.mergedData&&k(a.mergedData),t(P()),{success:a.success,error:a.error}},[e.enabled,v,k]);return(0,c.useEffect)(()=>{if(e.enabled)return a.current&&clearTimeout(a.current),a.current=setTimeout(()=>{j()},5e3),()=>{a.current&&clearTimeout(a.current)}},[e.enabled,r,s,l,n]),{status:e,enable:(0,c.useCallback)(async()=>{let e=await U();return t(P()),e.success&&await j(),e},[j]),join:(0,c.useCallback)(async e=>{let a=await z(e);return t(P()),a.success&&await j(),a},[j]),disable:(0,c.useCallback)(()=>{localStorage.removeItem(A),I({enabled:!1,syncCode:null,deviceCount:1,error:null}),t(P())},[]),sync:j,isEnabled:e.enabled,isSyncing:e.isSyncing,lastSyncedAt:e.lastSyncedAt,syncCode:e.syncCode,error:e.error}}(),[h,x]=(0,c.useState)(""),[b,p]=(0,c.useState)(!1),[y,f]=(0,c.useState)(!1),[v,k]=(0,c.useState)(null),[j,w]=(0,c.useState)(!1),N=(0,c.useCallback)(async()=>{w(!0),k(null);let e=await i();e.success||k(e.error||"Failed to enable sync"),w(!1)},[i]),S=(0,c.useCallback)(async()=>{if(!h.trim())return;w(!0),k(null);let e=await u(h.trim());e.success?(x(""),p(!1)):k(e.error||"Failed to join sync"),w(!1)},[u,h]),D=(0,c.useCallback)(async()=>{if(n)try{await navigator.clipboard.writeText(n),f(!0),setTimeout(()=>f(!1),2e3)}catch(t){let e=document.createElement("textarea");e.value=n,document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e),f(!0),setTimeout(()=>f(!1),2e3)}},[n]),R=(0,c.useCallback)(async()=>{w(!0),k(null);let e=await m();e.success||k(e.error||"Sync failed"),w(!1)},[m]);return(0,r.jsxs)("div",{className:"rounded-lg border border-gray-200 dark:border-gray-700 p-4 ".concat(t),children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,r.jsxs)("h3",{className:"text-lg font-semibold flex items-center gap-2",children:["☁️ Cloud Sync",!C&&(0,r.jsx)("span",{className:"text-xs bg-yellow-100 text-yellow-800 px-2 py-0.5 rounded",children:"Local Only"})]}),a&&(0,r.jsx)("span",{className:"text-sm ".concat(s?"text-blue-500":"text-green-500"),children:s?"⟳ Syncing...":"✓ Connected"})]}),!C&&(0,r.jsx)("p",{className:"text-sm text-gray-500 mb-4",children:"Cloud sync is not configured. You can still use sync codes to manually export/import data between devices using the Backup & Restore feature."}),(o||v)&&(0,r.jsx)("div",{className:"mb-3 p-2 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded text-sm text-red-600 dark:text-red-400",children:v||o}),a?(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-xs text-gray-500 uppercase tracking-wide mb-1",children:"Your Sync Code"}),(0,r.jsx)("p",{className:"font-mono text-2xl tracking-widest",children:n})]}),(0,r.jsx)("button",{onClick:D,className:"px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 hover:bg-white dark:hover:bg-gray-700 rounded-lg transition-colors",children:y?"✓ Copied!":"\uD83D\uDCCB Copy"})]}),(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"Share this code with your other devices to sync your library."}),(0,r.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,r.jsxs)("span",{className:"text-gray-500",children:["Last synced: ",(e=>{if(!e)return"Never";let t=Date.now()-e;return t<6e4?"Just now":t<36e5?"".concat(Math.floor(t/6e4),"m ago"):t<864e5?"".concat(Math.floor(t/36e5),"h ago"):new Date(e).toLocaleDateString()})(l)]}),(0,r.jsx)("button",{onClick:R,disabled:j||s,className:"px-3 py-1 text-blue-500 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded transition-colors disabled:opacity-50",children:s?"⟳ Syncing...":"⟳ Sync Now"})]}),(0,r.jsx)("button",{onClick:g,className:"w-full px-4 py-2 text-sm text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors",children:"Disable Sync"})]}):(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Enable sync to keep your reading progress, highlights, and bookmarks in sync across all your devices."}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{onClick:N,disabled:j,className:"flex-1 px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg font-medium transition-colors disabled:opacity-50",children:j?"Enabling...":"Enable Sync"}),(0,r.jsx)("button",{onClick:()=>p(!b),disabled:j,className:"px-4 py-2 border border-gray-300 dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-800 rounded-lg font-medium transition-colors disabled:opacity-50",children:"Join"})]}),b&&(0,r.jsxs)("div",{className:"flex gap-2 mt-2",children:[(0,r.jsx)("input",{type:"text",value:h,onChange:e=>x(e.target.value.toUpperCase()),placeholder:"Enter 6-letter code",maxLength:6,className:"flex-1 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 font-mono text-center text-lg tracking-widest uppercase"}),(0,r.jsx)("button",{onClick:S,disabled:j||6!==h.length,className:"px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg font-medium transition-colors disabled:opacity-50",children:j?"...":"→"})]})]})]})}let W=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Date;return e.toISOString().split("T")[0]},V=e=>{let t=new Date;return t.setDate(t.getDate()-1),e===W(t)},J=e=>e===W(),Y={totalReadingTimeMs:0,totalPagesRead:0,totalSessions:0,booksCompleted:0,currentStreak:0,longestStreak:0,lastReadDate:null,dailyStats:[],sessionStartTime:null,sessionStartPages:0},Z=(0,s.v)()((0,l.Zr)((e,t)=>({...Y,startSession:()=>{let a=t();a.sessionStartTime||e({sessionStartTime:Date.now(),sessionStartPages:a.totalPagesRead})},endSession:a=>{let r=t();if(!r.sessionStartTime)return;let s=Date.now()-r.sessionStartTime,l=W(),n=r.currentStreak;r.lastReadDate?J(r.lastReadDate)||(V(r.lastReadDate)?n+=1:n=1):n=1;let o=[...r.dailyStats],i=o.findIndex(e=>e.date===l);i>=0?o[i]={...o[i],readingTimeMs:o[i].readingTimeMs+s,pagesRead:o[i].pagesRead+a,sessionsCount:o[i].sessionsCount+1}:o.push({date:l,readingTimeMs:s,pagesRead:a,sessionsCount:1});let d=new Date;d.setDate(d.getDate()-30);let c=W(d),u=o.filter(e=>e.date>=c);e({totalReadingTimeMs:r.totalReadingTimeMs+s,totalPagesRead:r.totalPagesRead+a,totalSessions:r.totalSessions+1,currentStreak:n,longestStreak:Math.max(n,r.longestStreak),lastReadDate:l,dailyStats:u,sessionStartTime:null,sessionStartPages:0})},recordPageTurn:()=>{},recordBookCompleted:()=>{e(e=>({booksCompleted:e.booksCompleted+1}))},getTodayStats:()=>{let e=W();return t().dailyStats.find(t=>t.date===e)},getWeekStats:()=>{let e=new Date;e.setDate(e.getDate()-7);let a=W(e);return t().dailyStats.filter(e=>e.date>=a)},getAverageReadingTime:()=>{let e=t().dailyStats;return 0===e.length?0:e.reduce((e,t)=>e+t.readingTimeMs,0)/e.length},getAveragePagesPerSession:()=>{let e=t();return 0===e.totalSessions?0:e.totalPagesRead/e.totalSessions}}),{name:"onde-reader-stats",partialize:e=>({totalReadingTimeMs:e.totalReadingTimeMs,totalPagesRead:e.totalPagesRead,totalSessions:e.totalSessions,booksCompleted:e.booksCompleted,currentStreak:e.currentStreak,longestStreak:e.longestStreak,lastReadDate:e.lastReadDate,dailyStats:e.dailyStats})})),q=e=>{let t=Math.floor(e/1e3),a=Math.floor(t/60),r=Math.floor(a/60);return r>0?"".concat(r,"h ").concat(a%60,"m"):a>0?"".concat(a,"m"):"".concat(t,"s")};function X(){let{settings:e}=d(),[t,a]=(0,c.useState)(!1),[s,l]=(0,c.useState)({step:"idle",strategy:"merge"}),[n,o]=(0,c.useState)(!1),i=(0,c.useRef)(null),u="dark"===e.theme,g="sepia"===e.theme,m=()=>{!function(){let e=new Blob([function(){let e=d.getState(),t=Z.getState();return JSON.stringify({version:1,exportedAt:new Date().toISOString(),appVersion:"1.0.0",books:e.books,highlights:e.highlights,bookmarks:e.bookmarks,vocabulary:e.vocabulary,settings:e.settings,ttsSettings:e.ttsSettings,stats:{totalReadingTimeMs:t.totalReadingTimeMs,totalPagesRead:t.totalPagesRead,totalSessions:t.totalSessions,booksCompleted:t.booksCompleted,currentStreak:t.currentStreak,longestStreak:t.longestStreak,lastReadDate:t.lastReadDate,dailyStats:t.dailyStats}},null,2)}()],{type:"application/json"}),t=URL.createObjectURL(e),a=new Date().toISOString().split("T")[0],r=document.createElement("a");r.href=t,r.download="onde-reader-backup-".concat(a,".json"),document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(t)}(),o(!0),setTimeout(()=>o(!1),3e3)},h=async e=>{var t;let a=null===(t=e.target.files)||void 0===t?void 0:t[0];if(a){l({step:"validating",strategy:"merge"});try{let e=await new Promise((e,t)=>{let r=new FileReader;r.onload=()=>e(r.result),r.onerror=()=>t(Error("Failed to read file")),r.readAsText(a)}),t=function(e){let t;let a=[],r=[];try{t=JSON.parse(e)}catch(e){return{valid:!1,errors:["Invalid JSON format"],warnings:[]}}if(!t||"object"!=typeof t)return{valid:!1,errors:["Data must be an object"],warnings:[]};let s=t;for(let e of("number"!=typeof s.version?a.push("Missing or invalid version field"):s.version>1&&r.push("Export version ".concat(s.version," is newer than current ").concat(1,". Some data may not import correctly.")),["books","highlights","bookmarks","vocabulary"]))Array.isArray(s[e])||a.push("Missing or invalid ".concat(e," array"));if(s.settings&&"object"==typeof s.settings||a.push("Missing or invalid settings object"),s.ttsSettings&&"object"==typeof s.ttsSettings||a.push("Missing or invalid ttsSettings object"),s.stats&&"object"==typeof s.stats){let e=s.stats;for(let t of["totalReadingTimeMs","totalPagesRead","totalSessions","booksCompleted"])"number"!=typeof e[t]&&a.push("Missing or invalid stats.".concat(t))}else a.push("Missing or invalid stats object");return(Array.isArray(s.books)&&s.books.forEach((e,t)=>{e&&"object"==typeof e?e.id&&e.title&&e.author||r.push("Book at index ".concat(t," may be missing id, title, or author")):a.push("Book at index ".concat(t," is invalid"))}),Array.isArray(s.highlights)&&s.highlights.forEach((e,t)=>{e&&"object"==typeof e?e.id&&e.bookId&&e.cfi&&e.text||r.push("Highlight at index ".concat(t," may be missing required fields")):a.push("Highlight at index ".concat(t," is invalid"))}),a.length>0)?{valid:!1,errors:a,warnings:r}:{valid:!0,errors:[],warnings:r,data:s}}(e);if(!t.valid){l({step:"error",error:t.errors.join("\n"),strategy:"merge"});return}l({step:"preview",validation:t,strategy:"merge"})}catch(e){l({step:"error",error:e instanceof Error?e.message:"Failed to read file",strategy:"merge"})}i.current&&(i.current.value="")}},x=()=>{var e;if(null===(e=s.validation)||void 0===e?void 0:e.data){l(e=>({...e,step:"importing"}));try{let e=function(e,t){let a=d.getState(),r=Z.getState(),s={booksAdded:0,booksUpdated:0,highlightsAdded:0,bookmarksAdded:0,vocabularyAdded:0,settingsUpdated:!1,statsUpdated:!1};if("overwrite"===t)d.setState({books:e.books,highlights:e.highlights,bookmarks:e.bookmarks,vocabulary:e.vocabulary,settings:e.settings,ttsSettings:e.ttsSettings}),Z.setState({totalReadingTimeMs:e.stats.totalReadingTimeMs,totalPagesRead:e.stats.totalPagesRead,totalSessions:e.stats.totalSessions,booksCompleted:e.stats.booksCompleted,currentStreak:e.stats.currentStreak,longestStreak:e.stats.longestStreak,lastReadDate:e.stats.lastReadDate,dailyStats:e.stats.dailyStats}),s.booksAdded=e.books.length,s.highlightsAdded=e.highlights.length,s.bookmarksAdded=e.bookmarks.length,s.vocabularyAdded=e.vocabulary.length,s.settingsUpdated=!0,s.statsUpdated=!0;else{let t=new Set(a.highlights.map(e=>e.id)),l=new Set(a.bookmarks.map(e=>e.id)),n=new Set(a.vocabulary.map(e=>e.word.toLowerCase())),o=[...a.books];for(let t of e.books){let e=o.findIndex(e=>e.id===t.id);e>=0?t.progress>o[e].progress&&(o[e]=t,s.booksUpdated++):(o.push(t),s.booksAdded++)}let i=[...a.highlights];for(let a of e.highlights)!t.has(a.id)&&(i.push(a),s.highlightsAdded++);let c=[...a.bookmarks];for(let t of e.bookmarks)!l.has(t.id)&&(c.push(t),s.bookmarksAdded++);let u=[...a.vocabulary];for(let t of e.vocabulary)!n.has(t.word.toLowerCase())&&(u.push(t),s.vocabularyAdded++);d.setState({books:o,highlights:i,bookmarks:c,vocabulary:u});let g={totalReadingTimeMs:Math.max(r.totalReadingTimeMs,e.stats.totalReadingTimeMs),totalPagesRead:Math.max(r.totalPagesRead,e.stats.totalPagesRead),totalSessions:Math.max(r.totalSessions,e.stats.totalSessions),booksCompleted:Math.max(r.booksCompleted,e.stats.booksCompleted),longestStreak:Math.max(r.longestStreak,e.stats.longestStreak),currentStreak:r.currentStreak,lastReadDate:r.lastReadDate,dailyStats:function(e,t){let a=new Map;for(let t of e)a.set(t.date,t);for(let e of t){let t=a.get(e.date);t?a.set(e.date,{date:e.date,readingTimeMs:Math.max(t.readingTimeMs,e.readingTimeMs),pagesRead:Math.max(t.pagesRead,e.pagesRead),sessionsCount:Math.max(t.sessionsCount,e.sessionsCount)}):a.set(e.date,e)}return Array.from(a.values()).sort((e,t)=>e.date.localeCompare(t.date))}(r.dailyStats,e.stats.dailyStats)};Z.setState(g),s.statsUpdated=!0}return{success:!0,imported:s}}(s.validation.data,s.strategy);l({step:"done",summary:e.imported,strategy:s.strategy})}catch(e){l({step:"error",error:e instanceof Error?e.message:"Import failed",strategy:s.strategy})}}},b=()=>{l({step:"idle",strategy:"merge"})};return(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsxs)("button",{onClick:()=>a(!t),className:"flex items-center justify-between w-full text-sm font-medium opacity-70 mb-3",children:[(0,r.jsx)("span",{children:"\uD83D\uDCBE Backup & Restore"}),(0,r.jsx)("span",{className:"transform transition-transform ".concat(t?"rotate-180":""),children:"▼"})]}),t&&(0,r.jsxs)("div",{className:"space-y-3",children:[(()=>{var e,t,a,n,o,d,c,p,y;switch(s.step){case"validating":return(0,r.jsxs)("div",{className:"flex items-center justify-center py-4",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-500"}),(0,r.jsx)("span",{className:"ml-2 opacity-70",children:"Validating..."})]});case"preview":{let a=null===(e=s.validation)||void 0===e?void 0:e.data;return(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"p-3 rounded-lg ".concat(u?"bg-gray-700":g?"bg-sepia-100":"bg-gray-50"),children:[(0,r.jsx)("h4",{className:"font-medium mb-2",children:"\uD83D\uDCE6 Import Preview"}),(0,r.jsxs)("ul",{className:"text-sm space-y-1 opacity-80",children:[(0,r.jsxs)("li",{children:["• ",(null==a?void 0:a.books.length)||0," books"]}),(0,r.jsxs)("li",{children:["• ",(null==a?void 0:a.highlights.length)||0," highlights"]}),(0,r.jsxs)("li",{children:["• ",(null==a?void 0:a.bookmarks.length)||0," bookmarks"]}),(0,r.jsxs)("li",{children:["• ",(null==a?void 0:a.vocabulary.length)||0," vocabulary words"]})]}),(null===(t=s.validation)||void 0===t?void 0:t.warnings.length)?(0,r.jsxs)("div",{className:"mt-2 text-amber-600 text-xs",children:["⚠️ ",s.validation.warnings.join(", ")]}):null]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-sm font-medium opacity-70 mb-2 block",children:"Import Strategy"}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsxs)("button",{onClick:()=>l(e=>({...e,strategy:"merge"})),className:"flex-1 py-2 px-3 rounded-lg text-sm transition-all ".concat("merge"===s.strategy?"ring-2 ring-blue-500 bg-blue-50 dark:bg-blue-900/30":u?"bg-gray-700":g?"bg-sepia-100":"bg-gray-100"),children:["\uD83D\uDD00 Merge",(0,r.jsx)("span",{className:"block text-xs opacity-60",children:"Keep existing + add new"})]}),(0,r.jsxs)("button",{onClick:()=>l(e=>({...e,strategy:"overwrite"})),className:"flex-1 py-2 px-3 rounded-lg text-sm transition-all ".concat("overwrite"===s.strategy?"ring-2 ring-blue-500 bg-blue-50 dark:bg-blue-900/30":u?"bg-gray-700":g?"bg-sepia-100":"bg-gray-100"),children:["\uD83D\uDD04 Overwrite",(0,r.jsx)("span",{className:"block text-xs opacity-60",children:"Replace all data"})]})]})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{onClick:b,className:"flex-1 py-2 rounded-lg ".concat(u?"bg-gray-700":g?"bg-sepia-100":"bg-gray-200"),children:"Cancel"}),(0,r.jsx)("button",{onClick:x,className:"flex-1 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700",children:"Import"})]})]})}case"importing":return(0,r.jsxs)("div",{className:"flex items-center justify-center py-4",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-500"}),(0,r.jsx)("span",{className:"ml-2 opacity-70",children:"Importing..."})]});case"done":return(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{className:"p-3 bg-green-50 dark:bg-green-900/30 rounded-lg text-green-800 dark:text-green-200",children:[(0,r.jsx)("h4",{className:"font-medium",children:"✅ Import Complete!"}),(0,r.jsxs)("ul",{className:"text-sm mt-2 space-y-1",children:[(null===(a=s.summary)||void 0===a?void 0:a.booksAdded)?(0,r.jsxs)("li",{children:["• ",s.summary.booksAdded," books added"]}):null,(null===(n=s.summary)||void 0===n?void 0:n.booksUpdated)?(0,r.jsxs)("li",{children:["• ",s.summary.booksUpdated," books updated"]}):null,(null===(o=s.summary)||void 0===o?void 0:o.highlightsAdded)?(0,r.jsxs)("li",{children:["• ",s.summary.highlightsAdded," highlights added"]}):null,(null===(d=s.summary)||void 0===d?void 0:d.bookmarksAdded)?(0,r.jsxs)("li",{children:["• ",s.summary.bookmarksAdded," bookmarks added"]}):null,(null===(c=s.summary)||void 0===c?void 0:c.vocabularyAdded)?(0,r.jsxs)("li",{children:["• ",s.summary.vocabularyAdded," vocabulary words added"]}):null,(null===(p=s.summary)||void 0===p?void 0:p.settingsUpdated)?(0,r.jsx)("li",{children:"• Settings restored"}):null,(null===(y=s.summary)||void 0===y?void 0:y.statsUpdated)?(0,r.jsx)("li",{children:"• Reading stats updated"}):null]})]}),(0,r.jsx)("button",{onClick:b,className:"w-full py-2 bg-blue-600 text-white rounded-lg font-medium",children:"Done"})]});case"error":return(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{className:"p-3 bg-red-50 dark:bg-red-900/30 rounded-lg text-red-800 dark:text-red-200",children:[(0,r.jsx)("h4",{className:"font-medium",children:"❌ Import Failed"}),(0,r.jsx)("p",{className:"text-sm mt-1 opacity-80",children:s.error})]}),(0,r.jsx)("button",{onClick:b,className:"w-full py-2 rounded-lg ".concat(u?"bg-gray-700":"bg-gray-200"),children:"Try Again"})]});default:return(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsxs)("button",{onClick:m,className:"flex-1 py-3 rounded-xl flex items-center justify-center gap-2 transition-all ".concat(u?"bg-gray-700 hover:bg-gray-600":g?"bg-sepia-100 hover:bg-sepia-200":"bg-gray-100 hover:bg-gray-200"),children:[(0,r.jsx)("span",{children:"\uD83D\uDCE4"}),(0,r.jsx)("span",{children:"Export"})]}),(0,r.jsxs)("label",{className:"flex-1 py-3 rounded-xl flex items-center justify-center gap-2 cursor-pointer transition-all ".concat(u?"bg-gray-700 hover:bg-gray-600":g?"bg-sepia-100 hover:bg-sepia-200":"bg-gray-100 hover:bg-gray-200"),children:[(0,r.jsx)("span",{children:"\uD83D\uDCE5"}),(0,r.jsx)("span",{children:"Import"}),(0,r.jsx)("input",{ref:i,type:"file",accept:".json",onChange:h,className:"hidden"})]})]})}})(),n&&(0,r.jsx)("div",{className:"p-2 bg-green-50 dark:bg-green-900/30 rounded-lg text-green-800 dark:text-green-200 text-sm text-center",children:"✅ Export downloaded!"}),(0,r.jsx)("p",{className:"text-xs opacity-50 text-center",children:"Export your library, settings, and progress to a JSON file. Import to restore on any device."})]})]})}function K(){let{settings:e,updateSettings:t,toggleSettings:a}=d();return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"fixed inset-0 bg-black/50 z-50",onClick:a}),(0,r.jsx)("div",{className:"fixed bottom-0 left-0 right-0 z-50 rounded-t-3xl shadow-2xl p-6 ".concat("dark"===e.theme?"bg-gray-800 text-white":"sepia"===e.theme?"bg-sepia-200 text-sepia-900":"bg-white text-gray-900"),children:(0,r.jsxs)("div",{className:"max-w-lg mx-auto",children:[(0,r.jsx)("div",{className:"w-12 h-1.5 bg-gray-300 dark:bg-gray-600 rounded-full mx-auto mb-6"}),(0,r.jsx)("h3",{className:"text-lg font-semibold mb-6",children:"Reading Settings"}),(0,r.jsxs)("div",{className:"mb-8",children:[(0,r.jsx)("label",{className:"text-sm font-medium opacity-70 mb-3 block",children:"Theme"}),(0,r.jsx)("div",{className:"flex gap-3",children:[{id:"light",label:"Light",icon:"☀️"},{id:"dark",label:"Dark",icon:"\uD83C\uDF19"},{id:"sepia",label:"Sepia",icon:"\uD83D\uDCDC"}].map(a=>(0,r.jsxs)("button",{onClick:()=>t({theme:a.id}),className:"flex-1 py-3 px-4 rounded-xl flex flex-col items-center gap-2 transition-all ".concat(e.theme===a.id?"ring-2 ring-blue-500 bg-blue-50 dark:bg-blue-900/30":"bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600"),children:[(0,r.jsx)("span",{className:"text-2xl",children:a.icon}),(0,r.jsx)("span",{className:"text-sm",children:a.label})]},a.id))})]}),(0,r.jsxs)("div",{className:"mb-8",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,r.jsx)("label",{className:"text-sm font-medium opacity-70",children:"Font Size"}),(0,r.jsxs)("span",{className:"text-sm font-mono",children:[e.fontSize,"px"]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsx)("span",{className:"text-sm",children:"A"}),(0,r.jsx)("input",{type:"range",min:"14",max:"28",value:e.fontSize,onChange:e=>t({fontSize:parseInt(e.target.value)}),className:"flex-1 h-2 bg-gray-200 dark:bg-gray-700 rounded-lg appearance-none cursor-pointer accent-blue-500"}),(0,r.jsx)("span",{className:"text-xl",children:"A"})]})]}),(0,r.jsxs)("div",{className:"mb-8",children:[(0,r.jsx)("label",{className:"text-sm font-medium opacity-70 mb-3 block",children:"Font Style"}),(0,r.jsxs)("div",{className:"flex gap-3",children:[(0,r.jsx)("button",{onClick:()=>t({fontFamily:"serif"}),className:"flex-1 py-3 px-4 rounded-xl font-serif transition-all ".concat("serif"===e.fontFamily?"ring-2 ring-blue-500 bg-blue-50 dark:bg-blue-900/30":"bg-gray-100 dark:bg-gray-700"),children:"Serif"}),(0,r.jsx)("button",{onClick:()=>t({fontFamily:"sans"}),className:"flex-1 py-3 px-4 rounded-xl font-sans transition-all ".concat("sans"===e.fontFamily?"ring-2 ring-blue-500 bg-blue-50 dark:bg-blue-900/30":"bg-gray-100 dark:bg-gray-700"),children:"Sans-Serif"})]})]}),(0,r.jsxs)("div",{className:"mb-8",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,r.jsx)("label",{className:"text-sm font-medium opacity-70",children:"Line Spacing"}),(0,r.jsx)("span",{className:"text-sm font-mono",children:e.lineHeight.toFixed(1)})]}),(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsx)("span",{className:"text-xs opacity-50",children:"Tight"}),(0,r.jsx)("input",{type:"range",min:"1.4",max:"2.2",step:"0.1",value:e.lineHeight,onChange:e=>t({lineHeight:parseFloat(e.target.value)}),className:"flex-1 h-2 bg-gray-200 dark:bg-gray-700 rounded-lg appearance-none cursor-pointer accent-blue-500"}),(0,r.jsx)("span",{className:"text-xs opacity-50",children:"Loose"})]})]}),(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)("label",{className:"text-sm font-medium opacity-70 mb-3 block",children:"Page Margins"}),(0,r.jsx)("div",{className:"flex gap-3",children:["small","medium","large"].map(a=>(0,r.jsx)("button",{onClick:()=>t({marginSize:a}),className:"flex-1 py-3 px-4 rounded-xl capitalize transition-all ".concat(e.marginSize===a?"ring-2 ring-blue-500 bg-blue-50 dark:bg-blue-900/30":"bg-gray-100 dark:bg-gray-700"),children:a},a))})]}),(0,r.jsx)(H,{className:"mb-6"}),(0,r.jsx)(X,{}),(0,r.jsx)("button",{onClick:a,className:"w-full py-3 bg-blue-600 text-white rounded-xl font-medium hover:bg-blue-700 transition-colors",children:"Done"})]})})]})}function G(e){let{items:t,currentIndex:a,onSelect:s}=e,{settings:l,toggleToc:n}=d();return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"fixed inset-0 bg-black/50 z-50",onClick:n}),(0,r.jsxs)("div",{className:"fixed left-0 top-0 bottom-0 w-80 max-w-[85vw] z-50 shadow-2xl flex flex-col ".concat("dark"===l.theme?"bg-gray-800 text-white":"sepia"===l.theme?"bg-sepia-200 text-sepia-900":"bg-white text-gray-900"),children:[(0,r.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold",children:"Table of Contents"}),(0,r.jsx)("button",{onClick:n,className:"p-2 rounded-lg hover:bg-black/10 dark:hover:bg-white/10",children:"✕"})]}),(0,r.jsx)("nav",{className:"flex-1 overflow-y-auto p-2",children:t.map((e,t)=>(0,r.jsx)($,{item:e,index:t,isActive:t===a,onSelect:s,settings:l},e.id))}),(0,r.jsx)("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700",children:(0,r.jsxs)("div",{className:"text-sm opacity-70 text-center",children:[t.length," chapters"]})})]})]})}function $(e){var t;let{item:a,index:s,isActive:l,onSelect:n,settings:o,depth:i=0}=e;return(0,r.jsxs)("div",{style:{paddingLeft:"".concat(16*i,"px")},children:[(0,r.jsx)("button",{onClick:()=>n(s),className:"w-full text-left px-4 py-3 rounded-lg transition-colors mb-1 ".concat(l?"dark"===o.theme?"bg-blue-900/50 text-blue-300":"bg-blue-100 text-blue-700":"hover:bg-black/5 dark:hover:bg-white/5"),children:(0,r.jsxs)("span",{className:"flex items-center gap-3",children:[l&&(0,r.jsx)("span",{className:"w-1.5 h-1.5 bg-blue-500 rounded-full"}),(0,r.jsx)("span",{className:l?"font-medium":"",children:a.label})]})}),null===(t=a.subitems)||void 0===t?void 0:t.map((e,t)=>(0,r.jsx)($,{item:e,index:s+t+1,isActive:!1,onSelect:n,settings:o,depth:i+1},e.id))]})}let Q=[{title:"Chapter 1: The Beginning",content:'It is a truth universally acknowledged, that a single man in possession of a good fortune, must be in want of a wife.\n\nHowever little known the feelings or views of such a man may be on his first entering a neighbourhood, this truth is so well fixed in the minds of the surrounding families, that he is considered the rightful property of some one or other of their daughters.\n\n"My dear Mr. Bennet," said his lady to him one day, "have you heard that Netherfield Park is let at last?"\n\nMr. Bennet replied that he had not.\n\n"But it is," returned she; "for Mrs. Long has just been here, and she told me all about it."\n\nMr. Bennet made no answer.\n\n"Do you not want to know who has taken it?" cried his wife impatiently.\n\n"You want to tell me, and I have no objection to hearing it."\n\nThis was invitation enough.\n\n"Why, my dear, you must know, Mrs. Long says that Netherfield is taken by a young man of large fortune from the north of England; that he came down on Monday in a chaise and four to see the place, and was so much delighted with it, that he agreed with Mr. Morris immediately; that he is to take possession before Michaelmas, and some of his servants are to be in the house by the end of next week."\n\n"What is his name?"\n\n"Bingley."\n\n"Is he married or single?"\n\n"Oh! Single, my dear, to be sure! A single man of large fortune; four or five thousand a year. What a fine thing for our girls!"'},{title:"Chapter 2: First Impressions",content:'Mr. Bennet was among the earliest of those who waited on Mr. Bingley. He had always intended to visit him, though to the last always assuring his wife that he should not go; and till the evening after the visit was paid she had no knowledge of it.\n\nIt was then disclosed in the following manner. Observing his second daughter employed in trimming a hat, he suddenly addressed her with:\n\n"I hope Mr. Bingley will like it, Lizzy."\n\n"We are not in a way to know what Mr. Bingley likes," said her mother resentfully, "since we are not to visit."\n\n"But you forget, mamma," said Elizabeth, "that we shall meet him at the assemblies, and that Mrs. Long promised to introduce him."\n\n"I do not believe Mrs. Long will do any such thing. She has two nieces of her own. She is a selfish, hypocritical woman, and I have no opinion of her."\n\n"No more have I," said Mr. Bennet; "and I am glad to find that you do not depend on her serving you."\n\nMrs. Bennet deigned not to make any reply, but, unable to contain herself, began scolding one of her daughters.\n\n"Don\'t keep coughing so, Kitty, for Heaven\'s sake! Have a little compassion on my nerves. You tear them to pieces."\n\n"Kitty has no discretion in her coughs," said her father; "she times them ill."\n\n"I do not cough for my own amusement," replied Kitty fretfully.'},{title:"Chapter 3: The Ball",content:'Not all that Mrs. Bennet, however, with the assistance of her five daughters, could ask on the subject, was sufficient to draw from her husband any satisfactory description of Mr. Bingley.\n\nThey attacked him in various ways—with barefaced questions, ingenious suppositions, and distant surmises; but he eluded the skill of them all, and they were at last obliged to accept the second-hand intelligence of their neighbour, Lady Lucas.\n\nHer report was highly favourable. Sir William had been delighted with him. He was quite young, wonderfully handsome, extremely agreeable, and, to crown the whole, he meant to be at the next assembly with a large party.\n\nNothing could be more delightful! To be fond of dancing was a certain step towards falling in love; and very lively hopes of Mr. Bingley\'s heart were entertained.\n\n"If I can but see one of my daughters happily settled at Netherfield," said Mrs. Bennet to her husband, "and all the others equally well married, I shall have nothing to wish for."\n\nIn a few days Mr. Bingley returned Mr. Bennet\'s visit, and sat about ten minutes with him in his library. He had entertained hopes of being admitted to a sight of the young ladies, of whose beauty he had heard much; but he saw only the father.\n\nThe ladies were somewhat more fortunate, for they had the advantage of ascertaining from an upper window that he wore a blue coat, and rode a black horse.'}];function ee(){let{currentBook:e,setCurrentBook:t,updateBookProgress:a,settings:s,isSettingsOpen:l,isTocOpen:n,toggleSettings:o,toggleToc:i}=d(),[u,g]=(0,c.useState)(0),[m,h]=(0,c.useState)([]),[x,b]=(0,c.useState)(!0),p=(0,c.useRef)(null),y=(0,c.useRef)(null),f=(0,c.useRef)(0),v=(0,c.useRef)(0),k=Q.length,j=(u+1)/k*100;(0,c.useEffect)(()=>{e&&a(e.id,j)},[j,e,a]),(0,c.useEffect)(()=>{h(Q.map((e,t)=>({id:"ch-".concat(t),href:"#ch-".concat(t),label:e.title})))},[]);let w=(0,c.useCallback)(()=>{u>0&&g(e=>e-1)},[u]),N=(0,c.useCallback)(()=>{u<k-1&&g(e=>e+1)},[u,k]);(0,c.useEffect)(()=>{let e=e=>{"ArrowLeft"===e.key||"ArrowUp"===e.key?w():"ArrowRight"===e.key||"ArrowDown"===e.key||" "===e.key?(e.preventDefault(),N()):"Escape"===e.key&&t(null)};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[w,N,t]);let S={light:"bg-white text-gray-900",dark:"bg-gray-900 text-gray-100",sepia:"bg-sepia-100 text-sepia-900"};return(0,r.jsxs)("div",{className:"min-h-screen ".concat(S[s.theme]," transition-colors duration-300"),onClick:()=>{b(!0),p.current&&clearTimeout(p.current),p.current=setTimeout(()=>{b(!1)},3e3)},onTouchStart:e=>{f.current=e.touches[0].clientX},onTouchEnd:e=>{v.current=e.changedTouches[0].clientX;let t=f.current-v.current;Math.abs(t)>50&&(t>0?N():w())},ref:y,children:[(0,r.jsx)("div",{className:"fixed top-0 left-0 right-0 z-50",children:(0,r.jsx)("div",{className:"progress-bar",style:{width:"".concat(j,"%")}})}),(0,r.jsx)("header",{className:"fixed top-0 left-0 right-0 z-40 transition-transform duration-300 ".concat(x?"translate-y-0":"-translate-y-full"),children:(0,r.jsx)("div",{className:"".concat(S[s.theme]," bg-opacity-95 backdrop-blur-sm shadow-md"),children:(0,r.jsxs)("div",{className:"flex items-center justify-between px-4 py-3",children:[(0,r.jsx)("button",{onClick:e=>{e.stopPropagation(),t(null)},className:"p-2 rounded-lg hover:bg-black/10 dark:hover:bg-white/10",children:"← Library"}),(0,r.jsxs)("div",{className:"flex-1 text-center px-4",children:[(0,r.jsx)("h1",{className:"font-semibold truncate",children:null==e?void 0:e.title}),(0,r.jsx)("p",{className:"text-sm opacity-70",children:Q[u].title})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("button",{onClick:e=>{e.stopPropagation(),i()},className:"p-2 rounded-lg hover:bg-black/10 dark:hover:bg-white/10",title:"Table of Contents",children:"\uD83D\uDCD6"}),(0,r.jsx)("button",{onClick:e=>{e.stopPropagation(),o()},className:"p-2 rounded-lg hover:bg-black/10 dark:hover:bg-white/10",title:"Settings",children:"⚙️"})]})]})})}),(0,r.jsx)("main",{className:"min-h-screen pt-20 pb-24 ".concat({small:"px-4 md:px-8",medium:"px-8 md:px-16 lg:px-24",large:"px-12 md:px-24 lg:px-32"}[s.marginSize]," reader-scroll"),children:(0,r.jsxs)("article",{className:"max-w-3xl mx-auto reader-content",style:{fontSize:"".concat(s.fontSize,"px"),lineHeight:s.lineHeight,fontFamily:"serif"===s.fontFamily?'Georgia, Cambria, "Times New Roman", serif':"system-ui, -apple-system, sans-serif"},children:[(0,r.jsx)("h2",{className:"text-2xl font-bold mb-8 text-center",children:Q[u].title}),Q[u].content.split("\n\n").map((e,t)=>(0,r.jsx)("p",{className:"mb-4",children:e},t))]})}),(0,r.jsx)("footer",{className:"fixed bottom-0 left-0 right-0 z-40 transition-transform duration-300 ".concat(x?"translate-y-0":"translate-y-full"),children:(0,r.jsx)("div",{className:"".concat(S[s.theme]," bg-opacity-95 backdrop-blur-sm shadow-[0_-2px_10px_rgba(0,0,0,0.1)]"),children:(0,r.jsxs)("div",{className:"flex items-center justify-between px-4 py-3",children:[(0,r.jsx)("button",{onClick:e=>{e.stopPropagation(),w()},disabled:0===u,className:"px-4 py-2 rounded-lg hover:bg-black/10 dark:hover:bg-white/10 disabled:opacity-30",children:"← Prev"}),(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsxs)("p",{className:"text-sm opacity-70",children:["Chapter ",u+1," of ",k]}),(0,r.jsxs)("p",{className:"text-xs opacity-50",children:[Math.round(j),"% complete"]})]}),(0,r.jsx)("button",{onClick:e=>{e.stopPropagation(),N()},disabled:u===k-1,className:"px-4 py-2 rounded-lg hover:bg-black/10 dark:hover:bg-white/10 disabled:opacity-30",children:"Next →"})]})})}),l&&(0,r.jsx)(K,{}),n&&(0,r.jsx)(G,{items:m,currentIndex:u,onSelect:e=>{g(e),i()}})]})}function et(e){var t,a,s;let{word:l,position:n,cfi:o,bookId:i,onClose:u,onHighlightWithNote:g}=e,{addHighlight:m,addVocabularyWord:h}=d(),[x,b]=(0,c.useState)(!0),[p,y]=(0,c.useState)(null),[f,v]=(0,c.useState)(null),[k,j]=(0,c.useState)(!1),[w,N]=(0,c.useState)(!1),S=l.trim().toLowerCase().replace(/[^a-zA-Z'-]/g,"");(0,c.useEffect)(()=>{!async function(){if(!S){y("Invalid word"),b(!1);return}try{b(!0),y(null);let e=await fetch("https://api.dictionaryapi.dev/api/v2/entries/en/".concat(encodeURIComponent(S)));if(!e.ok){404===e.status?y("Word not found"):y("Failed to fetch definition"),b(!1);return}let t=await e.json();t&&t.length>0&&v(t[0])}catch(e){console.error("Dictionary lookup error:",e),y("Network error")}finally{b(!1)}}()},[S]);let C={left:Math.min(Math.max(n.x-150,10),window.innerWidth-320),top:Math.max(n.y+10,10),maxHeight:window.innerHeight-n.y-40},D=(null==f?void 0:f.phonetic)||(null==f?void 0:null===(a=f.phonetics)||void 0===a?void 0:null===(t=a.find(e=>e.text))||void 0===t?void 0:t.text),R=null==f?void 0:null===(s=f.phonetics)||void 0===s?void 0:s.some(e=>e.audio);return(0,r.jsx)("div",{className:"fixed z-[100] animate-in fade-in slide-in-from-top-2 duration-200",style:C,onClick:e=>e.stopPropagation(),children:(0,r.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-xl border border-gray-200 dark:border-gray-700  w-[300px] max-w-[calc(100vw-20px)] overflow-hidden",children:[(0,r.jsx)("div",{className:"px-4 py-3 border-b border-gray-100 dark:border-gray-700 bg-gradient-to-r from-blue-50 to-purple-50 dark:from-blue-900/20 dark:to-purple-900/20",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"text-lg font-semibold text-gray-900 dark:text-white capitalize",children:S}),D&&(0,r.jsx)("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:D})]}),(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[R&&(0,r.jsx)("button",{onClick:()=>{var e,t;let a=null==f?void 0:null===(t=f.phonetics)||void 0===t?void 0:null===(e=t.find(e=>e.audio))||void 0===e?void 0:e.audio;if(a){j(!0);let e=new Audio(a);e.onended=()=>j(!1),e.onerror=()=>j(!1),e.play().catch(()=>j(!1))}},disabled:k,className:"p-1.5 hover:bg-white/50 dark:hover:bg-gray-700/50 rounded-full transition-colors",title:"Play pronunciation",children:k?"\uD83D\uDD0A":"\uD83D\uDD08"}),(0,r.jsx)("button",{onClick:u,className:"p-1.5 hover:bg-white/50 dark:hover:bg-gray-700/50 rounded-full transition-colors text-gray-500",children:"✕"})]})]})}),(0,r.jsx)("div",{className:"p-4 max-h-[300px] overflow-y-auto",children:x?(0,r.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,r.jsx)("div",{className:"w-6 h-6 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"})}):p?(0,r.jsxs)("div",{className:"text-center py-6",children:[(0,r.jsx)("span",{className:"text-4xl mb-2 block",children:"\uD83D\uDCDA"}),(0,r.jsx)("p",{className:"text-gray-500 dark:text-gray-400",children:p}),(0,r.jsx)("p",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1",children:"Try selecting a different word"})]}):f?(0,r.jsx)("div",{className:"space-y-3",children:f.meanings.slice(0,3).map((e,t)=>(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"inline-block px-2 py-0.5 text-xs font-medium bg-gray-100 dark:bg-gray-700  text-gray-600 dark:text-gray-300 rounded-full mb-1",children:e.partOfSpeech}),(0,r.jsx)("ol",{className:"list-decimal list-inside space-y-1",children:e.definitions.slice(0,2).map((e,t)=>(0,r.jsxs)("li",{className:"text-sm text-gray-700 dark:text-gray-300",children:[e.definition,e.example&&(0,r.jsxs)("p",{className:"text-xs text-gray-500 dark:text-gray-400 ml-4 mt-0.5 italic",children:['"',e.example,'"']})]},t))})]},t))}):null}),f&&(0,r.jsxs)("div",{className:"px-3 py-2 border-t border-gray-100 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50 flex gap-2",children:[(0,r.jsx)("button",{onClick:()=>{if(f){var e,t,a,r;h({word:S,definition:(null===(t=f.meanings[0])||void 0===t?void 0:null===(e=t.definitions[0])||void 0===e?void 0:e.definition)||"",phonetic:f.phonetic||(null===(r=f.phonetics)||void 0===r?void 0:null===(a=r.find(e=>e.text))||void 0===a?void 0:a.text),bookId:i}),N(!0),setTimeout(()=>N(!1),2e3)}},disabled:w,className:"flex-1 px-3 py-1.5 text-sm bg-gradient-to-r from-amber-400 to-orange-400  text-white rounded-lg hover:from-amber-500 hover:to-orange-500  transition-all flex items-center justify-center gap-1.5 disabled:opacity-50 disabled:cursor-default",children:w?(0,r.jsx)(r.Fragment,{children:"✓ Saved"}):(0,r.jsx)(r.Fragment,{children:"\uD83D\uDCDA Add to Vocabulary"})}),o&&i&&(0,r.jsx)("button",{onClick:()=>{if(f&&o&&i){var e,t;let a=(null===(t=f.meanings[0])||void 0===t?void 0:null===(e=t.definitions[0])||void 0===e?void 0:e.definition)||"",r="\uD83D\uDCD6 ".concat(f.phonetic||"","\n").concat(a);g?g(r):(m({bookId:i,cfi:o,text:S,color:"blue",note:r}),u())}},className:"px-3 py-1.5 text-sm bg-blue-500 text-white rounded-lg  hover:bg-blue-600 transition-colors flex items-center gap-1.5",title:"Save as highlight with definition",children:"\uD83D\uDCA1"})]})]})})}let ea=[{color:"yellow",label:"Yellow",bg:"bg-yellow-300"},{color:"green",label:"Green",bg:"bg-green-300"},{color:"blue",label:"Blue",bg:"bg-blue-300"},{color:"pink",label:"Pink",bg:"bg-pink-300"}];function er(e){let{position:t,selectedText:a,cfi:s,bookId:l,onClose:n}=e,{addHighlight:o}=d(),[i,u]=(0,c.useState)(!1),[g,m]=(0,c.useState)(!1),[h,x]=(0,c.useState)(""),[b,p]=(0,c.useState)("yellow"),y=function(e){let t=e.trim();return/^[a-zA-Z]+(['-][a-zA-Z]+)*$/.test(t)&&t.length>=2}(a),f=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t?(p(e),u(!0)):(o({bookId:l,cfi:s,text:a,color:e}),n())},v={left:Math.min(t.x,window.innerWidth-200),top:Math.max(t.y-60,10)};return(0,r.jsxs)("div",{className:"fixed z-[100] animate-in fade-in zoom-in-95 duration-150",style:v,onClick:e=>e.stopPropagation(),children:[(0,r.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 overflow-hidden",children:i?(0,r.jsxs)("div",{className:"p-3 min-w-[280px]",children:[(0,r.jsx)("div",{className:"flex items-center gap-1 mb-3",children:ea.map(e=>{let{color:t,bg:a}=e;return(0,r.jsx)("button",{onClick:()=>p(t),className:"w-7 h-7 rounded-full ".concat(a," transition-all ").concat(b===t?"ring-2 ring-offset-2 ring-gray-400 scale-110":"hover:scale-105")},t)})}),(0,r.jsxs)("div",{className:"text-xs text-gray-500 dark:text-gray-400 mb-2 line-clamp-2 italic",children:['"',a.slice(0,100),a.length>100?"...":"",'"']}),(0,r.jsx)("textarea",{value:h,onChange:e=>x(e.target.value),placeholder:"Add a note...",className:"w-full p-2 text-sm border border-gray-200 dark:border-gray-600 rounded-lg  bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none",rows:3,autoFocus:!0}),(0,r.jsxs)("div",{className:"flex justify-end gap-2 mt-2",children:[(0,r.jsx)("button",{onClick:n,className:"px-3 py-1.5 text-sm text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:"Cancel"}),(0,r.jsx)("button",{onClick:()=>{o({bookId:l,cfi:s,text:a,color:b,note:h.trim()||void 0}),n()},className:"px-3 py-1.5 text-sm bg-blue-500 text-white rounded-lg hover:bg-blue-600",children:"Save"})]})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"flex items-center gap-1 p-2 border-b border-gray-100 dark:border-gray-700",children:ea.map(e=>{let{color:t,label:a,bg:s}=e;return(0,r.jsx)("button",{onClick:()=>f(t),className:"w-8 h-8 rounded-full ".concat(s," hover:scale-110 transition-transform"),title:a},t)})}),(0,r.jsxs)("div",{className:"p-1",children:[y&&(0,r.jsxs)("button",{onClick:()=>m(!0),className:"w-full px-3 py-2 text-left text-sm hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg flex items-center gap-2 text-blue-600 dark:text-blue-400 font-medium",children:[(0,r.jsx)("span",{children:"\uD83D\uDCD6"}),(0,r.jsxs)("span",{children:['Look up "',a.trim(),'"']})]}),(0,r.jsxs)("button",{onClick:()=>{u(!0)},className:"w-full px-3 py-2 text-left text-sm hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg flex items-center gap-2",children:[(0,r.jsx)("span",{children:"\uD83D\uDCDD"}),(0,r.jsx)("span",{children:"Add note..."})]}),(0,r.jsxs)("button",{onClick:()=>{navigator.clipboard.writeText(a),n()},className:"w-full px-3 py-2 text-left text-sm hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg flex items-center gap-2",children:[(0,r.jsx)("span",{children:"\uD83D\uDCCB"}),(0,r.jsx)("span",{children:"Copy text"})]})]})]})}),g&&(0,r.jsx)(et,{word:a.trim(),position:{x:t.x+20,y:t.y+60},cfi:s,bookId:l,onClose:()=>m(!1),onHighlightWithNote:e=>{o({bookId:l,cfi:s,text:a.trim(),color:"blue",note:e}),n()}})]})}let es=[{color:"yellow",label:"Yellow",bg:"bg-yellow-100",text:"text-yellow-800"},{color:"green",label:"Green",bg:"bg-green-100",text:"text-green-800"},{color:"blue",label:"Blue",bg:"bg-blue-100",text:"text-blue-800"},{color:"pink",label:"Pink",bg:"bg-pink-100",text:"text-pink-800"}];function el(e){let{bookId:t,onNavigate:a,onClose:s}=e,{highlights:l,bookmarks:n,removeHighlight:o,removeBookmark:i,settings:u}=d(),[g,m]=(0,c.useState)("highlights"),[h,x]=(0,c.useState)(""),[b,p]=(0,c.useState)("all"),[y,f]=(0,c.useState)(null),v=(0,c.useMemo)(()=>l.filter(e=>e.bookId===t).filter(e=>"all"===b||e.color===b).filter(e=>{var t;if(!h)return!0;let a=h.toLowerCase();return e.text.toLowerCase().includes(a)||(null===(t=e.note)||void 0===t?void 0:t.toLowerCase().includes(a))}).sort((e,t)=>t.createdAt-e.createdAt),[l,t,b,h]),k=(0,c.useMemo)(()=>n.filter(e=>e.bookId===t).filter(e=>{var t;return!h||(null===(t=e.title)||void 0===t?void 0:t.toLowerCase().includes(h.toLowerCase()))}).sort((e,t)=>t.createdAt-e.createdAt),[n,t,h]),j=e=>new Date(e).toLocaleDateString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),w=e=>es.find(t=>t.color===e)||es[0];return(0,r.jsxs)("div",{className:"fixed inset-0 z-50 flex",onClick:s,children:[(0,r.jsx)("div",{className:"absolute inset-0 bg-black/40"}),(0,r.jsxs)("div",{className:"relative ml-auto w-full max-w-md h-full ".concat({light:"bg-white text-gray-900",dark:"bg-gray-900 text-gray-100",sepia:"bg-sepia-100 text-sepia-900"}[u.theme]," shadow-2xl animate-in slide-in-from-right duration-300 flex flex-col"),onClick:e=>e.stopPropagation(),children:[(0,r.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold",children:"Annotations"}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("button",{onClick:()=>{let e=new Blob([["# Annotations Export","","## Highlights (".concat(v.length,")"),"",...v.map((e,t)=>["### ".concat(t+1,". [").concat(e.color.toUpperCase(),"]"),"> ".concat(e.text),e.note?"\n**Note:** ".concat(e.note):"","*".concat(j(e.createdAt),"*"),""].filter(Boolean).join("\n")),"","## Bookmarks (".concat(k.length,")"),"",...k.map((e,t)=>["".concat(t+1,". ").concat(e.title||"Untitled bookmark"),"   *".concat(j(e.createdAt),"*"),""].join("\n"))].join("\n")],{type:"text/markdown"}),t=URL.createObjectURL(e),a=document.createElement("a");a.href=t,a.download="annotations.md",a.click(),URL.revokeObjectURL(t)},className:"p-2 rounded-lg hover:bg-black/10 dark:hover:bg-white/10",title:"Export to Markdown",children:"\uD83D\uDCE4"}),(0,r.jsx)("button",{onClick:s,className:"p-2 rounded-lg hover:bg-black/10 dark:hover:bg-white/10",children:"✕"})]})]}),(0,r.jsxs)("div",{className:"flex border-b border-gray-200 dark:border-gray-700",children:[(0,r.jsxs)("button",{onClick:()=>m("highlights"),className:"flex-1 py-3 text-sm font-medium transition-colors ".concat("highlights"===g?"border-b-2 border-blue-500 text-blue-500":"text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"),children:["Highlights (",v.length,")"]}),(0,r.jsxs)("button",{onClick:()=>m("bookmarks"),className:"flex-1 py-3 text-sm font-medium transition-colors ".concat("bookmarks"===g?"border-b-2 border-blue-500 text-blue-500":"text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"),children:["Bookmarks (",k.length,")"]})]}),(0,r.jsxs)("div",{className:"p-3 space-y-2 border-b border-gray-200 dark:border-gray-700",children:[(0,r.jsx)("input",{type:"text",value:h,onChange:e=>x(e.target.value),placeholder:"Search annotations...",className:"w-full px-3 py-2 rounded-lg text-sm ".concat({light:"bg-gray-100 text-gray-900 placeholder-gray-500",dark:"bg-gray-800 text-gray-100 placeholder-gray-500",sepia:"bg-sepia-200 text-sepia-900 placeholder-sepia-700"}[u.theme]," focus:outline-none focus:ring-2 focus:ring-blue-500")}),"highlights"===g&&(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)("button",{onClick:()=>p("all"),className:"px-3 py-1 text-xs rounded-full transition-colors ".concat("all"===b?"bg-gray-700 text-white":"bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600"),children:"All"}),es.map(e=>{let{color:t,bg:a}=e;return(0,r.jsx)("button",{onClick:()=>p(t),className:"w-6 h-6 rounded-full ".concat(a," transition-transform ").concat(b===t?"ring-2 ring-offset-1 ring-gray-400 scale-110":"")},t)})]})]}),(0,r.jsx)("div",{className:"flex-1 overflow-y-auto p-3 space-y-2",children:"highlights"===g?0===v.length?(0,r.jsxs)("div",{className:"text-center py-12 text-gray-500",children:[(0,r.jsx)("p",{className:"text-4xl mb-2",children:"\uD83D\uDD8D️"}),(0,r.jsx)("p",{children:"No highlights yet"}),(0,r.jsx)("p",{className:"text-sm mt-1",children:"Select text while reading to add highlights"})]}):v.map(e=>{let t=w(e.color);return(0,r.jsxs)("div",{className:"p-3 rounded-lg ".concat(t.bg," ").concat(t.text," cursor-pointer hover:shadow-md transition-shadow"),onClick:()=>a(e.cfi),children:[(0,r.jsxs)("p",{className:"text-sm line-clamp-3",children:['"',e.text,'"']}),e.note&&(0,r.jsxs)("div",{className:"mt-2 pt-2 border-t border-black/10 text-sm cursor-pointer ".concat(y===e.id?"":"line-clamp-2"),onClick:t=>{t.stopPropagation(),f(y===e.id?null:e.id)},children:["\uD83D\uDCDD ",e.note]}),(0,r.jsxs)("div",{className:"flex items-center justify-between mt-2 text-xs opacity-70",children:[(0,r.jsx)("span",{children:j(e.createdAt)}),(0,r.jsx)("button",{onClick:t=>{t.stopPropagation(),confirm("Delete this highlight?")&&o(e.id)},className:"p-1 hover:bg-black/10 rounded",children:"\uD83D\uDDD1️"})]})]},e.id)}):0===k.length?(0,r.jsxs)("div",{className:"text-center py-12 text-gray-500",children:[(0,r.jsx)("p",{className:"text-4xl mb-2",children:"\uD83D\uDD16"}),(0,r.jsx)("p",{children:"No bookmarks yet"}),(0,r.jsx)("p",{className:"text-sm mt-1",children:"Tap the bookmark icon while reading"})]}):k.map(e=>(0,r.jsx)("div",{className:"p-3 rounded-lg bg-amber-50 dark:bg-amber-900/20 cursor-pointer hover:shadow-md transition-shadow",onClick:()=>a(e.cfi),children:(0,r.jsxs)("div",{className:"flex items-start gap-2",children:[(0,r.jsx)("span",{className:"text-lg",children:"\uD83D\uDD16"}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsx)("p",{className:"font-medium truncate",children:e.title||"Untitled bookmark"}),(0,r.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:j(e.createdAt)})]}),(0,r.jsx)("button",{onClick:t=>{t.stopPropagation(),confirm("Delete this bookmark?")&&i(e.id)},className:"p-1 hover:bg-black/10 rounded text-gray-500",children:"\uD83D\uDDD1️"})]})},e.id))})]})]})}function en(e){let{isOpen:t,onClose:a,bookId:s}=e,{vocabulary:l,removeVocabularyWord:n,books:o}=d(),[i,u]=(0,c.useState)("all"),[g,m]=(0,c.useState)("");if(!t)return null;let h=l;if("current"===i&&s&&(h=l.filter(e=>e.bookId===s)),g){let e=g.toLowerCase();h=h.filter(t=>t.word.toLowerCase().includes(e)||t.definition.toLowerCase().includes(e))}h=[...h].sort((e,t)=>t.createdAt-e.createdAt);let x=e=>{if(!e)return"Unknown";let t=o.find(t=>t.id===e);return(null==t?void 0:t.title)||"Unknown"};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"fixed inset-0 bg-black/30 z-[90] transition-opacity",onClick:a}),(0,r.jsxs)("div",{className:"fixed right-0 top-0 bottom-0 w-full max-w-md bg-white dark:bg-gray-900  shadow-2xl z-[95] animate-in slide-in-from-right duration-300 flex flex-col",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between px-4 py-3 border-b border-gray-200 dark:border-gray-700",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"text-xl",children:"\uD83D\uDCDA"}),(0,r.jsx)("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Vocabulary"}),(0,r.jsx)("span",{className:"px-2 py-0.5 text-xs bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-300 rounded-full",children:h.length})]}),(0,r.jsx)("button",{onClick:a,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-full",children:"✕"})]}),(0,r.jsxs)("div",{className:"px-4 py-3 border-b border-gray-100 dark:border-gray-800 space-y-3",children:[(0,r.jsx)("input",{type:"text",value:g,onChange:e=>m(e.target.value),placeholder:"Search words...",className:"w-full px-3 py-2 text-sm border border-gray-200 dark:border-gray-700 rounded-lg  bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-amber-500"}),s&&(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{onClick:()=>u("all"),className:"px-3 py-1 text-sm rounded-full transition-colors ".concat("all"===i?"bg-amber-500 text-white":"bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400"),children:"All Books"}),(0,r.jsx)("button",{onClick:()=>u("current"),className:"px-3 py-1 text-sm rounded-full transition-colors ".concat("current"===i?"bg-amber-500 text-white":"bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400"),children:"Current Book"})]})]}),(0,r.jsx)("div",{className:"flex-1 overflow-y-auto px-4 py-3",children:0===h.length?(0,r.jsxs)("div",{className:"text-center py-12",children:[(0,r.jsx)("span",{className:"text-4xl mb-3 block",children:"\uD83D\uDCD6"}),(0,r.jsx)("p",{className:"text-gray-500 dark:text-gray-400",children:g?"No words match your search":"No words saved yet"}),(0,r.jsx)("p",{className:"text-sm text-gray-400 dark:text-gray-500 mt-1",children:'Select a word while reading and tap "Look up" to add it'})]}):(0,r.jsx)("div",{className:"space-y-3",children:h.map(e=>(0,r.jsxs)("div",{className:"p-3 bg-gradient-to-br from-amber-50 to-orange-50 dark:from-amber-900/20 dark:to-orange-900/20  rounded-xl border border-amber-200/50 dark:border-amber-800/30",children:[(0,r.jsxs)("div",{className:"flex items-start justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"font-semibold text-gray-900 dark:text-white capitalize",children:e.word}),e.phonetic&&(0,r.jsx)("span",{className:"ml-2 text-sm text-gray-500 dark:text-gray-400",children:e.phonetic})]}),(0,r.jsx)("button",{onClick:()=>n(e.id),className:"text-gray-400 hover:text-red-500 transition-colors p-1",title:"Remove word",children:"\uD83D\uDDD1️"})]}),(0,r.jsx)("p",{className:"text-sm text-gray-700 dark:text-gray-300 mt-1",children:e.definition}),e.bookId&&(0,r.jsxs)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2",children:["\uD83D\uDCD6 ",x(e.bookId)]})]},e.id))})}),h.length>0&&(0,r.jsx)("div",{className:"px-4 py-3 border-t border-gray-200 dark:border-gray-700",children:(0,r.jsxs)("button",{onClick:()=>{let e=new Blob([["# My Vocabulary List","","*Exported on ".concat(new Date().toLocaleDateString(),"*"),"",...h.map(e=>["## ".concat(e.word),e.phonetic?"*".concat(e.phonetic,"*"):"","",e.definition,"",e.bookId?"\uD83D\uDCD6 From: ".concat(x(e.bookId)):"","","---",""].filter(Boolean).join("\n"))].join("\n")],{type:"text/markdown"}),t=URL.createObjectURL(e),a=document.createElement("a");a.href=t,a.download="vocabulary.md",a.click(),URL.revokeObjectURL(t)},className:"w-full px-4 py-2 bg-gradient-to-r from-amber-400 to-orange-400 text-white  rounded-lg hover:from-amber-500 hover:to-orange-500 transition-all flex items-center justify-center gap-2",children:[(0,r.jsx)("span",{children:"\uD83D\uDCE4"}),(0,r.jsx)("span",{children:"Export to Markdown"})]})})]})]})}function eo(e){let{text:t,isOpen:a,onClose:s,onSentenceChange:l,onPageComplete:n}=e,[o,i]=(0,c.useState)([]),[u,g]=(0,c.useState)(null),[m,h]=(0,c.useState)(!1),[x,b]=(0,c.useState)(!1),[p,y]=(0,c.useState)(0),[f,v]=(0,c.useState)([]),[k,j]=(0,c.useState)(!1),{ttsSettings:w,updateTtsSettings:N}=d(),S=w.autoPageTurn,C=(0,c.useRef)(null),D=(0,c.useRef)(null),R=(0,c.useRef)(!1),A=(0,c.useRef)(!1);(0,c.useEffect)(()=>{A.current=m},[m]),(0,c.useEffect)(()=>{var e;D.current=window.speechSynthesis;let t=()=>{var e;let t=(null===(e=D.current)||void 0===e?void 0:e.getVoices())||[];if(i(t),t.length>0){let e=w.voiceName?t.find(e=>e.name===w.voiceName):null;if(e)g(e);else if(!u){let e=t.find(e=>e.lang.startsWith("en")&&e.localService)||t[0];g(e),N({voiceName:e.name})}}};return t(),null===(e=D.current)||void 0===e||e.addEventListener("voiceschanged",t),()=>{var e;null===(e=D.current)||void 0===e||e.removeEventListener("voiceschanged",t)}},[w.voiceName,N]);let M=(0,c.useCallback)(e=>{if(!D.current||e>=f.length){S&&n&&A.current?(j(!0),n()):(h(!1),b(!1));return}let t=f[e],a=new SpeechSynthesisUtterance(t);u&&(a.voice=u),a.rate=w.rate,a.pitch=w.pitch,a.volume=w.volume,a.onstart=()=>{y(e),null==l||l(e,t)},a.onend=()=>{A.current&&!x&&M(e+1)},a.onerror=e=>{console.error("TTS Error:",e),h(!1)},C.current=a,D.current.speak(a)},[f,u,w.rate,w.pitch,w.volume,x,l,S,n]);(0,c.useEffect)(()=>{if(t){let e=t.split(RegExp("(?<=[.!?])\\s+")).filter(e=>e.trim().length>0);v(e),k&&e.length>0&&(j(!1),y(0),R.current=!0)}},[t,k]),(0,c.useEffect)(()=>{if(R.current&&f.length>0&&m&&D.current){R.current=!1;let e=setTimeout(()=>{M(0)},100);return()=>clearTimeout(e)}},[f,m,M]);let T=(0,c.useCallback)(()=>{D.current&&(x?(D.current.resume(),b(!1)):(h(!0),M(p)))},[x,p,M]),L=(0,c.useCallback)(()=>{D.current&&(D.current.pause(),b(!0))},[]),E=(0,c.useCallback)(()=>{D.current&&(D.current.cancel(),h(!1),b(!1),y(0))},[]),B=(0,c.useCallback)(()=>{if(D.current){D.current.cancel();let e=Math.min(p+1,f.length-1);y(e),m&&M(e)}},[p,f.length,m,M]),P=(0,c.useCallback)(()=>{if(D.current){D.current.cancel();let e=Math.max(p-1,0);y(e),m&&M(e)}},[p,m,M]);(0,c.useEffect)(()=>(a||E(),()=>{var e;null===(e=D.current)||void 0===e||e.cancel()}),[a,E]),(0,c.useEffect)(()=>{if(!a)return;let e=e=>{if(!(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement||e.target instanceof HTMLSelectElement))switch(e.key){case" ":e.preventDefault(),m&&!x?L():T();break;case"Escape":e.preventDefault(),s();break;case"ArrowLeft":e.preventDefault(),P();break;case"ArrowRight":e.preventDefault(),B();break;case"ArrowUp":e.preventDefault(),N({rate:Math.min(w.rate+.1,2)});break;case"ArrowDown":e.preventDefault(),N({rate:Math.max(w.rate-.1,.5)});break;case"m":case"M":e.preventDefault(),N({volume:w.volume>0?0:1});break;case"1":e.preventDefault(),N({rate:.75});break;case"2":e.preventDefault(),N({rate:1});break;case"3":e.preventDefault(),N({rate:1.5});break;case"4":e.preventDefault(),N({rate:2})}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[a,m,x,T,L,s,P,B,w.rate,w.volume,N]);let I=o.reduce((e,t)=>{let a=t.lang.split("-")[0];return e[a]||(e[a]=[]),e[a].push(t),e},{});if(!a)return null;let U=f.length>0?(p+1)/f.length*100:0;return(0,r.jsx)("div",{className:"fixed inset-0 z-50 flex items-end justify-center bg-black/50 backdrop-blur-sm",children:(0,r.jsxs)("div",{className:"w-full max-w-2xl mx-4 mb-4 bg-white dark:bg-gray-800 rounded-2xl shadow-2xl overflow-hidden",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between px-4 py-3 border-b border-gray-200 dark:border-gray-700",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"text-xl",children:"\uD83C\uDFA7"}),(0,r.jsx)("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"Audiobook Mode"})]}),(0,r.jsx)("button",{onClick:s,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition-colors",children:(0,r.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,r.jsx)("div",{className:"h-1 bg-gray-200 dark:bg-gray-700",children:(0,r.jsx)("div",{className:"h-full bg-blue-500 transition-all duration-300",style:{width:"".concat(U,"%")}})}),(0,r.jsxs)("div",{className:"px-4 py-4 min-h-[100px] max-h-[200px] overflow-y-auto",children:[(0,r.jsx)("p",{className:"text-lg text-gray-800 dark:text-gray-200 leading-relaxed",children:f[p]||"No text to read"}),(0,r.jsxs)("p",{className:"mt-2 text-sm text-gray-500",children:["Sentence ",p+1," of ",f.length]})]}),(0,r.jsxs)("div",{className:"flex items-center justify-center gap-4 px-4 py-4 border-t border-gray-200 dark:border-gray-700",children:[(0,r.jsx)("button",{onClick:P,disabled:0===p,className:"p-3 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition-colors disabled:opacity-40",title:"Previous sentence",children:(0,r.jsx)("svg",{className:"w-6 h-6",fill:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{d:"M6 6h2v12H6zm3.5 6l8.5 6V6z"})})}),(0,r.jsx)("button",{onClick:m&&!x?L:T,className:"p-4 bg-blue-500 hover:bg-blue-600 text-white rounded-full transition-colors shadow-lg",title:m&&!x?"Pause":"Play",children:m&&!x?(0,r.jsx)("svg",{className:"w-8 h-8",fill:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{d:"M6 4h4v16H6zm8 0h4v16h-4z"})}):(0,r.jsx)("svg",{className:"w-8 h-8",fill:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{d:"M8 5v14l11-7z"})})}),(0,r.jsx)("button",{onClick:E,disabled:!m&&!x,className:"p-3 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition-colors disabled:opacity-40",title:"Stop",children:(0,r.jsx)("svg",{className:"w-6 h-6",fill:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{d:"M6 6h12v12H6z"})})}),(0,r.jsx)("button",{onClick:B,disabled:p>=f.length-1&&!S,className:"p-3 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition-colors disabled:opacity-40",title:"Next sentence",children:(0,r.jsx)("svg",{className:"w-6 h-6",fill:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{d:"M6 18l8.5-6L6 6v12zm8.5-6v6h2V6h-2v6z"})})})]}),(0,r.jsxs)("div",{className:"px-4 py-4 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900",children:[(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Voice"}),(0,r.jsx)("select",{value:(null==u?void 0:u.name)||"",onChange:e=>{let t=o.find(t=>t.name===e.target.value);t&&(g(t),N({voiceName:t.name}))},className:"w-full px-3 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg text-sm",children:Object.entries(I).map(e=>{let[t,a]=e;return(0,r.jsx)("optgroup",{label:t.toUpperCase(),children:a.map(e=>(0,r.jsxs)("option",{value:e.name,children:[e.name," ",e.localService?"(Local)":"(Network)"]},e.name))},t)})})]}),(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:["Speed: ",w.rate.toFixed(1),"x"]}),(0,r.jsx)("div",{className:"flex gap-2 mb-2",children:[{rate:.75,emoji:"\uD83D\uDC22",label:"Slow",key:"1"},{rate:1,emoji:"▶️",label:"Normal",key:"2"},{rate:1.5,emoji:"\uD83D\uDC07",label:"Fast",key:"3"},{rate:2,emoji:"⚡",label:"2x",key:"4"}].map(e=>(0,r.jsxs)("button",{onClick:()=>N({rate:e.rate}),className:"flex-1 py-1.5 px-2 rounded-lg text-xs font-medium transition-colors ".concat(.05>Math.abs(w.rate-e.rate)?"bg-blue-500 text-white":"bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300"),title:"".concat(e.label," (").concat(e.rate,"x) - Press ").concat(e.key),children:[(0,r.jsx)("span",{className:"block",children:e.emoji}),(0,r.jsxs)("span",{className:"block opacity-70",children:[e.rate,"x"]})]},e.rate))}),(0,r.jsx)("input",{type:"range",min:"0.5",max:"2",step:"0.1",value:w.rate,onChange:e=>N({rate:parseFloat(e.target.value)}),className:"w-full accent-blue-500"})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:["Pitch: ",w.pitch.toFixed(1)]}),(0,r.jsx)("input",{type:"range",min:"0.5",max:"2",step:"0.1",value:w.pitch,onChange:e=>N({pitch:parseFloat(e.target.value)}),className:"w-full accent-blue-500"})]}),(0,r.jsxs)("div",{className:"mt-4",children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:["Volume: ",Math.round(100*w.volume),"%"]}),(0,r.jsx)("input",{type:"range",min:"0",max:"1",step:"0.1",value:w.volume,onChange:e=>N({volume:parseFloat(e.target.value)}),className:"w-full accent-blue-500"})]}),n&&(0,r.jsxs)("div",{className:"mt-4 flex items-center justify-between",children:[(0,r.jsx)("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Auto page turn"}),(0,r.jsx)("button",{onClick:()=>N({autoPageTurn:!S}),className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors ".concat(S?"bg-blue-500":"bg-gray-300 dark:bg-gray-600"),children:(0,r.jsx)("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform ".concat(S?"translate-x-6":"translate-x-1")})})]})]}),k&&(0,r.jsx)("div",{className:"px-4 py-2 bg-blue-50 dark:bg-blue-900/30 text-center text-sm text-blue-600 dark:text-blue-400 border-t border-blue-200 dark:border-blue-800",children:(0,r.jsx)("span",{className:"animate-pulse",children:"\uD83D\uDCD6 Loading next page..."})}),(0,r.jsx)("div",{className:"px-4 py-2 text-center text-xs text-gray-500 border-t border-gray-200 dark:border-gray-700",children:(0,r.jsxs)("div",{className:"flex flex-wrap justify-center gap-x-3 gap-y-1",children:[(0,r.jsxs)("span",{children:[(0,r.jsx)("kbd",{className:"px-1 py-0.5 bg-gray-200 dark:bg-gray-700 rounded",children:"Space"})," Play/Pause"]}),(0,r.jsxs)("span",{children:[(0,r.jsx)("kbd",{className:"px-1 py-0.5 bg-gray-200 dark:bg-gray-700 rounded",children:"←"}),(0,r.jsx)("kbd",{className:"px-1 py-0.5 bg-gray-200 dark:bg-gray-700 rounded",children:"→"})," Prev/Next"]}),(0,r.jsxs)("span",{children:[(0,r.jsx)("kbd",{className:"px-1 py-0.5 bg-gray-200 dark:bg-gray-700 rounded",children:"1"}),"-",(0,r.jsx)("kbd",{className:"px-1 py-0.5 bg-gray-200 dark:bg-gray-700 rounded",children:"4"})," Speed"]}),(0,r.jsxs)("span",{children:[(0,r.jsx)("kbd",{className:"px-1 py-0.5 bg-gray-200 dark:bg-gray-700 rounded",children:"M"})," Mute"]}),(0,r.jsxs)("span",{children:[(0,r.jsx)("kbd",{className:"px-1 py-0.5 bg-gray-200 dark:bg-gray-700 rounded",children:"Esc"})," Close"]})]})})]})})}function ei(e){let{isOpen:t,onClose:a}=e,{totalReadingTimeMs:s,totalPagesRead:l,totalSessions:n,booksCompleted:o,currentStreak:i,longestStreak:d,dailyStats:c,getTodayStats:u,getWeekStats:g,getAverageReadingTime:m}=Z(),h=u(),x=g(),b=m(),p=x.reduce((e,t)=>e+t.readingTimeMs,0),y=x.reduce((e,t)=>e+t.pagesRead,0),f=[];for(let e=6;e>=0;e--){let t=new Date;t.setDate(t.getDate()-e);let a=t.toISOString().split("T")[0],r=c.find(e=>e.date===a);f.push({date:a,day:t.toLocaleDateString("en",{weekday:"short"}),time:(null==r?void 0:r.readingTimeMs)||0,pages:(null==r?void 0:r.pagesRead)||0})}let v=Math.max(...f.map(e=>e.time),1);return t?(0,r.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4",children:(0,r.jsxs)("div",{className:"w-full max-w-lg bg-white dark:bg-gray-800 rounded-2xl shadow-2xl overflow-hidden max-h-[90vh] overflow-y-auto",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between px-4 py-3 border-b border-gray-200 dark:border-gray-700 bg-gradient-to-r from-purple-500 to-indigo-600 text-white",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"text-xl",children:"\uD83D\uDCCA"}),(0,r.jsx)("h3",{className:"font-semibold",children:"Reading Statistics"})]}),(0,r.jsx)("button",{onClick:a,className:"p-2 hover:bg-white/20 rounded-full transition-colors",children:(0,r.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,r.jsx)("div",{className:"px-4 py-3 bg-gradient-to-r from-amber-50 to-orange-50 dark:from-amber-900/30 dark:to-orange-900/30 border-b border-amber-200 dark:border-amber-800",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("span",{className:"text-3xl",children:i>0?"\uD83D\uDD25":"❄️"}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("p",{className:"font-bold text-lg text-amber-800 dark:text-amber-200",children:[i," day",1!==i?"s":""," streak"]}),(0,r.jsxs)("p",{className:"text-sm text-amber-600 dark:text-amber-400",children:["Best: ",d," days"]})]})]}),i>=7&&(0,r.jsx)("span",{className:"px-3 py-1 bg-amber-200 dark:bg-amber-700 rounded-full text-amber-800 dark:text-amber-200 text-sm font-medium",children:"\uD83D\uDCDA Bookworm!"})]})}),(0,r.jsxs)("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:[(0,r.jsx)("h4",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-3",children:"Today"}),(0,r.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("p",{className:"text-2xl font-bold text-purple-600 dark:text-purple-400",children:h?q(h.readingTimeMs):"0m"}),(0,r.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Reading time"})]}),(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("p",{className:"text-2xl font-bold text-indigo-600 dark:text-indigo-400",children:(null==h?void 0:h.pagesRead)||0}),(0,r.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Pages"})]}),(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("p",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:(null==h?void 0:h.sessionsCount)||0}),(0,r.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Sessions"})]})]})]}),(0,r.jsxs)("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:[(0,r.jsx)("h4",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-3",children:"Last 7 Days"}),(0,r.jsx)("div",{className:"flex items-end justify-between h-24 gap-1",children:f.map(e=>(0,r.jsxs)("div",{className:"flex-1 flex flex-col items-center",children:[(0,r.jsx)("div",{className:"w-full bg-purple-500 dark:bg-purple-400 rounded-t transition-all",style:{height:"".concat(Math.max(e.time/v*80,e.time>0?8:0),"px"),opacity:e.time>0?1:.2},title:"".concat(q(e.time)," - ").concat(e.pages," pages")}),(0,r.jsx)("span",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:e.day})]},e.date))}),(0,r.jsxs)("div",{className:"flex justify-between mt-2 text-sm",children:[(0,r.jsxs)("span",{className:"text-gray-500 dark:text-gray-400",children:["Week total: ",(0,r.jsx)("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:q(p)})]}),(0,r.jsxs)("span",{className:"text-gray-500 dark:text-gray-400",children:[(0,r.jsx)("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:y})," pages"]})]})]}),(0,r.jsxs)("div",{className:"p-4",children:[(0,r.jsx)("h4",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-3",children:"All Time"}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{className:"p-3 bg-gray-50 dark:bg-gray-900 rounded-lg",children:[(0,r.jsx)("p",{className:"text-xl font-bold text-gray-800 dark:text-gray-200",children:q(s)}),(0,r.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Total reading time"})]}),(0,r.jsxs)("div",{className:"p-3 bg-gray-50 dark:bg-gray-900 rounded-lg",children:[(0,r.jsx)("p",{className:"text-xl font-bold text-gray-800 dark:text-gray-200",children:l.toLocaleString()}),(0,r.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Pages read"})]}),(0,r.jsxs)("div",{className:"p-3 bg-gray-50 dark:bg-gray-900 rounded-lg",children:[(0,r.jsx)("p",{className:"text-xl font-bold text-gray-800 dark:text-gray-200",children:n}),(0,r.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Reading sessions"})]}),(0,r.jsxs)("div",{className:"p-3 bg-gray-50 dark:bg-gray-900 rounded-lg",children:[(0,r.jsx)("p",{className:"text-xl font-bold text-gray-800 dark:text-gray-200",children:o}),(0,r.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Books completed"})]})]}),n>0&&(0,r.jsxs)("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:[(0,r.jsxs)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["\uD83D\uDCC8 Average: ",(0,r.jsx)("span",{className:"font-medium",children:q(b)})," per day"]}),(0,r.jsxs)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:["\uD83D\uDCD6 Average: ",(0,r.jsx)("span",{className:"font-medium",children:Math.round(l/n)})," pages per session"]})]})]}),0===n&&(0,r.jsx)("div",{className:"px-4 pb-4",children:(0,r.jsxs)("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/30 rounded-lg text-center",children:[(0,r.jsx)("p",{className:"text-blue-800 dark:text-blue-200",children:"\uD83D\uDCD6 Start reading to track your progress!"}),(0,r.jsx)("p",{className:"text-sm text-blue-600 dark:text-blue-400 mt-1",children:"Your stats will appear here as you read."})]})})]})}):null}var ed=a(2569);function ec(e){let{bookUrl:t,bookId:a}=e,{currentBook:s,setCurrentBook:l,updateBookProgress:n,updateBookMetadata:o,settings:i,isSettingsOpen:u,isTocOpen:g,toggleSettings:m,toggleToc:h,addBook:x,books:b,highlights:y,bookmarks:f,addBookmark:v,removeBookmark:k}=d(),j=f.some(e=>e.bookId===a&&e.cfi===O),w=y.filter(e=>e.bookId===a),[N,S]=(0,c.useState)(!0),[C,D]=(0,c.useState)(null),[R,A]=(0,c.useState)([]),[M,T]=(0,c.useState)(!0),[L,E]=(0,c.useState)(0),[B,P]=(0,c.useState)(""),[I,U]=(0,c.useState)(0),[z,F]=(0,c.useState)(0),[O,_]=(0,c.useState)(""),[H,W]=(0,c.useState)(!1),[V,J]=(0,c.useState)(!1),[Y,q]=(0,c.useState)(!1),[X,$]=(0,c.useState)(!1),[Q,ee]=(0,c.useState)(""),[et,ea]=(0,c.useState)(null),{startSession:es,endSession:ec}=Z(),eu=(0,c.useRef)(0),eg=(0,c.useRef)(0),em=(0,c.useRef)(null),eh=(0,c.useRef)(null),ex=(0,c.useRef)(null),eb=(0,c.useRef)(null),ep=e=>e.map((e,t)=>({id:"toc-".concat(t),href:e.href,label:e.label,subitems:e.subitems?ep(e.subitems):void 0})),ey=(0,c.useCallback)(()=>{if(!ex.current)return;let e={light:{background:"#ffffff",color:"#1a1a1a"},dark:{background:"#1a1a1a",color:"#f0f0f0"},sepia:{background:"#f4ecd8",color:"#5c4a32"}};ex.current.themes.override("color",e[i.theme].color),ex.current.themes.override("background",e[i.theme].background),ex.current.themes.override("font-size","".concat(i.fontSize,"px")),ex.current.themes.override("line-height","".concat(i.lineHeight)),ex.current.themes.override("font-family","serif"===i.fontFamily?'Georgia, Cambria, "Times New Roman", serif':"system-ui, -apple-system, sans-serif")},[i]);(0,c.useEffect)(()=>{if(em.current)return(async()=>{try{S(!0),D(null),ex.current&&ex.current.destroy(),eh.current&&eh.current.destroy();let e=(0,ed.Ay)(t);eh.current=e,await e.ready;let r=await e.loaded.metadata,s=await e.coverUrl(),i=b.find(e=>e.id===a);i||x({id:a,title:r.title||"Unknown Title",author:r.creator||"Unknown Author",cover:s||void 0,progress:0}),l({id:a,title:r.title||"Unknown Title",author:r.creator||"Unknown Author",cover:s||void 0,progress:(null==i?void 0:i.progress)||0,currentCfi:null==i?void 0:i.currentCfi});let d=await e.loaded.navigation;if(A(ep(d.toc)),await e.locations.generate(1024),F(e.locations.length()),!(null==i?void 0:i.wordCount))try{let t=e.locations.length(),r=150*t;if(r>0){let e=Math.ceil(r/200);o(a,{wordCount:r,estimatedReadingMinutes:e})}}catch(e){console.error("Error calculating word count:",e)}let c=e.renderTo(em.current,{width:"100%",height:"100%",spread:"none",flow:"paginated"});ex.current=c,ey(),c.on("locationChanged",t=>{let r=e.locations.locationFromCfi(t.start.cfi),s=e.locations.length(),l=Math.round(r/s*100);E(l),U(r),_(t.start.cfi),eg.current!==r&&eg.current>0&&(eu.current+=1),eg.current=r;let o=e.spine.get(t.start.cfi);if(o){let e=d.toc.find(e=>e.href===o.href||e.href.startsWith(o.href.split("#")[0]));e&&P(e.label)}n(a,l,t.start.cfi,r)}),c.on("selected",(e,t)=>{var a;let r=null==t?void 0:null===(a=t.window)||void 0===a?void 0:a.getSelection();if(!r||0===r.rangeCount)return;let s=r.toString().trim();if(s.length<3)return;let l=r.getRangeAt(0).getBoundingClientRect();ea({position:{x:l.left+l.width/2,y:l.top},selectedText:s,cfi:String(e)})}),(null==i?void 0:i.currentCfi)?await c.display(i.currentCfi):await c.display(),c.on("rendered",()=>{y.filter(e=>e.bookId===a).forEach(e=>{var t,a;null===(a=c.annotations)||void 0===a||null===(t=a.highlight)||void 0===t||t.call(a,e.cfi,{},()=>{},void 0,{fill:{yellow:"rgba(255, 255, 0, 0.3)",green:"rgba(0, 255, 0, 0.3)",blue:"rgba(0, 100, 255, 0.3)",pink:"rgba(255, 182, 193, 0.5)"}[e.color]})});try{var e,t;let a=null===(e=c.getContents)||void 0===e?void 0:e.call(c);if(a&&(null===(t=a[0])||void 0===t?void 0:t.document)){let e=a[0].document.body;if(e){let t=e.innerText.replace(/\s+/g," ").trim();ee(t)}}}catch(e){console.error("Error extracting page text:",e)}}),c.on("keyup",e=>{"ArrowLeft"===e.key||"ArrowUp"===e.key?c.prev():("ArrowRight"===e.key||"ArrowDown"===e.key||" "===e.key)&&c.next()}),S(!1),es()}catch(e){console.error("Error loading EPUB:",e),D("Failed to load book. Please try again."),S(!1)}})(),()=>{ec(eu.current),ex.current&&ex.current.destroy(),eh.current&&eh.current.destroy()}},[t,a,es,ec]),(0,c.useEffect)(()=>{ey()},[i,ey]);let ef=()=>{var e;null===(e=ex.current)||void 0===e||e.prev()},ev=()=>{var e;null===(e=ex.current)||void 0===e||e.next()},ek=()=>{if(!O)return;let e=f.find(e=>e.bookId===a&&e.cfi===O);e?k(e.id):v({bookId:a,cfi:O,title:B||"Page ".concat(I)})};(0,c.useEffect)(()=>{let e=e=>{"ArrowLeft"===e.key||"ArrowUp"===e.key?ef():"ArrowRight"===e.key||"ArrowDown"===e.key||" "===e.key?(e.preventDefault(),ev()):"Escape"===e.key&&l(null)};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[l]);let ej=(0,c.useRef)(0),ew=()=>{T(!0),eb.current&&clearTimeout(eb.current),eb.current=setTimeout(()=>{T(!1)},3e3)},eN={light:"bg-white text-gray-900",dark:"bg-gray-900 text-gray-100",sepia:"bg-sepia-100 text-sepia-900"};return C?(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center ".concat(eN[i.theme]),children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("p",{className:"text-red-500 mb-4",children:C}),(0,r.jsx)("button",{onClick:()=>l(null),className:"px-4 py-2 bg-blue-500 text-white rounded-lg",children:"Back to Library"})]})}):(0,r.jsxs)("div",{className:"min-h-screen ".concat(eN[i.theme]," transition-colors duration-300"),onClick:()=>{et&&ea(null),ew()},onTouchStart:e=>{ej.current=e.touches[0].clientX},onTouchEnd:e=>{let t=e.changedTouches[0].clientX,a=ej.current-t;Math.abs(a)>50&&(a>0?ev():ef())},children:[(0,r.jsx)("div",{className:"fixed top-0 left-0 right-0 z-50",children:(0,r.jsx)("div",{className:"progress-bar",style:{width:"".concat(L,"%")}})}),(0,r.jsx)("header",{className:"fixed top-0 left-0 right-0 z-40 transition-transform duration-300 ".concat(M?"translate-y-0":"-translate-y-full"),children:(0,r.jsx)("div",{className:"".concat(eN[i.theme]," bg-opacity-95 backdrop-blur-sm shadow-md"),children:(0,r.jsxs)("div",{className:"flex items-center justify-between px-4 py-3",children:[(0,r.jsx)("button",{onClick:e=>{e.stopPropagation(),l(null)},className:"p-2 rounded-lg hover:bg-black/10 dark:hover:bg-white/10",children:"← Library"}),(0,r.jsxs)("div",{className:"flex-1 text-center px-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[(0,r.jsx)("h1",{className:"font-semibold truncate",children:null==s?void 0:s.title}),(0,r.jsx)(p,{compact:!0})]}),(0,r.jsx)("p",{className:"text-sm opacity-70",children:B||"Reading..."})]}),(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)("button",{onClick:e=>{e.stopPropagation(),ek()},className:"p-2 rounded-lg hover:bg-black/10 dark:hover:bg-white/10 transition-colors ".concat(j?"text-amber-500":""),title:j?"Remove Bookmark":"Add Bookmark",children:j?"\uD83D\uDD16":"\uD83C\uDFF7️"}),(0,r.jsxs)("button",{onClick:e=>{e.stopPropagation(),W(!0)},className:"p-2 rounded-lg hover:bg-black/10 dark:hover:bg-white/10 relative",title:"Annotations",children:["\uD83D\uDD8D️",(w.length>0||f.filter(e=>e.bookId===a).length>0)&&(0,r.jsx)("span",{className:"absolute -top-1 -right-1 w-4 h-4 bg-blue-500 text-white text-xs rounded-full flex items-center justify-center",children:w.length+f.filter(e=>e.bookId===a).length})]}),(0,r.jsx)("button",{onClick:e=>{e.stopPropagation(),J(!0)},className:"p-2 rounded-lg hover:bg-black/10 dark:hover:bg-white/10",title:"Vocabulary",children:"\uD83D\uDCDA"}),(0,r.jsx)("button",{onClick:e=>{e.stopPropagation(),q(!0)},className:"p-2 rounded-lg hover:bg-black/10 dark:hover:bg-white/10",title:"Listen (Text-to-Speech)",children:"\uD83C\uDFA7"}),(0,r.jsx)("button",{onClick:e=>{e.stopPropagation(),$(!0)},className:"p-2 rounded-lg hover:bg-black/10 dark:hover:bg-white/10",title:"Reading Statistics",children:"\uD83D\uDCCA"}),(0,r.jsx)("button",{onClick:e=>{e.stopPropagation(),h()},className:"p-2 rounded-lg hover:bg-black/10 dark:hover:bg-white/10",title:"Table of Contents",children:"\uD83D\uDCD6"}),(0,r.jsx)("button",{onClick:e=>{e.stopPropagation(),m()},className:"p-2 rounded-lg hover:bg-black/10 dark:hover:bg-white/10",title:"Settings",children:"⚙️"})]})]})})}),(0,r.jsx)("main",{className:"fixed inset-0 pt-16 pb-16",children:(0,r.jsx)("div",{ref:em,className:"w-full h-full",style:{padding:"small"===i.marginSize?"0 16px":"medium"===i.marginSize?"0 32px":"0 48px"}})}),N&&(0,r.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-inherit",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"}),(0,r.jsx)("p",{children:"Loading book..."})]})}),(0,r.jsx)("footer",{className:"fixed bottom-0 left-0 right-0 z-40 transition-transform duration-300 ".concat(M?"translate-y-0":"translate-y-full"),children:(0,r.jsx)("div",{className:"".concat(eN[i.theme]," bg-opacity-95 backdrop-blur-sm shadow-[0_-2px_10px_rgba(0,0,0,0.1)]"),children:(0,r.jsxs)("div",{className:"flex items-center justify-between px-4 py-3",children:[(0,r.jsx)("button",{onClick:e=>{e.stopPropagation(),ef()},className:"px-4 py-2 rounded-lg hover:bg-black/10 dark:hover:bg-white/10",children:"← Prev"}),(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsxs)("p",{className:"text-sm opacity-70",children:[I," / ",z]}),(0,r.jsxs)("p",{className:"text-xs opacity-50",children:[L,"% complete"]})]}),(0,r.jsx)("button",{onClick:e=>{e.stopPropagation(),ev()},className:"px-4 py-2 rounded-lg hover:bg-black/10 dark:hover:bg-white/10",children:"Next →"})]})})}),u&&(0,r.jsx)(K,{}),g&&(0,r.jsx)(G,{items:R,currentIndex:-1,onSelect:e=>{let t=R[e];t&&ex.current&&ex.current.display(t.href),h()}}),et&&(0,r.jsx)(er,{position:et.position,selectedText:et.selectedText,cfi:et.cfi,bookId:a,onClose:()=>ea(null)}),H&&(0,r.jsx)(el,{bookId:a,onNavigate:e=>{ex.current&&(ex.current.display(e),W(!1))},onClose:()=>W(!1)}),(0,r.jsx)(en,{isOpen:V,onClose:()=>J(!1),bookId:a}),(0,r.jsx)(eo,{text:Q,isOpen:Y,onClose:()=>q(!1),onPageComplete:ev}),(0,r.jsx)(ei,{isOpen:X,onClose:()=>$(!1)})]})}let eu=["pride-prejudice","moby-dick","frankenstein"];function eg(){let{currentBook:e}=d(),[t,a]=(0,c.useState)(null),[s,l]=(0,c.useState)(!1);return((0,c.useEffect)(()=>{if(!e){(null==t?void 0:t.startsWith("blob:"))&&URL.revokeObjectURL(t),a(null);return}(async()=>{l(!0);try{let t=await h(e.id);if(t){a(function(e){let t=new Blob([e],{type:"application/epub+zip"});return URL.createObjectURL(t)}(t));return}if(eu.includes(e.id)){a(function(e){{let t=window.location.pathname.replace(/\/$/,"");return"".concat(t,"/books/").concat(e,".epub")}}(e.id));return}a(null)}catch(e){console.error("Error loading EPUB:",e),a(null)}finally{l(!1)}})()},[null==e?void 0:e.id]),(0,c.useEffect)(()=>()=>{(null==t?void 0:t.startsWith("blob:"))&&URL.revokeObjectURL(t)},[t]),e)?s?(0,r.jsx)("main",{className:"min-h-screen bg-gray-100 dark:bg-gray-900 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-gray-600 dark:text-gray-300",children:"Preparing book..."})]})}):t?(0,r.jsx)("main",{className:"min-h-screen bg-gray-100 dark:bg-gray-900",children:(0,r.jsx)(ec,{bookUrl:t,bookId:e.id})}):(0,r.jsx)("main",{className:"min-h-screen bg-gray-100 dark:bg-gray-900",children:(0,r.jsx)(ee,{})}):(0,r.jsx)("main",{className:"min-h-screen bg-gray-100 dark:bg-gray-900",children:(0,r.jsx)(f,{})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[920,939,441,517,358],()=>t(8791)),_N_E=e.O()}]);