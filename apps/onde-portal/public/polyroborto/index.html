<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PolyRoborto Dashboard</title>
  <meta name="robots" content="noindex, nofollow">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Fira Code', monospace;
      background: linear-gradient(135deg, #0a0f1a 0%, #0f172a 50%, #1a1f2e 100%);
      color: #e2e8f0;
      min-height: 100vh;
      padding: 20px;
      line-height: 1.5;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 1px solid #334155;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .logo h1 {
      font-size: 24px;
      color: #38bdf8;
      font-weight: 700;
    }

    .status-badges {
      display: flex;
      gap: 12px;
      align-items: center;
    }

    .badge {
      padding: 4px 12px;
      border-radius: 4px;
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
    }

    .badge-live { background: #10b981; color: white; }
    .badge-paper { background: #f59e0b; color: #0f172a; }
    .badge-running { background: #22c55e20; color: #22c55e; border: 1px solid #22c55e; }
    .badge-offline { background: #ef444420; color: #ef4444; border: 1px solid #ef4444; }

    .last-update {
      font-size: 11px;
      color: #64748b;
    }

    /* Portfolio Hero Section */
    .portfolio-hero {
      background: linear-gradient(135deg, #1e3a5f 0%, #1e293b 100%);
      border: 2px solid #3b82f6;
      border-radius: 16px;
      padding: 24px;
      margin-bottom: 24px;
    }

    .portfolio-title {
      color: #60a5fa;
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 1.5px;
      margin-bottom: 20px;
    }

    .portfolio-grid {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 24px;
    }

    @media (max-width: 768px) {
      .portfolio-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    .portfolio-item {
      text-align: center;
    }

    .portfolio-label {
      color: #94a3b8;
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .portfolio-value {
      font-size: 28px;
      font-weight: 700;
      margin-top: 4px;
    }

    .portfolio-sub {
      font-size: 11px;
      color: #64748b;
      margin-top: 2px;
    }

    .progress-bar {
      height: 6px;
      background: #334155;
      border-radius: 3px;
      overflow: hidden;
      margin-top: 16px;
    }

    .progress-fill {
      height: 100%;
      border-radius: 3px;
      transition: width 0.3s ease;
    }

    /* Stats Grid */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 16px;
      margin-bottom: 24px;
    }

    @media (max-width: 768px) {
      .stats-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    .card {
      background: #1e293b;
      border-radius: 12px;
      padding: 20px;
      border: 1px solid #334155;
    }

    .card-label {
      color: #64748b;
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .card-value {
      font-size: 24px;
      font-weight: 700;
      margin-top: 6px;
    }

    .card-sub {
      font-size: 11px;
      color: #64748b;
      margin-top: 4px;
    }

    /* Side Breakdown */
    .side-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
      margin-bottom: 24px;
    }

    .side-card {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .yes { color: #10b981; }
    .no { color: #ef4444; }
    .positive { color: #10b981; }
    .negative { color: #ef4444; }

    /* Sections */
    .section {
      margin-bottom: 24px;
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }

    .section-title {
      color: #94a3b8;
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .section-count {
      background: #334155;
      padding: 2px 8px;
      border-radius: 4px;
      font-size: 11px;
      color: #94a3b8;
    }

    /* Tables */
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 12px;
    }

    th, td {
      text-align: left;
      padding: 12px 16px;
      border-bottom: 1px solid #334155;
    }

    th {
      color: #64748b;
      font-size: 10px;
      text-transform: uppercase;
      font-weight: 600;
    }

    tr:hover {
      background: #1e293b80;
    }

    .market-link {
      color: #38bdf8;
      text-decoration: none;
    }

    .market-link:hover {
      text-decoration: underline;
    }

    /* Charts Section */
    .charts-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 16px;
      margin-bottom: 24px;
    }

    @media (max-width: 1024px) {
      .charts-grid {
        grid-template-columns: 1fr;
      }
    }

    .chart-card {
      background: #1e293b;
      border-radius: 12px;
      padding: 20px;
      border: 1px solid #334155;
    }

    .chart-title {
      color: #94a3b8;
      font-size: 11px;
      text-transform: uppercase;
      margin-bottom: 12px;
    }

    .chart-container {
      position: relative;
      height: 180px;
    }

    /* Loading / Error States */
    .loading {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 400px;
      color: #64748b;
    }

    .spinner {
      width: 40px;
      height: 40px;
      border: 3px solid #334155;
      border-top-color: #38bdf8;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 16px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .error {
      background: #ef444420;
      border: 1px solid #ef4444;
      border-radius: 8px;
      padding: 20px;
      text-align: center;
      color: #fca5a5;
    }

    .empty-state {
      text-align: center;
      padding: 40px;
      color: #64748b;
    }

    /* Footer */
    .footer {
      text-align: center;
      padding: 24px;
      color: #64748b;
      font-size: 11px;
      border-top: 1px solid #334155;
      margin-top: 24px;
    }

    .footer a {
      color: #38bdf8;
      text-decoration: none;
    }

    /* Activity Log */
    .activity-item {
      display: flex;
      justify-content: space-between;
      padding: 10px 0;
      border-bottom: 1px solid #334155;
    }

    .activity-item:last-child {
      border-bottom: none;
    }

    .activity-time {
      color: #64748b;
      font-size: 11px;
      min-width: 80px;
    }

    .activity-type {
      color: #38bdf8;
      font-size: 11px;
      min-width: 120px;
    }

    .activity-message {
      flex: 1;
      font-size: 11px;
      color: #94a3b8;
      text-overflow: ellipsis;
      overflow: hidden;
      white-space: nowrap;
    }
  </style>
</head>
<body>
  <div class="container">
    <div id="app">
      <div class="loading">
        <div class="spinner"></div>
        <p>Loading dashboard data...</p>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    const GITHUB_RAW_URL = 'https://raw.githubusercontent.com/FreeRiverHouse/polyroborto-data/main/dashboard-data.json';
    const REFRESH_INTERVAL = 60 * 1000; // 60 seconds

    let charts = {
      winRate: null,
      pnl: null,
      roi: null
    };

    function formatCurrency(value) {
      const sign = value >= 0 ? '+' : '';
      return `${sign}$${Math.abs(value).toFixed(2)}`;
    }

    function formatPercent(value) {
      const sign = value >= 0 ? '+' : '';
      return `${sign}${value.toFixed(1)}%`;
    }

    function formatUptime(seconds) {
      const hours = Math.floor(seconds / 3600);
      const minutes = Math.floor((seconds % 3600) / 60);
      if (hours > 24) {
        const days = Math.floor(hours / 24);
        return `${days}d ${hours % 24}h`;
      }
      return hours > 0 ? `${hours}h ${minutes}m` : `${minutes}m`;
    }

    function formatTime(isoString) {
      const date = new Date(isoString);
      return date.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
    }

    function formatDate(isoString) {
      const date = new Date(isoString);
      return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }) + ' ' + formatTime(isoString);
    }

    function getValueClass(value) {
      return value >= 0 ? 'positive' : 'negative';
    }

    function truncateText(text, maxLength) {
      if (!text) return '-';
      return text.length > maxLength ? text.slice(0, maxLength) + '...' : text;
    }

    function renderDashboard(data) {
      const app = document.getElementById('app');

      const usagePercent = data.portfolio.bankroll > 0
        ? (data.portfolio.invested / data.portfolio.bankroll) * 100
        : 0;

      app.innerHTML = `
        <header class="header">
          <div class="logo">
            <h1>PolyRoborto</h1>
          </div>
          <div class="status-badges">
            <span class="badge ${data.status.mode === 'LIVE' ? 'badge-live' : 'badge-paper'}">${data.status.mode}</span>
            <span class="badge ${data.status.isRunning ? 'badge-running' : 'badge-offline'}">${data.status.isRunning ? 'Running' : 'Offline'}</span>
            <span class="last-update">Uptime: ${formatUptime(data.status.uptimeSeconds)} | Updated: ${formatDate(data.lastUpdated)}</span>
          </div>
        </header>

        <!-- Portfolio Hero -->
        <div class="portfolio-hero">
          <div class="portfolio-title">Portfolio Overview</div>
          <div class="portfolio-grid">
            <div class="portfolio-item">
              <div class="portfolio-label">Bankroll</div>
              <div class="portfolio-value" style="color: #38bdf8">$${data.portfolio.bankroll.toFixed(2)}</div>
            </div>
            <div class="portfolio-item">
              <div class="portfolio-label">Invested</div>
              <div class="portfolio-value" style="color: #f59e0b">$${data.portfolio.invested.toFixed(2)}</div>
              <div class="portfolio-sub">${data.positions.open.length} positions</div>
            </div>
            <div class="portfolio-item">
              <div class="portfolio-label">Available</div>
              <div class="portfolio-value" style="color: #a855f7">$${data.portfolio.available.toFixed(2)}</div>
            </div>
            <div class="portfolio-item">
              <div class="portfolio-label">Realized P&L</div>
              <div class="portfolio-value ${getValueClass(data.portfolio.realizedPnl)}">${formatCurrency(data.portfolio.realizedPnl)}</div>
              <div class="portfolio-sub">${data.performance.wins + data.performance.losses} closed</div>
            </div>
            <div class="portfolio-item">
              <div class="portfolio-label">ROI</div>
              <div class="portfolio-value ${getValueClass(data.portfolio.roi)}">${formatPercent(data.portfolio.roi)}</div>
            </div>
          </div>
          <div style="margin-top: 16px;">
            <div style="display: flex; justify-content: space-between; font-size: 10px; color: #64748b; margin-bottom: 4px;">
              <span>Bankroll Usage</span>
              <span>${usagePercent.toFixed(1)}% invested</span>
            </div>
            <div class="progress-bar">
              <div class="progress-fill" style="width: ${Math.min(usagePercent, 100)}%; background: linear-gradient(90deg, #f59e0b, #ef4444);"></div>
            </div>
          </div>
        </div>

        <!-- Stats Grid -->
        <div class="stats-grid">
          <div class="card">
            <div class="card-label">Win Rate</div>
            <div class="card-value ${data.performance.winRate >= 50 ? 'positive' : 'negative'}">${data.performance.winRate.toFixed(1)}%</div>
            <div class="card-sub">${data.performance.wins}W / ${data.performance.losses}L</div>
            <div class="progress-bar" style="margin-top: 8px;">
              <div class="progress-fill" style="width: ${data.performance.winRate}%; background: #10b981;"></div>
            </div>
          </div>
          <div class="card">
            <div class="card-label">Avg Win</div>
            <div class="card-value positive">+$${data.performance.avgWinSize.toFixed(2)}</div>
            <div class="card-sub">per winning trade</div>
          </div>
          <div class="card">
            <div class="card-label">Avg Loss</div>
            <div class="card-value negative">$${Math.abs(data.performance.avgLossSize).toFixed(2)}</div>
            <div class="card-sub">per losing trade</div>
          </div>
          <div class="card">
            <div class="card-label">Total Trades</div>
            <div class="card-value" style="color: #38bdf8">${data.performance.totalTrades}</div>
            <div class="card-sub">Avg size: $${data.performance.avgBetSize.toFixed(2)}</div>
          </div>
        </div>

        <!-- Side Breakdown -->
        <div class="side-grid">
          <div class="card side-card">
            <div>
              <div class="card-label">YES Positions</div>
              <div class="card-value yes">${data.sideBreakdown.yesPositions} open</div>
            </div>
            <div style="text-align: right;">
              <div class="card-label">Realized</div>
              <div class="card-value ${getValueClass(data.sideBreakdown.yesPnl)}">${formatCurrency(data.sideBreakdown.yesPnl)}</div>
            </div>
          </div>
          <div class="card side-card">
            <div>
              <div class="card-label">NO Positions</div>
              <div class="card-value no">${data.sideBreakdown.noPositions} open</div>
            </div>
            <div style="text-align: right;">
              <div class="card-label">Realized</div>
              <div class="card-value ${getValueClass(data.sideBreakdown.noPnl)}">${formatCurrency(data.sideBreakdown.noPnl)}</div>
            </div>
          </div>
        </div>

        <!-- Charts -->
        <div class="charts-grid">
          <div class="chart-card">
            <div class="chart-title">Win Rate % (7d)</div>
            <div class="chart-container">
              <canvas id="winRateChart"></canvas>
            </div>
          </div>
          <div class="chart-card">
            <div class="chart-title">Realized P&L (7d)</div>
            <div class="chart-container">
              <canvas id="pnlChart"></canvas>
            </div>
          </div>
          <div class="chart-card">
            <div class="chart-title">ROI % (7d)</div>
            <div class="chart-container">
              <canvas id="roiChart"></canvas>
            </div>
          </div>
        </div>

        <!-- Open Positions -->
        <div class="section">
          <div class="section-header">
            <span class="section-title">Open Positions</span>
            <span class="section-count">${data.positions.open.length}</span>
          </div>
          <div class="card">
            ${data.positions.open.length === 0 ? `
              <div class="empty-state">No open positions</div>
            ` : `
              <table>
                <thead>
                  <tr>
                    <th>Market</th>
                    <th>Side</th>
                    <th>Size</th>
                    <th>Entry</th>
                    <th>Potential Win</th>
                  </tr>
                </thead>
                <tbody>
                  ${data.positions.open.slice(0, 15).map(p => `
                    <tr>
                      <td>
                        ${p.eventSlug ? `
                          <a href="https://polymarket.com/event/${p.eventSlug}" target="_blank" class="market-link" title="${p.marketSlug}">
                            ${truncateText(p.marketSlug, 35)}
                          </a>
                        ` : truncateText(p.marketSlug, 35)}
                      </td>
                      <td class="${p.side.toLowerCase()}">${p.side}</td>
                      <td>$${p.sizeUsd.toFixed(2)}</td>
                      <td>${(p.entryPrice * 100).toFixed(0)}%</td>
                      <td class="positive">+$${p.potentialWin.toFixed(2)}</td>
                    </tr>
                  `).join('')}
                </tbody>
              </table>
              ${data.positions.open.length > 15 ? `
                <div style="text-align: center; padding: 12px; color: #64748b; font-size: 11px;">
                  ... and ${data.positions.open.length - 15} more positions
                </div>
              ` : ''}
            `}
          </div>
        </div>

        <!-- Recent Closed Positions -->
        <div class="section">
          <div class="section-header">
            <span class="section-title">Recent Closed Positions</span>
            <span class="section-count">${data.positions.recentClosed.length}</span>
          </div>
          <div class="card">
            ${data.positions.recentClosed.length === 0 ? `
              <div class="empty-state">No closed positions yet</div>
            ` : `
              <table>
                <thead>
                  <tr>
                    <th>Market</th>
                    <th>Side</th>
                    <th>Entry/Exit</th>
                    <th>P&L</th>
                    <th>Reason</th>
                  </tr>
                </thead>
                <tbody>
                  ${data.positions.recentClosed.map(p => `
                    <tr>
                      <td>${truncateText(p.marketSlug, 35)}</td>
                      <td class="${p.side.toLowerCase()}">${p.side}</td>
                      <td>${(p.entryPrice * 100).toFixed(0)}% / ${p.exitPrice ? (p.exitPrice * 100).toFixed(0) + '%' : '-'}</td>
                      <td class="${getValueClass(p.pnl)}">${formatCurrency(p.pnl)}</td>
                      <td style="color: #64748b; font-size: 11px;">${p.exitReason || '-'}</td>
                    </tr>
                  `).join('')}
                </tbody>
              </table>
            `}
          </div>
        </div>

        <!-- Recent Activity -->
        <div class="section">
          <div class="section-header">
            <span class="section-title">Recent Activity</span>
          </div>
          <div class="card">
            ${data.activity.length === 0 ? `
              <div class="empty-state">No recent activity</div>
            ` : `
              ${data.activity.slice(0, 10).map(a => `
                <div class="activity-item">
                  <span class="activity-time">${formatTime(a.timestamp)}</span>
                  <span class="activity-type">${a.eventType}</span>
                  <span class="activity-message">${a.message || '-'}</span>
                </div>
              `).join('')}
            `}
          </div>
        </div>

        <footer class="footer">
          <p>PolyRoborto Dashboard | Auto-refreshes every 60 seconds</p>
          <p style="margin-top: 8px;">Data source: <a href="https://github.com/FreeRiverHouse/polyroborto-data" target="_blank">GitHub</a></p>
        </footer>
      `;

      // Initialize charts after DOM is ready
      setTimeout(() => initCharts(data), 100);
    }

    function initCharts(data) {
      if (!data.charts || !data.charts.snapshots || data.charts.snapshots.length === 0) {
        return;
      }

      const snapshots = data.charts.snapshots;
      const labels = snapshots.map(s => {
        const date = new Date(s.timestamp);
        return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
      });

      Chart.defaults.color = '#94a3b8';
      Chart.defaults.borderColor = '#334155';

      const chartConfig = (label, values, borderColor, bgColor) => ({
        type: 'line',
        data: {
          labels,
          datasets: [{
            label,
            data: values,
            borderColor,
            backgroundColor: bgColor,
            borderWidth: 2,
            fill: true,
            tension: 0.3,
            pointRadius: 0,
            pointHoverRadius: 4,
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { display: false },
            tooltip: {
              mode: 'index',
              intersect: false,
              backgroundColor: '#1e293b',
              borderColor: '#334155',
              borderWidth: 1,
            }
          },
          scales: {
            x: {
              display: true,
              grid: { display: false },
              ticks: { maxTicksLimit: 6, font: { size: 10 } }
            },
            y: {
              display: true,
              grid: { color: '#334155' },
              ticks: { font: { size: 10 } }
            }
          }
        }
      });

      // Destroy existing charts
      Object.values(charts).forEach(c => c && c.destroy());

      // Win Rate Chart
      const winRateCtx = document.getElementById('winRateChart');
      if (winRateCtx) {
        charts.winRate = new Chart(winRateCtx, chartConfig(
          'Win Rate %',
          snapshots.map(s => s.winRate),
          '#10b981',
          'rgba(16, 185, 129, 0.1)'
        ));
      }

      // P&L Chart
      const pnlCtx = document.getElementById('pnlChart');
      if (pnlCtx) {
        const lastPnl = snapshots[snapshots.length - 1]?.pnl || 0;
        const pnlColor = lastPnl >= 0 ? '#10b981' : '#ef4444';
        const pnlBg = lastPnl >= 0 ? 'rgba(16, 185, 129, 0.1)' : 'rgba(239, 68, 68, 0.1)';
        charts.pnl = new Chart(pnlCtx, chartConfig(
          'P&L ($)',
          snapshots.map(s => s.pnl),
          pnlColor,
          pnlBg
        ));
      }

      // ROI Chart
      const roiCtx = document.getElementById('roiChart');
      if (roiCtx) {
        const lastRoi = snapshots[snapshots.length - 1]?.roi || 0;
        const roiColor = lastRoi >= 0 ? '#38bdf8' : '#ef4444';
        const roiBg = lastRoi >= 0 ? 'rgba(56, 189, 248, 0.1)' : 'rgba(239, 68, 68, 0.1)';
        charts.roi = new Chart(roiCtx, chartConfig(
          'ROI %',
          snapshots.map(s => s.roi),
          roiColor,
          roiBg
        ));
      }
    }

    function renderError(message) {
      const app = document.getElementById('app');
      app.innerHTML = `
        <header class="header">
          <div class="logo">
            <h1>PolyRoborto</h1>
          </div>
        </header>
        <div class="error">
          <h3>Unable to load dashboard data</h3>
          <p style="margin-top: 8px;">${message}</p>
          <p style="margin-top: 16px; font-size: 12px;">Retrying in 60 seconds...</p>
        </div>
      `;
    }

    async function fetchData() {
      try {
        // Add cache buster to avoid GitHub CDN caching
        const url = `${GITHUB_RAW_URL}?t=${Date.now()}`;
        const response = await fetch(url);

        if (!response.ok) {
          throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }

        const data = await response.json();
        renderDashboard(data);
      } catch (error) {
        console.error('Failed to fetch dashboard data:', error);
        renderError(error.message);
      }
    }

    // Initial load
    fetchData();

    // Auto-refresh
    setInterval(fetchData, REFRESH_INTERVAL);
  </script>
</body>
</html>
