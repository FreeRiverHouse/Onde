(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1298],{30813:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>l});var t=a(54568),i=a(7620);function l(){let[e,s]=(0,i.useState)(null),[a,l]=(0,i.useState)([]),[n,c]=(0,i.useState)(!0),[r,o]=(0,i.useState)(""),[d,m]=(0,i.useState)(!1),[x,h]=(0,i.useState)(""),[u,p]=(0,i.useState)("");async function b(){try{let e=await fetch("/api/auth/me"),a=await e.json();if(a.user){s(a.user);let e=await fetch("/api/user/purchases"),t=await e.json();l(t.purchases||[])}}catch(e){console.error("Error fetching user:",e)}finally{c(!1)}}async function g(e){e.preventDefault(),m(!0),p(""),h("");try{let e=await fetch("/api/auth/magic-link",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:r})}),s=await e.json();e.ok?(h(s.message),o("")):p(s.error)}catch(e){p("Errore di connessione. Riprova."),console.error(e)}finally{m(!1)}}return((0,i.useEffect)(()=>{let e=new URLSearchParams(window.location.search);"true"===e.get("success")&&h("Accesso effettuato!"),"invalid_token"===e.get("error")&&p("Link non valido o scaduto. Richiedi un nuovo link."),"missing_token"===e.get("error")&&p("Token mancante."),b()},[]),n)?(0,t.jsx)("div",{className:"max-w-2xl mx-auto px-4 py-12",children:(0,t.jsxs)("div",{className:"animate-pulse",children:[(0,t.jsx)("div",{className:"h-10 bg-white/10 rounded mb-8 w-1/2"}),(0,t.jsx)("div",{className:"h-40 bg-white/10 rounded-2xl"})]})}):e?(0,t.jsxs)("div",{className:"max-w-4xl mx-auto px-4 py-12",children:[(0,t.jsx)("h1",{className:"text-4xl font-bold mb-8",children:"Il Mio Account"}),(0,t.jsxs)("div",{className:"bg-white/5 rounded-2xl p-8 mb-8",children:[(0,t.jsxs)("div",{className:"flex items-center gap-6 mb-6",children:[(0,t.jsx)("div",{className:"w-20 h-20 bg-onde-gold/20 rounded-full flex items-center justify-center text-3xl",children:e.email.charAt(0).toUpperCase()}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-2xl font-bold",children:e.name||e.email}),(0,t.jsx)("p",{className:"opacity-60",children:e.email}),(0,t.jsxs)("p",{className:"text-sm opacity-40 mt-1",children:["Membro dal ",new Date(e.createdAt).toLocaleDateString("it-IT",{month:"long",year:"numeric"})]})]})]}),(0,t.jsx)("a",{href:"/api/auth/logout",className:"text-red-400 hover:text-red-300 text-sm",children:"Esci"})]}),(0,t.jsxs)("div",{className:"bg-white/5 rounded-2xl p-8",children:[(0,t.jsx)("h3",{className:"text-xl font-bold mb-6",children:"La Mia Libreria"}),0===a.length?(0,t.jsxs)("div",{className:"text-center py-12 opacity-60",children:[(0,t.jsx)("p",{className:"mb-4",children:"Non hai ancora acquistato nessun libro."}),(0,t.jsx)("a",{href:"/catalogo",className:"btn-primary inline-block",children:"Esplora il Catalogo"})]}):(0,t.jsx)("div",{className:"grid gap-4",children:a.map(e=>(0,t.jsxs)("div",{className:"flex items-center justify-between p-4 bg-white/5 rounded-xl",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-bold",children:e.bookTitle}),(0,t.jsxs)("p",{className:"text-sm opacity-60",children:["Acquistato il ",new Date(e.purchasedAt).toLocaleDateString("it-IT")]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsxs)("span",{className:"text-onde-gold",children:["EUR",e.price.toFixed(2)]}),(0,t.jsx)("a",{href:"/libro/".concat(e.bookId),className:"px-4 py-2 bg-onde-gold text-black rounded-lg text-sm font-bold hover:bg-onde-gold/80",children:"Leggi"})]})]},e.id))})]})]}):(0,t.jsxs)("div",{className:"max-w-md mx-auto px-4 py-12",children:[(0,t.jsx)("h1",{className:"text-4xl font-bold mb-8 text-center",children:"Accedi"}),x&&(0,t.jsx)("div",{className:"bg-green-500/20 border border-green-500 rounded-lg p-4 mb-6 text-center",children:x}),u&&(0,t.jsx)("div",{className:"bg-red-500/20 border border-red-500 rounded-lg p-4 mb-6 text-center",children:u}),(0,t.jsxs)("div",{className:"bg-white/5 rounded-2xl p-8",children:[(0,t.jsxs)("p",{className:"text-center mb-6 opacity-80",children:["Inserisci la tua email per ricevere un link di accesso.",(0,t.jsx)("br",{}),(0,t.jsx)("span",{className:"text-sm opacity-60",children:"Nessuna password necessaria!"})]}),(0,t.jsxs)("form",{onSubmit:g,children:[(0,t.jsx)("input",{type:"email",value:r,onChange:e=>o(e.target.value),placeholder:"la-tua@email.com",className:"w-full bg-white/10 rounded-lg px-4 py-3 mb-4 focus:outline-none focus:ring-2 focus:ring-onde-gold",required:!0,disabled:d}),(0,t.jsx)("button",{type:"submit",disabled:d,className:"w-full bg-onde-gold text-black font-bold py-3 rounded-lg hover:bg-onde-gold/80 disabled:opacity-50 disabled:cursor-not-allowed",children:d?"Invio in corso...":"Invia Link di Accesso"})]})]}),(0,t.jsx)("p",{className:"text-center mt-8 opacity-60 text-sm",children:"Non hai un account? Si crea automaticamente al primo accesso."})]})}},30861:(e,s,a)=>{Promise.resolve().then(a.bind(a,30813))}},e=>{e.O(0,[587,18,7358],()=>e(e.s=30861)),_N_E=e.O()}]);