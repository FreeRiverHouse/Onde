# Sessione 22 Gennaio 2026 - Agent Worker con Claude Code

## Cosa fatto

### 1. Agent Worker riscritto con Claude Code CLI
- Rimosso Z.ai, ora usa `claude` CLI come backend
- Prompt piped via stdin (evita problemi di shell escaping)
- ~4-6s per task con haiku, sonnet per code tasks
- Config letti da `content/agents/` (file esistenti)
- Mapping agent IDs: engineering-dept->code-worker, ceo-orchestrator->strategic-advisor, qa-test-engineer->tech-support

### 2. Fix AGENTS_DIR
- Era puntato a `.claude/agents/` (sbagliato)
- Ora punta a `content/agents/` (dove i config GIA' esistevano)

### 3. Regole Git aggiunte a CLAUDE.md
- SEMPRE git pull prima di lavorare
- Mai pushare senza pull
- Non committare build artifacts

### 4. Regola "sbrinchi sbronchi" salvata
- Fine sessione hook: aggiorna chat-history, ROADMAP, commit, conferma

## Decisioni

- **Backend agenti**: Claude Code CLI (non Z.ai, non Anthropic API diretto)
- **Modello default**: haiku (veloce, 4s), sonnet solo per code tasks
- **Approach stdin**: Evita problemi con --system-prompt e caratteri speciali
- **cwd /tmp**: Evita che Claude carichi il CLAUDE.md del progetto (troppo pesante per task semplici)

## File Creati/Aggiornati

- `packages/agent-worker/index.ts` - Worker riscritto con Claude Code
- `CLAUDE.md` - Regole git + regola sbrinchi sbronchi

## Commit
- `f779bafd1` - Fix agent-worker to use existing configs from content/agents/
- `ad1ee1360` / `961539876` - Switch agent-worker to Claude Code CLI backend
- `99d53a7c7` - Add mandatory git rules
- `0f279bb4b` - Add sbrinchi sbronchi preference

### 5. Fix Continuous Claude Hooks (sessione continuata)
- `session-start-runner.js` riscritto: ora inietta regole, ultimo handoff, idee recenti
- `sbrinchi-sbronchi.js` creato: hook UserPromptSubmit per fine sessione
- `.claude/settings.json` aggiornato con matcher `sbrinchi|sbronchi`
- Problema: hooks precedenti outputtavano solo 2 righe, Claude non ricordava le regole
- Soluzione: output completo con tutte le info critiche a inizio sessione

## Commit (continuazione)
- `8aace2a8c` - Fix Continuous Claude hooks - full context injection at session start

## Prossimi Passi

1. Installare worker sul Mac M1 always-on (LaunchAgent)
2. Testare tutti gli agenti con task reali
3. Verificare che UserPromptSubmit hook funzioni nella prossima sessione

---

*Sbrinchi sbronchi: 22 Gen 2026*
