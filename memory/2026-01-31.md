# 2026-01-31 Memory Log

## 10:20 PST - Heartbeat: Agent Gamification Implementation

### Tasks Completed
1. **T509 - XP and Levels for Agents (Gamification)** ‚úÖ
   - Created DB migration `0006_agent_gamification.sql`
   - Added xp, level, total_tasks_done, current_streak, longest_streak, badges to agents table
   - Created badges table with 13 achievement badges
   - XP system: +10 XP per task, level = floor(xp/100) + 1
   - Auto-award XP on task completion via awardAgentXPInD1()
   - Updated FreeRiverHouse.tsx with:
     - Level badge on avatar (color-coded)
     - XP progress bar with gradient
     - Badges display (up to 6 shown)
     - Streak indicator with flame emoji
   - Created gamification.ts utility library

2. **T750 - Deploy onde.surf with gamification** ‚úÖ
   - Deploy URL: https://ac73ff67.onde-surf.pages.dev
   - Build + deploy successful
   - ‚ö†Ô∏è D1 migration still needed (manual via dashboard)

### Tasks Added
- T751: Agent Leaderboard widget
- T752: Level-up celebration animation

### System Status
- Autotrader: Running (PID 66542)
- No alert files
- Git: synced and pushed

### Notes
- The gamification UI is deployed but won't show data until D1 migration is run
- Badges are emoji-based for easy cross-platform display
- Streak tracking considers consecutive days, not just task count

## 2026-01-31 13:XX - Heartbeat Work Session

### Tasks Completed
1. **[T732] SE-Bot README** - Created comprehensive README.md with:
   - ASCII architecture diagram
   - Installation guide, audio routing setup
   - Usage examples, troubleshooting
   - File reference

2. **[T772] Model calibration analysis** - Created `analyze-model-calibration.py`:
   - Brier score, ECE calculation
   - Calibration curve by probability bucket
   - **Critical finding**: 40-60% bucket has 0% win rate (246 trades)!
   - Needs probability calculation review

### New Tasks Added
- [T811] SE-Bot quickstart script
- [T812] Reader App reading goals
- [T813] Market regime detection

3. **[T773] Weather forecast validation** - Created `validate-weather-forecasts.py`:
   - Compares NWS forecasts vs actual temps (Open-Meteo)
   - **Critical finding**: +2.8¬∞F systematic over-prediction bias!
   - This likely explains weather trade losses
   - Recommendation: adjust forecasts down ~3¬∞F

### Summary
- Autotrader running (PID 66542) ‚úÖ
- No alert files ‚úÖ
- 3 tasks completed, 3 new tasks added
- Key finding: Model calibration and weather forecasts need tuning

## 2026-01-31 02:00 UTC - Heartbeat Work: Skin Creator Layer Ordering

### Completed
- **[T886] Skin Creator: Overlay Layer Ordering** - DONE
  - Found existing UI with ‚Üë/‚Üì buttons
  - **Fixed critical bug**: moveLayer direction was inverted!
  - "up" was moving layers DOWN in z-order (wrong)
  - Fixed: `newIndex = direction === 'up' ? index + 1 : index - 1`
  - Now correctly: up = higher z-index (top), down = lower z-index (bottom)
  - Deployed to https://skin-studio.pages.dev

### Added New Tasks
- [T903] Drag-and-drop layer reordering (better UX)
- [T904] Duplicate layer feature
- [T905] Layer lock feature

### Status Check
- Autotrader: Running ‚úÖ (PID 16949)
- No alert files ‚úÖ

## 2026-01-31 04:35 UTC - Heartbeat Work

### Task Completed
- **[T952] Unified Crontab Setup Script** - DONE
  - Created `scripts/setup-crontab.sh` with install/show/remove options
  - Uses ONDE-CRON marker for idempotent cron management
  - Created `scripts/cleanup-old-logs.sh` for weekly log cleanup
  - Committed and pushed to main

### Alerts Processed
- **kalshi-latency.alert** - API latency anomaly (positions: 1215ms avg)
  - Autotrader still running (PID 16949)
  - Alert file deleted after reading

### System Status
- Autotrader: ‚úÖ Running (PID 16949)
- Git: ‚úÖ Synced with origin

## 2026-01-30 20:48 PST - Continuous Autodevelopment Moonlight

### Messaggio (ID: 2945)
[Audio Transcription] Il lavoro di Continuous Autodevelopment and Testing sta procedendo su Moonlight Magic House. Non ti devo spiegare, basta che leggi tutta la memoria e tutta la guida per capire di cosa sto parlando. Ok, fammi sapere perch√© devo andare avanti su quell'apura cannone.

### Contesto
Mattia chiede update/feedback sul lavoro di continuous autodevelopment su Moonlight Magic House - deve andare avanti veloce ("a pura cannone")

## 2026-01-31 00:12 PST - Feedback su Cooking Game duplicato

### Messaggio (ID: 3042)
Mattia (voice): "Per√≤ scusa veramente il Biavere 2 Cooking Games, evidentemente dentro a Moonlight, quando lei va in cucina ci sar√† un modo per cui lei pu√≤ giocare al gioco di Kids Chef Studio, o non ti sembra una cosa pi√π sensata? Ti sto a vedere non pu√≤... rinco io niente di poi dammi una bella svegliata, zio, che succede."

### Contesto
- Ho appena completato T922 creando un CookingGame minigame dentro Moonlight Magic House
- Ma esiste gi√† Kids Chef Studio come gioco separato!
- Mattia fa notare che non ha senso avere 2 cooking games
- Meglio integrare Kids Chef Studio quando si va in cucina in Moonlight

### Decisione
- Ha ragione! Dovrei integrare Kids Chef Studio nel room Cucina di Moonlight
- Non creare minigame duplicati ma linkare ai giochi esistenti
- Questo vale anche per altri room/giochi

### TODO
- Modificare Kitchen room in Moonlight per lanciare Kids Chef Studio
- Rimuovere/sostituire il CookingGame inline

## 2026-01-31 06:58 - Casual Greeting
### Messaggio (ID: 3043)
"My g" - Saluto casual da Mattia

## 2026-01-31 07:24 PST - Heartbeat Work Session

### Tasks Completed
1. **[T943] Documentation: Bot LLM Integration Examples** - DONE ‚úÖ
   - Added "Bot/Clawdbot Integration" section to `scripts/local-agents/README.md`
   - Documented when to use local LLM vs Claude API
   - Added heartbeat task delegation example
   - Added code generation automation example  
   - Added batch processing with ThreadPoolExecutor example
   - Added error handling best practices (Ollama health checks)

### New Tasks Added
- [T1017] Infra: Memory File Auto-Archiver (P3)
- [T1018] Trading: Local LLM for Trade Reasoning (P2)
- [T1019] Heartbeat: State Caching for Efficiency (P3)

### System Status
- Autotrader: Running (PID 1070) ‚úÖ
- Alerts: 0 ‚úÖ
- Git: Synced and pushed

## 2026-01-31 07:24 - Radeon Riattaccata

### Messaggio (ID: 3047)
Mattia ha riattaccato la Radeon 7900 XTX. Richiesta: seguire procedura per usarla.
**ULTIMATUM:** Se dico ancora che non funziona ‚Üí installa Kimi2.5!

### Azione
Seguire procedura TOOLS.md step by step.

### Verifica Completata ‚úÖ
1. **Thunderbolt:** Core X V2 connesso su Receptacle 2 ‚úÖ
2. **Display:** AMD Vendor (0x1002) rilevato ‚úÖ
3. **TinyGPU.app:** Driver attivo ‚úÖ
4. **TinyGrad AMD:** Device caricato ‚úÖ
5. **GPT-2 test:** "Hello world, this is fine, this is how we would" ‚úÖ

**RADEON 7900 XTX FUNZIONANTE!** üéâ

## 2026-01-31 07:29 - GPU Testing Request
### Messaggio (ID: 3050)
Mattia chiede test VERI sulla Radeon, non "presa per il culo". Vuole vedere task reali, non solo test banali.
### Azione
Eseguire test seri: inference con modelli grandi, benchmark reali.

## 2026-01-31 07:30 PST - Feedback su GPU/Modelli

### Messaggio (ID: 3055)
**Vocale trascritto:** "Guarda che esiste gi√† una lista dei modelli installati nelle procedure nostre, eh? Perch√© non cerchi nei file dei repositori? Tasca, logga e segui."

### Contesto
- Mattia mi fa notare che c'√® gi√† documentazione sui modelli installati
- Devo cercare nei file del repo prima di provare cose a caso
- Reminder: seguire le procedure esistenti!

### Lezione
**SEMPRE cercare nei file del repo prima di testare cose a caso!**
- Lista modelli TinyGrad: `memory/2025-01-30.md`
- Setup GPU: `TOOLS.md`
- Procedure: `tools/tech-support/`

## 2026-01-31 07:34 PST - Mattia mi cazzia per non leggere le procedure

### Messaggio (ID: 3062)
Mattia (vocale): "No, non ti mettere sulla traduzione per adesso, per√≤ mi fai incazzare, c'erano gi√† i modelli installati, li stiamo usando per coding, tu non stai guardando quello che c'√® sull'SSD drive e nelle procedure, ci sono procedure con tutti i modelli che abbiamo su questo computer che puoi usare, non ti reinventare la ruota, per favore, devi prima leggere cosa c'√® gi√†, coglione, task e log."

### Lezione importante
**PRIMA di proporre soluzioni nuove:**
1. Controllare SSD: `/Volumes/DATI-SSD/llm-models/`
2. Leggere procedure: `tools/RADEON-TINYGRAD-PROCEDURES.md`
3. NON reinventare la ruota!

### Cosa c'√® gi√† installato:
- **LLaMA 3.1 8B** (GGUF) ‚Üí `/Volumes/DATI-SSD/llm-models/Meta-Llama-3.1-8B-Instruct-Q4_K_M.gguf`
- **Procedure TinyGrad** ‚Üí `tools/RADEON-TINYGRAD-PROCEDURES.md` (codice, immagini, traduzioni, audio, video)
- Modello HF: `TriAiExperiments/SFR-Iterative-DPO-LLaMA-3-8B-R`

### Note
Mattia ha ragione. Devo sempre controllare cosa esiste PRIMA di proporre soluzioni.

## 2026-01-31 07:39 PST - Istruzioni per Traduzione Libri

### Messaggio (ID: 3070)
Mattia (vocale): "Pensi di essere in grado a metterti a lavoro sulla traduzione? S√¨, ho i miei dubbi, per√≤ la puoi provare a fare, per√≤ vai piano piano controlla quello che fai di volta in volta e vedi che abbia senso, non tradurre tutto il libro e poi si scopre che hai tradotto tutto il libro sbagliato. Inizia da un capitolo, poi lo ricontrolli, quando √® fatto usi la stessa procedura per gli altri capitoli, lanci un agente a capitolo e hai finito, oppure cinque agenti a capitolo. Ok, task e log."

### Istruzioni chiave
1. **Vai piano piano** - controlla ogni step
2. **NON tradurre tutto e poi scoprire errori** - verifica incrementale
3. **Workflow:**
   - Traduci UN capitolo
   - Ricontrollalo per qualit√†
   - Se OK, replica procedura per altri capitoli
4. **Parallelismo:** Posso lanciare 1 agente per capitolo (o 5 per capitolo)

### Risorse gi√† esistenti
- LLaMA 3.1 8B su SSD: `/Volumes/DATI-SSD/llm-models/`
- Procedure TinyGrad: `tools/RADEON-TINYGRAD-PROCEDURES.md`

### Task
Creare task per traduzione con procedura incrementale.

## 2026-01-31 07:49 PST - Dashboard Agent Chat Fix Request

### Messaggio (ID: 3077)
**Voce:** "Provebbia esistere un task nel nostro sistema task-md in tutta la lista di task per fixare su onde.surf la nostra dashboard interna, quella dashboard degli agenti in cui si vedono gli agenti in azione in cui posso mandare messaggi, questa roba non ha mai funzionato e adesso gli do un task, la devi far funzionare, devi iniziare invece che su Telegram a interfacciarmi con Claudinho un digno da onde.surf su quella dashboard free riverhouse, ok, task log implementa."

**Interpretazione:**
- Mattia vuole fixare la chat degli agenti su onde.surf (FreeRiverHouse dashboard)
- La funzionalit√† di chat non ha MAI funzionato
- Obiettivo: poter chattare con Clawdinho da onde.surf invece che da Telegram
- Il sistema attuale crea task che vengono processati da un executor Claude, ma NON parla con i veri sessioni Clawdbot

### Analisi Tecnica
Il FreeRiverHouse component ha una tab "Chat" che:
1. Crea un task `agent_request` via POST /api/agent-tasks
2. Polla per la risposta ogni 3 secondi
3. L'agent-executor USA CLAUDE API DIRETTAMENTE - non parla con Clawdbot!

**Problema:** Non c'√® connessione tra la dashboard e le sessioni Clawdbot reali.

**Soluzione proposta:**
1. Creare sistema queue: Dashboard ‚Üí D1 ‚Üí Clawdbot pickup via heartbeat
2. O esporre gateway WebSocket e creare connessione diretta
3. O creare proxy API che parla col gateway locale

### Task Creato
[T1025] Infra: Fix FreeRiverHouse Agent Chat - Connect to Real Clawdbot Sessions

## 2026-01-31 07:59 PST - Agent Chat Fix & Deploy

### Problema risolto
- `/api/agent-chat` e `/api/agent-chat/pending` restituivano 307 redirect a login
- Clawdbot non poteva accedere agli endpoint per pickup messaggi

### Fix applicato
- Aggiunto `/api/agent-chat` a `publicRoutes` in `middleware.ts`
- Rebuild + deploy onde.surf: https://6b65ce96.onde-surf.pages.dev
- Commit: `fix: add /api/agent-chat to public routes for Clawdbot access`

### Stato attuale
- Auth fix: ‚úÖ DEPLOYED
- D1 Migration: ‚è≥ PENDING (richiede azione Mattia)
- Errore attuale: `D1_ERROR: no such table: agent_chat_messages`

### Azione richiesta Mattia
Applicare migration D1 in Cloudflare Dashboard:
1. https://dash.cloudflare.com ‚Üí D1 ‚Üí onde-surf-db
2. Console ‚Üí esegui `migrations/0007_agent_chat.sql`
