# 2026-01-29 Memory Log

## 12:02 PST - Heartbeat Cycle

### Completed
- **T419**: News sentiment effectiveness analysis
  - Created `scripts/analyze-news-effectiveness.py`
  - Compares news-aligned vs neutral trade performance
  - Output: `data/trading/news-effectiveness.json`
  - Currently awaiting v2 trades with news data

- **T421**: Dry-run settlement tracker
  - Created `scripts/dryrun-settlement-tracker.py`
  - Simulates settlements using historical prices
  - Portfolio tracking with win rate, PnL, ROI
  - Compares real vs dry-run performance

### Added Tasks
- T425: Integrate news effectiveness into weekly report
- T426: News effectiveness cron schedule
- T427: News effectiveness dashboard widget

### System Status
- Autotrader: Running (PID 50497)
- onde.surf: Deployed, auth working (307 â†’ login)
- onde.la: Deployed (previous commit)
- No critical alerts

### Notes
- Cleared false positive broken-links.alert (Google Fonts bare domain 404s are expected)
- All existing trades (41) are from v1 model - no news sentiment data yet

## 2026-01-29 12:15 PST - PredictionArena Research Complete

### T408 Research Findings
Analyzed PredictionArena.ai leaderboard (AI trading competition on Kalshi):

**Key Discovery:**
- Only 1 model profitable: Mystery Model Alpha (+10.61%)
- Grok-4-1-fast is WORST performer (-15.94%)! X claims debunked.
- **WINNING STRATEGY IS WEATHER MARKETS, NOT CRYPTO!**

**Critical Insights:**
1. Weather markets have real edge (NWS forecast accuracy)
2. Favorite-longshot bias: 75%+ prob events priced at 40-50Â¢
3. Near-settlement trades (<48h) most reliable
4. Crypto markets have "minimal edge after fees" per GLM-4.7

**New Tasks Created:**
- T422: Add weather markets (KXNYC, KXMIA, KXDEN)
- T423: NWS forecast integration

Full analysis: `data/research/predictionarena-analysis-2026-01-29.md`

## 2026-01-29 12:35 - Weather Markets Integration (T422, T423) âœ…

### Lavoro Completato
Integrato weather markets nel Kalshi autotrader basandosi su ricerca PredictionArena.

### Dettagli Tecnici
1. **Import weather module** - Aggiunto import per `nws-weather-forecast.py`
2. **Config aggiunta**:
   - `WEATHER_ENABLED=true` (env var)
   - `WEATHER_CITIES=["NYC", "MIA", "DEN", "CHI"]`
   - `WEATHER_MIN_EDGE=0.10` (10%)
   - `WEATHER_MAX_HOURS_TO_SETTLEMENT=48`
   - `WEATHER_KELLY_FRACTION=0.08` (piÃ¹ alto di crypto)
3. **`find_weather_opportunities()`** - Nuova funzione che:
   - Scansiona mercati per ogni cittÃ 
   - Filtra per tempo a settlement (<48h per massima accuracy NWS)
   - Calcola edge usando previsioni NWS
   - Ritorna opportunitÃ  compatibili con execute_opportunity()
4. **Merge in run_cycle()** - Weather opportunities mergiate con crypto, eseguita la migliore
5. **Display specifico** - Weather opps mostrano forecast temp, uncertainty, city

### Edge Source
- NWS forecasts accurati Â±2-3Â°F per <48h
- Favorite-longshot bias nei mercati Kalshi
- High-probability events underpriced

### Test
- NWS API funziona (testato NYC: 21Â°F this afternoon, 9Â°F tonight)
- Autotrader compila senza errori

### Prossimi Passi
- Monitorare primi weather trades
- Verificare settlement tracker funzioni per weather markets
- Considerare aggiunta di piÃ¹ cittÃ 

## 2026-01-29 12:45 - Bug Fixes + First Weather Trade! âœ…

### Bug Fixes
1. **regime_multiplier not defined** - Initialized to 1.0 before if/else block
2. **ML features TypeError** - Handle None values for strike/current_price
3. **Health status unpacking** - check_circuit_breaker returns 3 values, not 2

### First Weather Trade! ðŸŽ‰
- **Market**: KXHIGHCHI-26JAN29-B16.5 (Chicago High Temp)
- **Side**: NO @ 8Â¢
- **Contracts**: 4
- **NWS Forecast**: 16Â°F Â± 2.0Â°F
- **Our prob**: 19.1% vs Market: 92.0%
- **Edge**: 72.9%!

### Status
- Autotrader running (PID 66542)
- Weather + Crypto markets both being scanned
- First 2 weather trades executed successfully

## 2026-01-29 12:55 PST - Heartbeat Work

### Azioni
1. âœ… Processed momentum-divergence alert â†’ archived to finetuning data
2. âœ… Created weather-settlement-tracker.py (T424)
   - Parses KXHIGH/KXLOW weather tickers
   - Fetches actual temps from NWS API
   - Fallback to Open-Meteo historical API
   - Tracks forecast accuracy

### Trading Status
- Autotrader v2: Running (PID 66542)
- 4 weather trades pending (CHI and NYC markets)
- No crypto trades yet in v2
- Weather markets show 60-72% edge based on NWS forecasts

### Notes
- Weather settlement will happen after market close (23:59 UTC)
- Need to add cron for hourly weather settlement checks

## 2026-01-29 13:07 PST - Heartbeat: T322 Completed

### Work Done
- **T322**: Implemented cache invalidation with "last updated" indicator
  - Created `lib/time-utils.ts` with getTimeAgo() and getStalenessLevel()
  - Created `LastUpdatedIndicator` component
  - Color-coded staleness: green (fresh), yellow (>5min), red (>15min)
  - Auto-refreshes every 10s
  - Fixed pre-existing bug: statsLoading â†’ isLoading

### System Status
- Autotrader: Running (PID 66542)
- No critical alerts
- Git synced and pushed

### Technical Alerts Processed
- Momentum divergence alert â†’ saved to data/finetuning/momentum-divergence.jsonl
  - BTC & ETH showing bearish divergence (price up, RSI down)
  - RSI levels: BTC 32.0, ETH 36.5

## 2026-01-29 13:30 PST - Heartbeat Task Session

### Tasks Completed
1. **T432** - Added alert type filter buttons to /health page
   - 5 filters: All, Divergence, Regime, Volatility, Whipsaw
   - Each shows count, color-coded when active
   - Deployed to onde.la/health

2. **T433** - Created alerts upload watchdog
   - `scripts/watchdog-alerts-upload.sh` monitors Gist updates
   - Fixed `upload-alerts-to-gist.py` to use GitHub API (gh gist edit is interactive)
   - Uses gh CLI to fetch Gist (avoids GitHub raw file cache)
   - Added `alerts-upload-stale.alert` to HEARTBEAT.md

3. **T429** - Verified v2 trade count widget already exists
   - ModelComparisonChart shows v1 vs v2 side-by-side
   - v2 shows 0 trades because autotrader is conservative
   - Will auto-populate when v2 makes trades

### Technical Notes
- Processed 1 momentum divergence alert â†’ saved to finetuning folder
- Autotrader running (PID 66542)
- Added `*.alert` to .gitignore (accidentally committed one)
- Deploy to onde.la works (favicon.ico test fails because we use SVG - known false positive)

### Commits
- feat(health): add alert type filter buttons (T432)
- feat(monitoring): add alerts upload watchdog (T433)
- chore: gitignore alert files
- docs: mark T429 as done (v2 widget already exists)
## 2026-01-29 13:40 - Heartbeat Work

### Tasks Completed
- T430: Added auto-commit for visual baselines in visual-regression-tests.py

### Technical Alerts Processed
- Saved momentum divergence alert (BTC bearish, ETH bearish) to finetuning data

### System Status
- Autotrader: Running (PID 66542)
- Git: Synced



### Tasks Completed (continued)
- T427: Added cache diagnostics panel to /health page
  - Shows total entries, cache size, bucket count, stale entries
  - Per-bucket breakdown with entry details
  - Auto-refreshes every 2min


## 2026-01-29 13:48 - WhisperFlow VAD Integration

### Completato
- Creato `apps/whisperflow/whisperflow-vad.py` con:
  - Silero VAD per voice activity detection
  - Trascrizione attivata solo quando parli
  - Integrazione whisper-cpp
  - Python venv con torch, torchaudio, sounddevice
- Aggiunto README.md e requirements.txt
- Creati task T434/T435/T436 per menu bar app
- Processato momentum divergence alert â†’ finetuning

### Benchmark risultato
- 0.35x RTF (3x piÃ¹ veloce del real-time!)
- Modello base (147MB) su M1 Pro

### Prossimi step
- T434: Menu bar app SwiftUI
- T435: Global hotkey
- T436: Text overlay

## 2026-01-29 13:58 PST - T441 Completed: Per-Asset Position Sizing

### Task
Added per-asset position size limits to autotrader (T441)

### Implementation
- Created ASSET_CONFIG dict with per-asset Kelly fraction, max position %, min edge
- BTC: 5% Kelly, 3% max position (standard - most liquid)
- ETH: 4% Kelly, 2.5% max position (more volatile than BTC)
- Weather: 8% Kelly, 2% max position (NWS forecasts reliable, less liquid)
- Default: 3% Kelly, 2% max position (conservative for unknown assets)
- get_asset_config() helper function with fallback

### Key Insight
Different assets have different edge sources and liquidity profiles. Weather markets use NWS forecasts (high reliability) while ETH is more volatile than BTC. Per-asset sizing reduces concentration risk.



## 2026-01-29 15:02 PST - Heartbeat Cycle

### Tasks Completed
- **T446**: Created `/api/health/status` endpoint for external monitoring
  - Returns: autotrader status, site health, trading stats, alerts summary
  - Cached 1 min, returns 503 on critical
- **T449**: Deployed onde.surf with new health endpoint
  - Both sites healthy (onde.la: 242ms, onde.surf: 318ms)
  - Deploy: https://0a328ab2.onde-surf.pages.dev

### Tasks Added
- **T450**: Uptime history chart for /health page
- **T451**: Webhook notifications for critical alerts

### Alerts Processed
- `kalshi-momentum-divergence.alert` â†’ Saved to finetuning/momentum-divergence.jsonl
  - BTC/ETH bearish divergence detected (RSI dropping while price up)

### Autotrader Status
- Running (PID 66542)
- v2 active
## 2026-01-29 15:24 - Heartbeat Work

### Tasks Completed
- **T453**: Added Telegram integration to health-webhook-notifier.sh (Bot API support)
- **T452**: Added cron job for health-webhook-notifier (*/5 min)
- **T457**: Integrated momentum divergence into autotrader trade decisions

### Tasks Added
- T455: Health alert history persistence to KV
- T456: Health dashboard auto-refresh toggle
- T457: âœ… (completed same session)

### Alerts Processed
- kalshi-momentum-divergence.alert â†’ saved to data/finetuning/

### System Status
- Autotrader: Running (PID 66542)
- Git: 3 commits pushed


## 2026-01-29 15:40 PST - Heartbeat Work

### Completato
- Processato alert tecnico `kalshi-momentum-divergence.alert` â†’ salvato in data/finetuning
- **T459** Health page: aggiunto shortcut 'R' per refresh manuale
  - Listener keyboard event (ignora input/textarea)
  - Hint visivo kbd element next to refresh button
- Deploy onde.la â†’ https://751b4d22.onde-portal.pages.dev
- Git commit: 25b7953a6

### Status
- Autotrader: âœ… Running (PID 66542)
- onde.la: âœ… HTTP 200

## 2026-01-29 15:38 PST - Moonlight Magic House: Future Vision

### Messaggio (ID: 2385)
Mattia ha risposto al deploy dei mini-giochi con una visione futura:

**Feature Request:**
1. **PiÃ¹ realismo nelle stanze** - Grafica piÃ¹ dettagliata/immersiva
2. **Moonlight si muove** - Personaggio animato che cammina nella casa
3. **Oggetti interattivi** - Nella camera di Moonlight, giochi/oggetti cliccabili che aprono mini-giochi a sorpresa

### Concetto
Trasformare Moonlight Magic House da mappa statica a esperienza esplorativa dove:
- Moonlight puÃ² navigare con le freccette o tap
- Oggetti nelle stanze sono cliccabili (es: tablet â†’ mini-game, libro â†’ storia, etc.)
- Scoperta organica invece di menu

### Task Creato
â†’ [T461] Moonlight Magic House v2: movimento + oggetti interattivi
## 2026-01-29 15:48 - Heartbeat Task: T460

### Completed
- **[T460] Health page: Browser notifications on status change** - DONE
  - Added useNotifications hook with permission management
  - Toggle button in header (ðŸ””/ðŸ”•)
  - Detects status changes and sends browser notification
  - localStorage persistence for preference
  - Committed and pushed

### Technical Alerts Processed
- **kalshi-momentum-divergence.alert** â†’ Saved to data/finetuning/momentum-divergence.jsonl
  - BTC/ETH bearish divergence detected (price up, RSI down)

### System Status
- Autotrader: âœ… Running (PID 66542)
- Git: synced


### Also Completed This Cycle
2. **[T448] Add PnL chart comparing weather vs crypto markets** - DONE
   - Created `WeatherCryptoPnLChart` component
   - SVG-based cumulative PnL line chart (weather/crypto/combined)
   - parsePnLByMarketType() helper to categorize trades
   - Theme-aware colors, mock data fallback
   - Integrated on /betting page

## 2026-01-29 16:24 PST - Heartbeat: Movement System Implementation

### Completed
- **T461 (partial)**: Moonlight Magic House v2 - Movement System
  - âœ… WASD/Arrow key movement for desktop
  - âœ… Tap-to-move for mobile/touch devices
  - âœ… Walking animation with bounce effect
  - âœ… Direction facing (sprite flips based on movement)
  - âœ… Walk dust particle effects
  - âœ… Movement hint for new players (auto-hides after first move)
  - âœ… Smooth CSS transitions
  - Remaining: More realistic graphics (art/design task)

### Technical Details
- Added keyboard event listeners for WASD/arrows
- Implemented tap-to-move with smooth animation loop
- CSS keyframe animations for walk bounce and dust particles
- localStorage persistence for movement hint visibility

### Alerts Processed
- `kalshi-momentum-divergence.alert` â†’ Saved to `data/finetuning/momentum-divergence.jsonl`
  - BTC bearish divergence (RSI 32, price $87,896)
  - ETH bearish divergence (RSI 36.5, price $2,946)
  - Technical alert for fine-tuning, NOT sent to Mattia

### System Status
- Autotrader: Running âœ… (PID 66542)
- Git: Up to date, pushed commit 5236d4fd4
- No critical alerts

## 2026-01-29 16:31 - Voice Note: AI Avatar Real-Time
### Trascrizione
Mattia parla di creare un avatar AI che puÃ² rispondere in tempo reale alle interviste. Cita Elon Musk che giÃ  usa un avatar per rispondere al suo posto. "GiÃ  questa cosa Ã¨ fattibile, dobbiamo farla anche noi."

### Contesto
- Riferimento a tecnologia giÃ  esistente
- Ambizioso ma tecnicamente possibile
- Da esplorare per Onde/progetti futuri
