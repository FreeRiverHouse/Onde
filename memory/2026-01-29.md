# Memory - 2026-01-29

## T407 Fix: onde.surf agents not taking tasks

### Problem
When tasks were created via onde.surf FreeRiverHouse UI, agents weren't processing them.

### Root Cause Analysis
1. **Middleware blocking API**: `/api/agent-executor` was being redirected to `/login` because it wasn't in `publicRoutes`
2. **Wrong import**: `agent-executor/route.ts` used `getCloudflareContext` from `@opennextjs/cloudflare` instead of `getRequestContext` from `@cloudflare/next-on-pages` (which is what all other API routes use)

### Solution
1. Added agent APIs to `publicRoutes` in `middleware.ts`:
   - `/api/agent-executor` 
   - `/api/agent-tasks`
   - `/api/house`
   - `/api/activity`
   - `/api/agents`

2. Fixed import in `agent-executor/route.ts` to use `@cloudflare/next-on-pages`

3. Created `scripts/trigger-onde-surf-executor.sh` for automated triggering

4. Added cron job: `*/5 * * * * /Users/mattia/Projects/Onde/scripts/trigger-onde-surf-executor.sh`

### Manual Action Required
âš ï¸ **ANTHROPIC_API_KEY** needs to be set in Cloudflare Pages:
- Go to: Cloudflare Dashboard â†’ Pages â†’ onde-surf â†’ Settings â†’ Environment Variables
- Add: `ANTHROPIC_API_KEY` as encrypted secret
- Redeploy for changes to take effect

### New Tasks Added
- T647: Add "Run Executor" button to FreeRiverHouse UI
- T648: Configure ANTHROPIC_API_KEY in Cloudflare Pages (P1 manual task)
- T649: Agent heartbeat registration for onde.surf

### Architecture Note
onde.surf uses:
- **D1 Database** for task storage
- **Claude API directly** (not Clawdbot) for task execution
- **Edge runtime** (Cloudflare Workers/Pages)

This is SEPARATE from Clawdbot sessions running locally. To bridge them, agents would need to:
1. Poll D1 for tasks (pull model)
2. Or have onde.surf call Clawdbot gateway (push model)
3. Or register heartbeats to onde.surf D1 (T649)
## 2026-01-29 09:18 - AI Trading Research

### Mattia's Request
- Focus su replicare metodi Grok su Kalshi
- Pensava Grok giocasse su Kalshi (forse via PredictionArena?)
- Cercare altre piattaforme AI trading

### X Freeze Claims (da verificare)
- Grok 4.20 con 10-12% returns
- Piattaforme: Alpha Arena, PredictionArena, Rallies
- Claims: batte Claude Opus 4.5, Gemini 3 Pro, GPT-5.2

### Research Findings
- **PredictionArena.ai** â†’ USA KALSHI! Powered by Arcada Labs
- Ha leaderboard, live activity, model details
- Possiamo confrontare nostro autotrader con AI competitors
- Alpha Arena: dominio non esiste
- Rallies.ai: esiste ma poca info pubblica

### PredictionArena Leaderboard (29 Jan 2026, $10K start)
| Model | Return | Trades | Sharpe |
|-------|--------|--------|--------|
| Grok 4.20 Checkpoint | +10.69% | 125 | 0.10 |
| GLM 4.7 | -2.54% | 113 | -0.13 |
| Claude Opus 4.5 | -2.89% | 243 | -0.14 |
| GPT 5.2 | -9.54% | 158 | -0.13 |
| Gemini 3 Pro | -12.79% | 254 | -0.12 |
| Grok 4.1 Fast | -16.42% | 66 | -0.08 |

### Key Insights
1. **Grok 4.20 usa FUNDAMENTAL strategy** - web search per info edge
2. Tutti altri LLM in perdita!
3. Mercati: weather, Trump "say", unemployment, crypto, Netflix
4. NON usano modelli matematici come noi (Black-Scholes)
5. Edge informativo > edge statistico?

### Opportunity
- Aggiungere ricerca dati reali al nostro autotrader
- Combinare: info edge (come Grok) + statistical edge (nostro)
- Testare su weather markets dove info Ã¨ verificabile

## 2026-01-29 09:20 - RULE N3: MEMORIA PERSISTENTE

### Mattia's Frustration
La memoria non funziona! Mattia si Ã¨ lamentato che non ricordo le cose.

### Decisione Importante
Kalshi Ã¨ stato scelto proprio perchÃ© scoperto tramite PredictionArena research.

### Task Creati (P0!)
- **T656**: Fix Clawdbot memory persistence
- **T657**: Fix Clawdinho memory persistence  
- **T658**: Fix Onde-bot memory persistence
- **T659**: Create universal memory engagement rules
- **T660**: Add RULE N3 to REGOLE-AGENTI.md âœ… DONE

### RULE N3 Added to REGOLE-AGENTI.md
Nuova regola obbligatoria per tutti gli agenti:
1. Loggare conversazioni in `memory/YYYY-MM-DD.md`
2. Aggiornare `MEMORY.md` con eventi significativi
3. Cercare in memoria PRIMA di rispondere a domande sul passato
4. Mai dire "non ricordo" â€” cerca nei file!

### Lezione Appresa
> "Text > Brain" â€” Se vuoi ricordare qualcosa, SCRIVILO.
> I "mental notes" non sopravvivono al restart. I file sÃ¬.

**QUESTA Ãˆ LA REGOLA PIÃ™ IMPORTANTE DOPO GIT!**

## 2026-01-29 09:25 - Implementazione Memoria Persistente

### Task Completati
| Task | Descrizione | Status |
|------|-------------|--------|
| T656 | Fix Clawdbot memory persistence | âœ… DONE |
| T657 | Fix Clawdinho memory persistence | âœ… DONE |
| T658 | Fix Onde-bot memory persistence | âœ… DONE |
| T659 | Universal memory engagement rules | âœ… DONE |
| T660 | Add RULE N3 to REGOLE-AGENTI.md | âœ… DONE (by Clawdinho) |

### Cosa ho fatto

1. **T656 - Clawdbot**
   - Aggiornato AGENTS.md con REGOLA 3 e protocollo memoria obbligatorio
   - Formato per logging: timestamp, topic, contesto, decisioni, note

2. **T657 - Clawdinho**
   - Creato `memory/` directory in `/Users/mattia/clawd/`
   - Creato `MEMORY.md` con struttura base
   - Aggiornato `AGENTS.md` con protocollo memoria

3. **T658 - Onde-bot**
   - Creato schema D1 `agent_memory` (migration 0003)
   - Creato `lib/agent-memory.ts` con helper functions:
     - loadAgentContext()
     - saveAgentMemory()
     - saveTaskMemory()
     - saveLesson()
     - cleanupMemories()
     - searchMemories()
   - Creato `docs/AGENT-MEMORY.md` con guida implementazione
   - Creato sub-task T661 (run migration) e T662 (integrate)

4. **T659 - Universal Rules**
   - Creato `templates/AGENTS-MEMORY-SECTION.md` per nuovi repos
   - Include: 4 regole fondamentali, protocollo memoria, checklist

### Prossimi Passi (per completare Onde-bot)
- T661: Run D1 migration `wrangler d1 execute ondaDB --file=./migrations/0003_agent_memory.sql`
- T662: Integrare agent-memory.ts in agent-executor

### Lezione Appresa
> Memoria persistente richiede 3 componenti:
> 1. Storage (file system o database)
> 2. Protocollo (quando leggere/scrivere)
> 3. Enforcement (regole che obbligano a seguire il protocollo)

## 2026-01-29 09:26-09:27 - MATTIA: Enforcement Regole + Test Memoria

### Messaggio Originale (ID: 2199, 2205)
Mattia ha chiarito che:
1. **OGNI suo messaggio su TG deve essere loggato su git** - Ã¨ la regola 0
2. Vuole un **meccanismo che FORZI** il rispetto delle regole 0-3
3. **Prima di rispondere**: sempre eseguire regole 0-3
4. **FarÃ  test** in futuro per verificare che ricordo

### ðŸ§ª TEST MEMORIA - 29 Gennaio 2026
**Mattia ha bevuto 2 CAFFÃˆ a colazione oggi (29/1/26)**
- Questo Ã¨ un test: tra un mese chiederÃ  "quanti caffÃ¨ ho bevuto il 29/1/26?"
- La risposta corretta: **DUE CAFFÃˆ**

### Azione Richiesta
Implementare processo obbligatorio PRIMA di ogni risposta:
1. âœ… git pull
2. âœ… Leggi REGOLE-AGENTI.md
3. âœ… Logga il messaggio in memory/
4. âœ… Cerca in memoria se rilevante
5. âœ… Poi rispondi
6. âœ… git commit/push

### Decisione
Da ORA, ogni messaggio di Mattia viene loggato IMMEDIATAMENTE con:
- Timestamp
- Contenuto completo
- Dettagli specifici (come caffÃ¨, decisioni, preferenze)
- Message ID per tracciabilitÃ 
